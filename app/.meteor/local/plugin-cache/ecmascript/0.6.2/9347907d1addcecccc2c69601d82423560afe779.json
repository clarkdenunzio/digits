{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/client/lib/semantic-ui/definitions/modules/dropdown.js","filenameRelative":"/client/lib/semantic-ui/definitions/modules/dropdown.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/client/lib/semantic-ui/definitions/modules/dropdown.js.map","sourceFileName":"/client/lib/semantic-ui/definitions/modules/dropdown.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"dropdown"},"ignored":false,"code":"/*\n  DO NOT MODIFY - This file has been generated and will be regenerated\n  Semantic UI v2.2.1\n*/ /*!\n    * # Semantic UI - Dropdown\n    * http://github.com/semantic-org/semantic-ui/\n    *\n    *\n    * Released under the MIT license\n    * http://opensource.org/licenses/MIT\n    *\n    */;\n\n(function ($, window, document, undefined) {\n  \"use strict\";\n\n  window = typeof window != 'undefined' && window.Math == Math ? window : typeof self != 'undefined' && self.Math == Math ? self : Function('return this')();\n\n  $.fn.dropdown = function (parameters) {\n    var $allModules = $(this),\n        $document = $(document),\n        moduleSelector = $allModules.selector || '',\n        hasTouch = 'ontouchstart' in document.documentElement,\n        time = new Date().getTime(),\n        performance = [],\n        query = arguments[0],\n        methodInvoked = typeof query == 'string',\n        queryArguments = [].slice.call(arguments, 1),\n        returnedValue;\n    $allModules.each(function (elementIndex) {\n      var settings = $.isPlainObject(parameters) ? $.extend(true, {}, $.fn.dropdown.settings, parameters) : $.extend({}, $.fn.dropdown.settings),\n          className = settings.className,\n          message = settings.message,\n          fields = settings.fields,\n          keys = settings.keys,\n          metadata = settings.metadata,\n          namespace = settings.namespace,\n          regExp = settings.regExp,\n          selector = settings.selector,\n          error = settings.error,\n          templates = settings.templates,\n          eventNamespace = '.' + namespace,\n          moduleNamespace = 'module-' + namespace,\n          $module = $(this),\n          $context = $(settings.context),\n          $text = $module.find(selector.text),\n          $search = $module.find(selector.search),\n          $sizer = $module.find(selector.sizer),\n          $input = $module.find(selector.input),\n          $icon = $module.find(selector.icon),\n          $combo = $module.prev().find(selector.text).length > 0 ? $module.prev().find(selector.text) : $module.prev(),\n          $menu = $module.children(selector.menu),\n          $item = $menu.find(selector.item),\n          activated = false,\n          itemActivated = false,\n          internalChange = false,\n          element = this,\n          instance = $module.data(moduleNamespace),\n          initialLoad,\n          pageLostFocus,\n          willRefocus,\n          elementNamespace,\n          id,\n          selectObserver,\n          menuObserver,\n          module;\n      module = {\n        initialize: function () {\n          module.debug('Initializing dropdown', settings);\n\n          if (module.is.alreadySetup()) {\n            module.setup.reference();\n          } else {\n            module.setup.layout();\n            module.refreshData();\n            module.save.defaults();\n            module.restore.selected();\n            module.create.id();\n            module.bind.events();\n            module.observeChanges();\n            module.instantiate();\n          }\n        },\n        instantiate: function () {\n          module.verbose('Storing instance of dropdown', module);\n          instance = module;\n          $module.data(moduleNamespace, module);\n        },\n        destroy: function () {\n          module.verbose('Destroying previous dropdown', $module);\n          module.remove.tabbable();\n          $module.off(eventNamespace).removeData(moduleNamespace);\n          $menu.off(eventNamespace);\n          $document.off(elementNamespace);\n          module.disconnect.menuObserver();\n          module.disconnect.selectObserver();\n        },\n        observeChanges: function () {\n          if ('MutationObserver' in window) {\n            selectObserver = new MutationObserver(module.event.select.mutation);\n            menuObserver = new MutationObserver(module.event.menu.mutation);\n            module.debug('Setting up mutation observer', selectObserver, menuObserver);\n            module.observe.select();\n            module.observe.menu();\n          }\n        },\n        disconnect: {\n          menuObserver: function () {\n            if (menuObserver) {\n              menuObserver.disconnect();\n            }\n          },\n          selectObserver: function () {\n            if (menuObserver) {\n              menuObserver.disconnect();\n            }\n          }\n        },\n        observe: {\n          select: function () {\n            if (module.has.input()) {\n              selectObserver.observe($input[0], {\n                childList: true,\n                subtree: true\n              });\n            }\n          },\n          menu: function () {\n            if (module.has.menu()) {\n              menuObserver.observe($menu[0], {\n                childList: true,\n                subtree: true\n              });\n            }\n          }\n        },\n        create: {\n          id: function () {\n            id = (Math.random().toString(16) + '000000000').substr(2, 8);\n            elementNamespace = '.' + id;\n            module.verbose('Creating unique id for element', id);\n          },\n          userChoice: function (values) {\n            var $userChoices, $userChoice, isUserValue, html;\n            values = values || module.get.userValues();\n\n            if (!values) {\n              return false;\n            }\n\n            values = $.isArray(values) ? values : [values];\n            $.each(values, function (index, value) {\n              if (module.get.item(value) === false) {\n                html = settings.templates.addition(module.add.variables(message.addResult, value));\n                $userChoice = $('<div />').html(html).attr('data-' + metadata.value, value).attr('data-' + metadata.text, value).addClass(className.addition).addClass(className.item);\n\n                if (settings.hideAdditions) {\n                  $userChoice.addClass(className.hidden);\n                }\n\n                $userChoices = $userChoices === undefined ? $userChoice : $userChoices.add($userChoice);\n                module.verbose('Creating user choices for value', value, $userChoice);\n              }\n            });\n            return $userChoices;\n          },\n          userLabels: function (value) {\n            var userValues = module.get.userValues();\n\n            if (userValues) {\n              module.debug('Adding user labels', userValues);\n              $.each(userValues, function (index, value) {\n                module.verbose('Adding custom user value');\n                module.add.label(value, value);\n              });\n            }\n          },\n          menu: function () {\n            $menu = $('<div />').addClass(className.menu).appendTo($module);\n          },\n          sizer: function () {\n            $sizer = $('<span />').addClass(className.sizer).insertAfter($search);\n          }\n        },\n        search: function (query) {\n          query = query !== undefined ? query : module.get.query();\n          module.verbose('Searching for query', query);\n\n          if (module.has.minCharacters(query)) {\n            module.filter(query);\n          } else {\n            module.hide();\n          }\n        },\n        select: {\n          firstUnfiltered: function () {\n            module.verbose('Selecting first non-filtered element');\n            module.remove.selectedItem();\n            $item.not(selector.unselectable).not(selector.addition + selector.hidden).eq(0).addClass(className.selected);\n          },\n          nextAvailable: function ($selected) {\n            $selected = $selected.eq(0);\n            var $nextAvailable = $selected.nextAll(selector.item).not(selector.unselectable).eq(0),\n                $prevAvailable = $selected.prevAll(selector.item).not(selector.unselectable).eq(0),\n                hasNext = $nextAvailable.length > 0;\n\n            if (hasNext) {\n              module.verbose('Moving selection to', $nextAvailable);\n              $nextAvailable.addClass(className.selected);\n            } else {\n              module.verbose('Moving selection to', $prevAvailable);\n              $prevAvailable.addClass(className.selected);\n            }\n          }\n        },\n        setup: {\n          api: function () {\n            var apiSettings = {\n              debug: settings.debug,\n              urlData: {\n                value: module.get.value(),\n                query: module.get.query()\n              },\n              on: false\n            };\n            module.verbose('First request, initializing API');\n            $module.api(apiSettings);\n          },\n          layout: function () {\n            if ($module.is('select')) {\n              module.setup.select();\n              module.setup.returnedObject();\n            }\n\n            if (!module.has.menu()) {\n              module.create.menu();\n            }\n\n            if (module.is.search() && !module.has.search()) {\n              module.verbose('Adding search input');\n              $search = $('<input />').addClass(className.search).prop('autocomplete', 'off').insertBefore($text);\n            }\n\n            if (module.is.multiple() && module.is.searchSelection() && !module.has.sizer()) {\n              module.create.sizer();\n            }\n\n            if (settings.allowTab) {\n              module.set.tabbable();\n            }\n          },\n          select: function () {\n            var selectValues = module.get.selectValues();\n            module.debug('Dropdown initialized on a select', selectValues);\n\n            if ($module.is('select')) {\n              $input = $module;\n            } // see if select is placed correctly already\n\n\n            if ($input.parent(selector.dropdown).length > 0) {\n              module.debug('UI dropdown already exists. Creating dropdown menu only');\n              $module = $input.closest(selector.dropdown);\n\n              if (!module.has.menu()) {\n                module.create.menu();\n              }\n\n              $menu = $module.children(selector.menu);\n              module.setup.menu(selectValues);\n            } else {\n              module.debug('Creating entire dropdown from select');\n              $module = $('<div />').attr('class', $input.attr('class')).addClass(className.selection).addClass(className.dropdown).html(templates.dropdown(selectValues)).insertBefore($input);\n\n              if ($input.hasClass(className.multiple) && $input.prop('multiple') === false) {\n                module.error(error.missingMultiple);\n                $input.prop('multiple', true);\n              }\n\n              if ($input.is('[multiple]')) {\n                module.set.multiple();\n              }\n\n              if ($input.prop('disabled')) {\n                module.debug('Disabling dropdown');\n                $module.addClass(className.disabled);\n              }\n\n              $input.removeAttr('class').detach().prependTo($module);\n            }\n\n            module.refresh();\n          },\n          menu: function (values) {\n            $menu.html(templates.menu(values, fields));\n            $item = $menu.find(selector.item);\n          },\n          reference: function () {\n            module.debug('Dropdown behavior was called on select, replacing with closest dropdown'); // replace module reference\n\n            $module = $module.parent(selector.dropdown);\n            module.refresh();\n            module.setup.returnedObject(); // invoke method in context of current instance\n\n            if (methodInvoked) {\n              instance = module;\n              module.invoke(query);\n            }\n          },\n          returnedObject: function () {\n            var $firstModules = $allModules.slice(0, elementIndex),\n                $lastModules = $allModules.slice(elementIndex + 1); // adjust all modules to use correct reference\n\n            $allModules = $firstModules.add($module).add($lastModules);\n          }\n        },\n        refresh: function () {\n          module.refreshSelectors();\n          module.refreshData();\n        },\n        refreshItems: function () {\n          $item = $menu.find(selector.item);\n        },\n        refreshSelectors: function () {\n          module.verbose('Refreshing selector cache');\n          $text = $module.find(selector.text);\n          $search = $module.find(selector.search);\n          $input = $module.find(selector.input);\n          $icon = $module.find(selector.icon);\n          $combo = $module.prev().find(selector.text).length > 0 ? $module.prev().find(selector.text) : $module.prev();\n          $menu = $module.children(selector.menu);\n          $item = $menu.find(selector.item);\n        },\n        refreshData: function () {\n          module.verbose('Refreshing cached metadata');\n          $item.removeData(metadata.text).removeData(metadata.value);\n        },\n        clearData: function () {\n          module.verbose('Clearing metadata');\n          $item.removeData(metadata.text).removeData(metadata.value);\n          $module.removeData(metadata.defaultText).removeData(metadata.defaultValue).removeData(metadata.placeholderText);\n        },\n        toggle: function () {\n          module.verbose('Toggling menu visibility');\n\n          if (!module.is.active()) {\n            module.show();\n          } else {\n            module.hide();\n          }\n        },\n        show: function (callback) {\n          callback = $.isFunction(callback) ? callback : function () {};\n\n          if (module.can.show() && !module.is.active()) {\n            module.debug('Showing dropdown');\n\n            if (module.has.message() && !(module.has.maxSelections() || module.has.allResultsFiltered())) {\n              module.remove.message();\n            }\n\n            if (module.is.allFiltered()) {\n              return true;\n            }\n\n            if (settings.onShow.call(element) !== false) {\n              module.animate.show(function () {\n                if (module.can.click()) {\n                  module.bind.intent();\n                }\n\n                if (module.has.menuSearch()) {\n                  module.focusSearch();\n                }\n\n                module.set.visible();\n                callback.call(element);\n              });\n            }\n          }\n        },\n        hide: function (callback) {\n          callback = $.isFunction(callback) ? callback : function () {};\n\n          if (module.is.active()) {\n            module.debug('Hiding dropdown');\n\n            if (settings.onHide.call(element) !== false) {\n              module.animate.hide(function () {\n                module.remove.visible();\n                callback.call(element);\n              });\n            }\n          }\n        },\n        hideOthers: function () {\n          module.verbose('Finding other dropdowns to hide');\n          $allModules.not($module).has(selector.menu + '.' + className.visible).dropdown('hide');\n        },\n        hideMenu: function () {\n          module.verbose('Hiding menu  instantaneously');\n          module.remove.active();\n          module.remove.visible();\n          $menu.transition('hide');\n        },\n        hideSubMenus: function () {\n          var $subMenus = $menu.children(selector.item).find(selector.menu);\n          module.verbose('Hiding sub menus', $subMenus);\n          $subMenus.transition('hide');\n        },\n        bind: {\n          events: function () {\n            if (hasTouch) {\n              module.bind.touchEvents();\n            }\n\n            module.bind.keyboardEvents();\n            module.bind.inputEvents();\n            module.bind.mouseEvents();\n          },\n          touchEvents: function () {\n            module.debug('Touch device detected binding additional touch events');\n\n            if (module.is.searchSelection()) {// do nothing special yet\n            } else if (module.is.single()) {\n              $module.on('touchstart' + eventNamespace, module.event.test.toggle);\n            }\n\n            $menu.on('touchstart' + eventNamespace, selector.item, module.event.item.mouseenter);\n          },\n          keyboardEvents: function () {\n            module.verbose('Binding keyboard events');\n            $module.on('keydown' + eventNamespace, module.event.keydown);\n\n            if (module.has.search()) {\n              $module.on(module.get.inputEvent() + eventNamespace, selector.search, module.event.input);\n            }\n\n            if (module.is.multiple()) {\n              $document.on('keydown' + elementNamespace, module.event.document.keydown);\n            }\n          },\n          inputEvents: function () {\n            module.verbose('Binding input change events');\n            $module.on('change' + eventNamespace, selector.input, module.event.change);\n          },\n          mouseEvents: function () {\n            module.verbose('Binding mouse events');\n\n            if (module.is.multiple()) {\n              $module.on('click' + eventNamespace, selector.label, module.event.label.click).on('click' + eventNamespace, selector.remove, module.event.remove.click);\n            }\n\n            if (module.is.searchSelection()) {\n              $module.on('mousedown' + eventNamespace, module.event.mousedown).on('mouseup' + eventNamespace, module.event.mouseup).on('mousedown' + eventNamespace, selector.menu, module.event.menu.mousedown).on('mouseup' + eventNamespace, selector.menu, module.event.menu.mouseup).on('click' + eventNamespace, selector.icon, module.event.icon.click).on('focus' + eventNamespace, selector.search, module.event.search.focus).on('click' + eventNamespace, selector.search, module.event.search.focus).on('blur' + eventNamespace, selector.search, module.event.search.blur).on('click' + eventNamespace, selector.text, module.event.text.focus);\n\n              if (module.is.multiple()) {\n                $module.on('click' + eventNamespace, module.event.click);\n              }\n            } else {\n              if (settings.on == 'click') {\n                $module.on('click' + eventNamespace, selector.icon, module.event.icon.click).on('click' + eventNamespace, module.event.test.toggle);\n              } else if (settings.on == 'hover') {\n                $module.on('mouseenter' + eventNamespace, module.delay.show).on('mouseleave' + eventNamespace, module.delay.hide);\n              } else {\n                $module.on(settings.on + eventNamespace, module.toggle);\n              }\n\n              $module.on('mousedown' + eventNamespace, module.event.mousedown).on('mouseup' + eventNamespace, module.event.mouseup).on('focus' + eventNamespace, module.event.focus).on('blur' + eventNamespace, module.event.blur);\n            }\n\n            $menu.on('mouseenter' + eventNamespace, selector.item, module.event.item.mouseenter).on('mouseleave' + eventNamespace, selector.item, module.event.item.mouseleave).on('click' + eventNamespace, selector.item, module.event.item.click);\n          },\n          intent: function () {\n            module.verbose('Binding hide intent event to document');\n\n            if (hasTouch) {\n              $document.on('touchstart' + elementNamespace, module.event.test.touch).on('touchmove' + elementNamespace, module.event.test.touch);\n            }\n\n            $document.on('click' + elementNamespace, module.event.test.hide);\n          }\n        },\n        unbind: {\n          intent: function () {\n            module.verbose('Removing hide intent event from document');\n\n            if (hasTouch) {\n              $document.off('touchstart' + elementNamespace).off('touchmove' + elementNamespace);\n            }\n\n            $document.off('click' + elementNamespace);\n          }\n        },\n        filter: function (query) {\n          var searchTerm = query !== undefined ? query : module.get.query(),\n              afterFiltered = function () {\n            if (module.is.multiple()) {\n              module.filterActive();\n            }\n\n            module.select.firstUnfiltered();\n\n            if (module.has.allResultsFiltered()) {\n              if (settings.onNoResults.call(element, searchTerm)) {\n                if (settings.allowAdditions) {\n                  if (settings.hideAdditions) {\n                    module.verbose('User addition with no menu, setting empty style');\n                    module.set.empty();\n                    module.hideMenu();\n                  }\n                } else {\n                  module.verbose('All items filtered, showing message', searchTerm);\n                  module.add.message(message.noResults);\n                }\n              } else {\n                module.verbose('All items filtered, hiding dropdown', searchTerm);\n                module.hideMenu();\n              }\n            } else {\n              module.remove.empty();\n              module.remove.message();\n            }\n\n            if (settings.allowAdditions) {\n              module.add.userSuggestion(query);\n            }\n\n            if (module.is.searchSelection() && module.can.show() && module.is.focusedOnSearch()) {\n              module.show();\n            }\n          };\n\n          if (settings.useLabels && module.has.maxSelections()) {\n            return;\n          }\n\n          if (settings.apiSettings) {\n            if (module.can.useAPI()) {\n              module.queryRemote(searchTerm, function () {\n                afterFiltered();\n              });\n            } else {\n              module.error(error.noAPI);\n            }\n          } else {\n            module.filterItems(searchTerm);\n            afterFiltered();\n          }\n        },\n        queryRemote: function (query, callback) {\n          var apiSettings = {\n            errorDuration: false,\n            cache: 'local',\n            throttle: settings.throttle,\n            urlData: {\n              query: query\n            },\n            onError: function () {\n              module.add.message(message.serverError);\n              callback();\n            },\n            onFailure: function () {\n              module.add.message(message.serverError);\n              callback();\n            },\n            onSuccess: function (response) {\n              module.remove.message();\n              module.setup.menu({\n                values: response[fields.remoteValues]\n              });\n              callback();\n            }\n          };\n\n          if (!$module.api('get request')) {\n            module.setup.api();\n          }\n\n          apiSettings = $.extend(true, {}, apiSettings, settings.apiSettings);\n          $module.api('setting', apiSettings).api('query');\n        },\n        filterItems: function (query) {\n          var searchTerm = query !== undefined ? query : module.get.query(),\n              results = null,\n              escapedTerm = module.escape.regExp(searchTerm),\n              beginsWithRegExp = new RegExp('^' + escapedTerm, 'igm'); // avoid loop if we're matching nothing\n\n          if (module.has.query()) {\n            results = [];\n            module.verbose('Searching for matching values', searchTerm);\n            $item.each(function () {\n              var $choice = $(this),\n                  text,\n                  value;\n\n              if (settings.match == 'both' || settings.match == 'text') {\n                text = String(module.get.choiceText($choice, false));\n\n                if (text.search(beginsWithRegExp) !== -1) {\n                  results.push(this);\n                  return true;\n                } else if (settings.fullTextSearch === 'exact' && module.exactSearch(searchTerm, text)) {\n                  results.push(this);\n                  return true;\n                } else if (settings.fullTextSearch === true && module.fuzzySearch(searchTerm, text)) {\n                  results.push(this);\n                  return true;\n                }\n              }\n\n              if (settings.match == 'both' || settings.match == 'value') {\n                value = String(module.get.choiceValue($choice, text));\n\n                if (value.search(beginsWithRegExp) !== -1) {\n                  results.push(this);\n                  return true;\n                } else if (settings.fullTextSearch && module.fuzzySearch(searchTerm, value)) {\n                  results.push(this);\n                  return true;\n                }\n              }\n            });\n          }\n\n          module.debug('Showing only matched items', searchTerm);\n          module.remove.filteredItem();\n\n          if (results) {\n            $item.not(results).addClass(className.filtered);\n          }\n        },\n        fuzzySearch: function (query, term) {\n          var termLength = term.length,\n              queryLength = query.length;\n          query = query.toLowerCase();\n          term = term.toLowerCase();\n\n          if (queryLength > termLength) {\n            return false;\n          }\n\n          if (queryLength === termLength) {\n            return query === term;\n          }\n\n          search: for (var characterIndex = 0, nextCharacterIndex = 0; characterIndex < queryLength; characterIndex++) {\n            var queryCharacter = query.charCodeAt(characterIndex);\n\n            while (nextCharacterIndex < termLength) {\n              if (term.charCodeAt(nextCharacterIndex++) === queryCharacter) {\n                continue search;\n              }\n            }\n\n            return false;\n          }\n\n          return true;\n        },\n        exactSearch: function (query, term) {\n          query = query.toLowerCase();\n          term = term.toLowerCase();\n\n          if (term.indexOf(query) > -1) {\n            return true;\n          }\n\n          return false;\n        },\n        filterActive: function () {\n          if (settings.useLabels) {\n            $item.filter('.' + className.active).addClass(className.filtered);\n          }\n        },\n        focusSearch: function (skipHandler) {\n          if (module.has.search() && !module.is.focusedOnSearch()) {\n            if (skipHandler) {\n              $module.off('focus' + eventNamespace, selector.search);\n              $search.focus();\n              $module.on('focus' + eventNamespace, selector.search, module.event.search.focus);\n            } else {\n              $search.focus();\n            }\n          }\n        },\n        forceSelection: function () {\n          var $currentlySelected = $item.not(className.filtered).filter('.' + className.selected).eq(0),\n              $activeItem = $item.not(className.filtered).filter('.' + className.active).eq(0),\n              $selectedItem = $currentlySelected.length > 0 ? $currentlySelected : $activeItem,\n              hasSelected = $selectedItem.length > 0;\n\n          if (hasSelected) {\n            module.debug('Forcing partial selection to selected item', $selectedItem);\n            module.event.item.click.call($selectedItem, {}, true);\n            return;\n          } else {\n            if (settings.allowAdditions) {\n              module.set.selected(module.get.query());\n              module.remove.searchTerm();\n            } else {\n              module.remove.searchTerm();\n            }\n          }\n        },\n        event: {\n          change: function () {\n            if (!internalChange) {\n              module.debug('Input changed, updating selection');\n              module.set.selected();\n            }\n          },\n          focus: function () {\n            if (settings.showOnFocus && !activated && module.is.hidden() && !pageLostFocus) {\n              module.show();\n            }\n          },\n          blur: function (event) {\n            pageLostFocus = document.activeElement === this;\n\n            if (!activated && !pageLostFocus) {\n              module.remove.activeLabel();\n              module.hide();\n            }\n          },\n          mousedown: function () {\n            if (module.is.searchSelection()) {\n              // prevent menu hiding on immediate re-focus\n              willRefocus = true;\n            } else {\n              // prevents focus callback from occurring on mousedown\n              activated = true;\n            }\n          },\n          mouseup: function () {\n            if (module.is.searchSelection()) {\n              // prevent menu hiding on immediate re-focus\n              willRefocus = false;\n            } else {\n              activated = false;\n            }\n          },\n          click: function (event) {\n            var $target = $(event.target); // focus search\n\n            if ($target.is($module)) {\n              if (!module.is.focusedOnSearch()) {\n                module.focusSearch();\n              } else {\n                module.show();\n              }\n            }\n          },\n          search: {\n            focus: function () {\n              activated = true;\n\n              if (module.is.multiple()) {\n                module.remove.activeLabel();\n              }\n\n              if (settings.showOnFocus) {\n                module.search();\n              }\n            },\n            blur: function (event) {\n              pageLostFocus = document.activeElement === this;\n\n              if (!willRefocus) {\n                if (!itemActivated && !pageLostFocus) {\n                  if (settings.forceSelection && module.has.query()) {\n                    module.forceSelection();\n                  }\n\n                  module.hide();\n                }\n              }\n\n              willRefocus = false;\n            }\n          },\n          icon: {\n            click: function (event) {\n              module.toggle();\n              event.stopPropagation();\n            }\n          },\n          text: {\n            focus: function (event) {\n              activated = true;\n              module.focusSearch();\n            }\n          },\n          input: function (event) {\n            if (module.is.multiple() || module.is.searchSelection()) {\n              module.set.filtered();\n            }\n\n            clearTimeout(module.timer);\n            module.timer = setTimeout(module.search, settings.delay.search);\n          },\n          label: {\n            click: function (event) {\n              var $label = $(this),\n                  $labels = $module.find(selector.label),\n                  $activeLabels = $labels.filter('.' + className.active),\n                  $nextActive = $label.nextAll('.' + className.active),\n                  $prevActive = $label.prevAll('.' + className.active),\n                  $range = $nextActive.length > 0 ? $label.nextUntil($nextActive).add($activeLabels).add($label) : $label.prevUntil($prevActive).add($activeLabels).add($label);\n\n              if (event.shiftKey) {\n                $activeLabels.removeClass(className.active);\n                $range.addClass(className.active);\n              } else if (event.ctrlKey) {\n                $label.toggleClass(className.active);\n              } else {\n                $activeLabels.removeClass(className.active);\n                $label.addClass(className.active);\n              }\n\n              settings.onLabelSelect.apply(this, $labels.filter('.' + className.active));\n            }\n          },\n          remove: {\n            click: function () {\n              var $label = $(this).parent();\n\n              if ($label.hasClass(className.active)) {\n                // remove all selected labels\n                module.remove.activeLabels();\n              } else {\n                // remove this label only\n                module.remove.activeLabels($label);\n              }\n            }\n          },\n          test: {\n            toggle: function (event) {\n              var toggleBehavior = module.is.multiple() ? module.show : module.toggle;\n\n              if (module.is.bubbledLabelClick(event)) {\n                return;\n              }\n\n              if (module.determine.eventOnElement(event, toggleBehavior)) {\n                event.preventDefault();\n              }\n            },\n            touch: function (event) {\n              module.determine.eventOnElement(event, function () {\n                if (event.type == 'touchstart') {\n                  module.timer = setTimeout(function () {\n                    module.hide();\n                  }, settings.delay.touch);\n                } else if (event.type == 'touchmove') {\n                  clearTimeout(module.timer);\n                }\n              });\n              event.stopPropagation();\n            },\n            hide: function (event) {\n              module.determine.eventInModule(event, module.hide);\n            }\n          },\n          select: {\n            mutation: function (mutations) {\n              module.debug('<select> modified, recreating menu');\n              module.setup.select();\n            }\n          },\n          menu: {\n            mutation: function (mutations) {\n              var mutation = mutations[0],\n                  $addedNode = mutation.addedNodes ? $(mutation.addedNodes[0]) : $(false),\n                  $removedNode = mutation.removedNodes ? $(mutation.removedNodes[0]) : $(false),\n                  $changedNodes = $addedNode.add($removedNode),\n                  isUserAddition = $changedNodes.is(selector.addition) || $changedNodes.closest(selector.addition).length > 0,\n                  isMessage = $changedNodes.is(selector.message) || $changedNodes.closest(selector.message).length > 0;\n\n              if (isUserAddition || isMessage) {\n                module.debug('Updating item selector cache');\n                module.refreshItems();\n              } else {\n                module.debug('Menu modified, updating selector cache');\n                module.refresh();\n              }\n            },\n            mousedown: function () {\n              itemActivated = true;\n            },\n            mouseup: function () {\n              itemActivated = false;\n            }\n          },\n          item: {\n            mouseenter: function (event) {\n              var $target = $(event.target),\n                  $item = $(this),\n                  $subMenu = $item.children(selector.menu),\n                  $otherMenus = $item.siblings(selector.item).children(selector.menu),\n                  hasSubMenu = $subMenu.length > 0,\n                  isBubbledEvent = $subMenu.find($target).length > 0;\n\n              if (!isBubbledEvent && hasSubMenu) {\n                clearTimeout(module.itemTimer);\n                module.itemTimer = setTimeout(function () {\n                  module.verbose('Showing sub-menu', $subMenu);\n                  $.each($otherMenus, function () {\n                    module.animate.hide(false, $(this));\n                  });\n                  module.animate.show(false, $subMenu);\n                }, settings.delay.show);\n                event.preventDefault();\n              }\n            },\n            mouseleave: function (event) {\n              var $subMenu = $(this).children(selector.menu);\n\n              if ($subMenu.length > 0) {\n                clearTimeout(module.itemTimer);\n                module.itemTimer = setTimeout(function () {\n                  module.verbose('Hiding sub-menu', $subMenu);\n                  module.animate.hide(false, $subMenu);\n                }, settings.delay.hide);\n              }\n            },\n            click: function (event, skipRefocus) {\n              var $choice = $(this),\n                  $target = event ? $(event.target) : $(''),\n                  $subMenu = $choice.find(selector.menu),\n                  text = module.get.choiceText($choice),\n                  value = module.get.choiceValue($choice, text),\n                  hasSubMenu = $subMenu.length > 0,\n                  isBubbledEvent = $subMenu.find($target).length > 0;\n\n              if (!isBubbledEvent && (!hasSubMenu || settings.allowCategorySelection)) {\n                if (module.is.searchSelection()) {\n                  if (settings.allowAdditions) {\n                    module.remove.userAddition();\n                  }\n\n                  module.remove.searchTerm();\n\n                  if (!module.is.focusedOnSearch() && !(skipRefocus == true)) {\n                    module.focusSearch(true);\n                  }\n                }\n\n                if (!settings.useLabels) {\n                  module.remove.filteredItem();\n                  module.set.scrollPosition($choice);\n                }\n\n                module.determine.selectAction.call(this, text, value);\n              }\n            }\n          },\n          document: {\n            // label selection should occur even when element has no focus\n            keydown: function (event) {\n              var pressedKey = event.which,\n                  isShortcutKey = module.is.inObject(pressedKey, keys);\n\n              if (isShortcutKey) {\n                var $label = $module.find(selector.label),\n                    $activeLabel = $label.filter('.' + className.active),\n                    activeValue = $activeLabel.data(metadata.value),\n                    labelIndex = $label.index($activeLabel),\n                    labelCount = $label.length,\n                    hasActiveLabel = $activeLabel.length > 0,\n                    hasMultipleActive = $activeLabel.length > 1,\n                    isFirstLabel = labelIndex === 0,\n                    isLastLabel = labelIndex + 1 == labelCount,\n                    isSearch = module.is.searchSelection(),\n                    isFocusedOnSearch = module.is.focusedOnSearch(),\n                    isFocused = module.is.focused(),\n                    caretAtStart = isFocusedOnSearch && module.get.caretPosition() === 0,\n                    $nextLabel;\n\n                if (isSearch && !hasActiveLabel && !isFocusedOnSearch) {\n                  return;\n                }\n\n                if (pressedKey == keys.leftArrow) {\n                  // activate previous label\n                  if ((isFocused || caretAtStart) && !hasActiveLabel) {\n                    module.verbose('Selecting previous label');\n                    $label.last().addClass(className.active);\n                  } else if (hasActiveLabel) {\n                    if (!event.shiftKey) {\n                      module.verbose('Selecting previous label');\n                      $label.removeClass(className.active);\n                    } else {\n                      module.verbose('Adding previous label to selection');\n                    }\n\n                    if (isFirstLabel && !hasMultipleActive) {\n                      $activeLabel.addClass(className.active);\n                    } else {\n                      $activeLabel.prev(selector.siblingLabel).addClass(className.active).end();\n                    }\n\n                    event.preventDefault();\n                  }\n                } else if (pressedKey == keys.rightArrow) {\n                  // activate first label\n                  if (isFocused && !hasActiveLabel) {\n                    $label.first().addClass(className.active);\n                  } // activate next label\n\n\n                  if (hasActiveLabel) {\n                    if (!event.shiftKey) {\n                      module.verbose('Selecting next label');\n                      $label.removeClass(className.active);\n                    } else {\n                      module.verbose('Adding next label to selection');\n                    }\n\n                    if (isLastLabel) {\n                      if (isSearch) {\n                        if (!isFocusedOnSearch) {\n                          module.focusSearch();\n                        } else {\n                          $label.removeClass(className.active);\n                        }\n                      } else if (hasMultipleActive) {\n                        $activeLabel.next(selector.siblingLabel).addClass(className.active);\n                      } else {\n                        $activeLabel.addClass(className.active);\n                      }\n                    } else {\n                      $activeLabel.next(selector.siblingLabel).addClass(className.active);\n                    }\n\n                    event.preventDefault();\n                  }\n                } else if (pressedKey == keys.deleteKey || pressedKey == keys.backspace) {\n                  if (hasActiveLabel) {\n                    module.verbose('Removing active labels');\n\n                    if (isLastLabel) {\n                      if (isSearch && !isFocusedOnSearch) {\n                        module.focusSearch();\n                      }\n                    }\n\n                    $activeLabel.last().next(selector.siblingLabel).addClass(className.active);\n                    module.remove.activeLabels($activeLabel);\n                    event.preventDefault();\n                  } else if (caretAtStart && !hasActiveLabel && pressedKey == keys.backspace) {\n                    module.verbose('Removing last label on input backspace');\n                    $activeLabel = $label.last().addClass(className.active);\n                    module.remove.activeLabels($activeLabel);\n                  }\n                } else {\n                  $activeLabel.removeClass(className.active);\n                }\n              }\n            }\n          },\n          keydown: function (event) {\n            var pressedKey = event.which,\n                isShortcutKey = module.is.inObject(pressedKey, keys);\n\n            if (isShortcutKey) {\n              var $currentlySelected = $item.not(selector.unselectable).filter('.' + className.selected).eq(0),\n                  $activeItem = $menu.children('.' + className.active).eq(0),\n                  $selectedItem = $currentlySelected.length > 0 ? $currentlySelected : $activeItem,\n                  $visibleItems = $selectedItem.length > 0 ? $selectedItem.siblings(':not(.' + className.filtered + ')').addBack() : $menu.children(':not(.' + className.filtered + ')'),\n                  $subMenu = $selectedItem.children(selector.menu),\n                  $parentMenu = $selectedItem.closest(selector.menu),\n                  inVisibleMenu = $parentMenu.hasClass(className.visible) || $parentMenu.hasClass(className.animating) || $parentMenu.parent(selector.menu).length > 0,\n                  hasSubMenu = $subMenu.length > 0,\n                  hasSelectedItem = $selectedItem.length > 0,\n                  selectedIsSelectable = $selectedItem.not(selector.unselectable).length > 0,\n                  delimiterPressed = pressedKey == keys.delimiter && settings.allowAdditions && module.is.multiple(),\n                  isAdditionWithoutMenu = settings.allowAdditions && settings.hideAdditions && (pressedKey == keys.enter || delimiterPressed) && selectedIsSelectable,\n                  $nextItem,\n                  isSubMenuItem,\n                  newIndex; // allow selection with menu closed\n\n              if (isAdditionWithoutMenu) {\n                module.verbose('Selecting item from keyboard shortcut', $selectedItem);\n                module.event.item.click.call($selectedItem, event);\n\n                if (module.is.searchSelection()) {\n                  module.remove.searchTerm();\n                }\n              } // visible menu keyboard shortcuts\n\n\n              if (module.is.visible()) {\n                // enter (select or open sub-menu)\n                if (pressedKey == keys.enter || delimiterPressed) {\n                  if (pressedKey == keys.enter && hasSelectedItem && hasSubMenu && !settings.allowCategorySelection) {\n                    module.verbose('Pressed enter on unselectable category, opening sub menu');\n                    pressedKey = keys.rightArrow;\n                  } else if (selectedIsSelectable) {\n                    module.verbose('Selecting item from keyboard shortcut', $selectedItem);\n                    module.event.item.click.call($selectedItem, event);\n\n                    if (module.is.searchSelection()) {\n                      module.remove.searchTerm();\n                    }\n                  }\n\n                  event.preventDefault();\n                } // sub-menu actions\n\n\n                if (hasSelectedItem) {\n                  if (pressedKey == keys.leftArrow) {\n                    isSubMenuItem = $parentMenu[0] !== $menu[0];\n\n                    if (isSubMenuItem) {\n                      module.verbose('Left key pressed, closing sub-menu');\n                      module.animate.hide(false, $parentMenu);\n                      $selectedItem.removeClass(className.selected);\n                      $parentMenu.closest(selector.item).addClass(className.selected);\n                      event.preventDefault();\n                    }\n                  } // right arrow (show sub-menu)\n\n\n                  if (pressedKey == keys.rightArrow) {\n                    if (hasSubMenu) {\n                      module.verbose('Right key pressed, opening sub-menu');\n                      module.animate.show(false, $subMenu);\n                      $selectedItem.removeClass(className.selected);\n                      $subMenu.find(selector.item).eq(0).addClass(className.selected);\n                      event.preventDefault();\n                    }\n                  }\n                } // up arrow (traverse menu up)\n\n\n                if (pressedKey == keys.upArrow) {\n                  $nextItem = hasSelectedItem && inVisibleMenu ? $selectedItem.prevAll(selector.item + ':not(' + selector.unselectable + ')').eq(0) : $item.eq(0);\n\n                  if ($visibleItems.index($nextItem) < 0) {\n                    module.verbose('Up key pressed but reached top of current menu');\n                    event.preventDefault();\n                    return;\n                  } else {\n                    module.verbose('Up key pressed, changing active item');\n                    $selectedItem.removeClass(className.selected);\n                    $nextItem.addClass(className.selected);\n                    module.set.scrollPosition($nextItem);\n\n                    if (settings.selectOnKeydown && module.is.single()) {\n                      module.set.selectedItem($nextItem);\n                    }\n                  }\n\n                  event.preventDefault();\n                } // down arrow (traverse menu down)\n\n\n                if (pressedKey == keys.downArrow) {\n                  $nextItem = hasSelectedItem && inVisibleMenu ? $nextItem = $selectedItem.nextAll(selector.item + ':not(' + selector.unselectable + ')').eq(0) : $item.eq(0);\n\n                  if ($nextItem.length === 0) {\n                    module.verbose('Down key pressed but reached bottom of current menu');\n                    event.preventDefault();\n                    return;\n                  } else {\n                    module.verbose('Down key pressed, changing active item');\n                    $item.removeClass(className.selected);\n                    $nextItem.addClass(className.selected);\n                    module.set.scrollPosition($nextItem);\n\n                    if (settings.selectOnKeydown && module.is.single()) {\n                      module.set.activeItem($nextItem);\n                      module.set.selected(module.get.choiceValue($nextItem), $nextItem);\n                    }\n                  }\n\n                  event.preventDefault();\n                } // page down (show next page)\n\n\n                if (pressedKey == keys.pageUp) {\n                  module.scrollPage('up');\n                  event.preventDefault();\n                }\n\n                if (pressedKey == keys.pageDown) {\n                  module.scrollPage('down');\n                  event.preventDefault();\n                } // escape (close menu)\n\n\n                if (pressedKey == keys.escape) {\n                  module.verbose('Escape key pressed, closing dropdown');\n                  module.hide();\n                }\n              } else {\n                // delimiter key\n                if (delimiterPressed) {\n                  event.preventDefault();\n                } // down arrow (open menu)\n\n\n                if (pressedKey == keys.downArrow && !module.is.visible()) {\n                  module.verbose('Down key pressed, showing dropdown');\n                  module.select.firstUnfiltered();\n                  module.show();\n                  event.preventDefault();\n                }\n              }\n            } else {\n              if (!module.has.search()) {\n                module.set.selectedLetter(String.fromCharCode(pressedKey));\n              }\n            }\n          }\n        },\n        trigger: {\n          change: function () {\n            var events = document.createEvent('HTMLEvents'),\n                inputElement = $input[0];\n\n            if (inputElement) {\n              module.verbose('Triggering native change event');\n              events.initEvent('change', true, false);\n              inputElement.dispatchEvent(events);\n            }\n          }\n        },\n        determine: {\n          selectAction: function (text, value) {\n            module.verbose('Determining action', settings.action);\n\n            if ($.isFunction(module.action[settings.action])) {\n              module.verbose('Triggering preset action', settings.action, text, value);\n              module.action[settings.action].call(element, text, value, this);\n            } else if ($.isFunction(settings.action)) {\n              module.verbose('Triggering user action', settings.action, text, value);\n              settings.action.call(element, text, value, this);\n            } else {\n              module.error(error.action, settings.action);\n            }\n          },\n          eventInModule: function (event, callback) {\n            var $target = $(event.target),\n                inDocument = $target.closest(document.documentElement).length > 0,\n                inModule = $target.closest($module).length > 0;\n            callback = $.isFunction(callback) ? callback : function () {};\n\n            if (inDocument && !inModule) {\n              module.verbose('Triggering event', callback);\n              callback();\n              return true;\n            } else {\n              module.verbose('Event occurred in dropdown, canceling callback');\n              return false;\n            }\n          },\n          eventOnElement: function (event, callback) {\n            var $target = $(event.target),\n                $label = $target.closest(selector.siblingLabel),\n                inVisibleDOM = document.body.contains(event.target),\n                notOnLabel = $module.find($label).length === 0,\n                notInMenu = $target.closest($menu).length === 0;\n            callback = $.isFunction(callback) ? callback : function () {};\n\n            if (inVisibleDOM && notOnLabel && notInMenu) {\n              module.verbose('Triggering event', callback);\n              callback();\n              return true;\n            } else {\n              module.verbose('Event occurred in dropdown menu, canceling callback');\n              return false;\n            }\n          }\n        },\n        action: {\n          nothing: function () {},\n          activate: function (text, value, element) {\n            value = value !== undefined ? value : text;\n\n            if (module.can.activate($(element))) {\n              module.set.selected(value, $(element));\n\n              if (module.is.multiple() && !module.is.allFiltered()) {\n                return;\n              } else {\n                module.hideAndClear();\n              }\n            }\n          },\n          select: function (text, value, element) {\n            // mimics action.activate but does not select text\n            module.action.activate.call(element);\n          },\n          combo: function (text, value, element) {\n            value = value !== undefined ? value : text;\n            module.set.selected(value, $(element));\n            module.hideAndClear();\n          },\n          hide: function (text, value, element) {\n            module.set.value(value, text);\n            module.hideAndClear();\n          }\n        },\n        get: {\n          id: function () {\n            return id;\n          },\n          defaultText: function () {\n            return $module.data(metadata.defaultText);\n          },\n          defaultValue: function () {\n            return $module.data(metadata.defaultValue);\n          },\n          placeholderText: function () {\n            return $module.data(metadata.placeholderText) || '';\n          },\n          text: function () {\n            return $text.text();\n          },\n          query: function () {\n            return $.trim($search.val());\n          },\n          searchWidth: function (value) {\n            value = value !== undefined ? value : $search.val();\n            $sizer.text(value); // prevent rounding issues\n\n            return Math.ceil($sizer.width() + 1);\n          },\n          selectionCount: function () {\n            var values = module.get.values(),\n                count;\n            count = module.is.multiple() ? $.isArray(values) ? values.length : 0 : module.get.value() !== '' ? 1 : 0;\n            return count;\n          },\n          transition: function ($subMenu) {\n            return settings.transition == 'auto' ? module.is.upward($subMenu) ? 'slide up' : 'slide down' : settings.transition;\n          },\n          userValues: function () {\n            var values = module.get.values();\n\n            if (!values) {\n              return false;\n            }\n\n            values = $.isArray(values) ? values : [values];\n            return $.grep(values, function (value) {\n              return module.get.item(value) === false;\n            });\n          },\n          uniqueArray: function (array) {\n            return $.grep(array, function (value, index) {\n              return $.inArray(value, array) === index;\n            });\n          },\n          caretPosition: function () {\n            var input = $search.get(0),\n                range,\n                rangeLength;\n\n            if ('selectionStart' in input) {\n              return input.selectionStart;\n            } else if (document.selection) {\n              input.focus();\n              range = document.selection.createRange();\n              rangeLength = range.text.length;\n              range.moveStart('character', -input.value.length);\n              return range.text.length - rangeLength;\n            }\n          },\n          value: function () {\n            var value = $input.length > 0 ? $input.val() : $module.data(metadata.value),\n                isEmptyMultiselect = $.isArray(value) && value.length === 1 && value[0] === ''; // prevents placeholder element from being selected when multiple\n\n            return value === undefined || isEmptyMultiselect ? '' : value;\n          },\n          values: function () {\n            var value = module.get.value();\n\n            if (value === '') {\n              return '';\n            }\n\n            return !module.has.selectInput() && module.is.multiple() ? typeof value == 'string' ? // delimited string\n            value.split(settings.delimiter) : '' : value;\n          },\n          remoteValues: function () {\n            var values = module.get.values(),\n                remoteValues = false;\n\n            if (values) {\n              if (typeof values == 'string') {\n                values = [values];\n              }\n\n              $.each(values, function (index, value) {\n                var name = module.read.remoteData(value);\n                module.verbose('Restoring value from session data', name, value);\n\n                if (name) {\n                  if (!remoteValues) {\n                    remoteValues = {};\n                  }\n\n                  remoteValues[value] = name;\n                }\n              });\n            }\n\n            return remoteValues;\n          },\n          choiceText: function ($choice, preserveHTML) {\n            preserveHTML = preserveHTML !== undefined ? preserveHTML : settings.preserveHTML;\n\n            if ($choice) {\n              if ($choice.find(selector.menu).length > 0) {\n                module.verbose('Retrieving text of element with sub-menu');\n                $choice = $choice.clone();\n                $choice.find(selector.menu).remove();\n                $choice.find(selector.menuIcon).remove();\n              }\n\n              return $choice.data(metadata.text) !== undefined ? $choice.data(metadata.text) : preserveHTML ? $.trim($choice.html()) : $.trim($choice.text());\n            }\n          },\n          choiceValue: function ($choice, choiceText) {\n            choiceText = choiceText || module.get.choiceText($choice);\n\n            if (!$choice) {\n              return false;\n            }\n\n            return $choice.data(metadata.value) !== undefined ? String($choice.data(metadata.value)) : typeof choiceText === 'string' ? $.trim(choiceText.toLowerCase()) : String(choiceText);\n          },\n          inputEvent: function () {\n            var input = $search[0];\n\n            if (input) {\n              return input.oninput !== undefined ? 'input' : input.onpropertychange !== undefined ? 'propertychange' : 'keyup';\n            }\n\n            return false;\n          },\n          selectValues: function () {\n            var select = {};\n            select.values = [];\n            $module.find('option').each(function () {\n              var $option = $(this),\n                  name = $option.html(),\n                  disabled = $option.attr('disabled'),\n                  value = $option.attr('value') !== undefined ? $option.attr('value') : name;\n\n              if (settings.placeholder === 'auto' && value === '') {\n                select.placeholder = name;\n              } else {\n                select.values.push({\n                  name: name,\n                  value: value,\n                  disabled: disabled\n                });\n              }\n            });\n\n            if (settings.placeholder && settings.placeholder !== 'auto') {\n              module.debug('Setting placeholder value to', settings.placeholder);\n              select.placeholder = settings.placeholder;\n            }\n\n            if (settings.sortSelect) {\n              select.values.sort(function (a, b) {\n                return a.name > b.name ? 1 : -1;\n              });\n              module.debug('Retrieved and sorted values from select', select);\n            } else {\n              module.debug('Retrieved values from select', select);\n            }\n\n            return select;\n          },\n          activeItem: function () {\n            return $item.filter('.' + className.active);\n          },\n          selectedItem: function () {\n            var $selectedItem = $item.not(selector.unselectable).filter('.' + className.selected);\n            return $selectedItem.length > 0 ? $selectedItem : $item.eq(0);\n          },\n          itemWithAdditions: function (value) {\n            var $items = module.get.item(value),\n                $userItems = module.create.userChoice(value),\n                hasUserItems = $userItems && $userItems.length > 0;\n\n            if (hasUserItems) {\n              $items = $items.length > 0 ? $items.add($userItems) : $userItems;\n            }\n\n            return $items;\n          },\n          item: function (value, strict) {\n            var $selectedItem = false,\n                shouldSearch,\n                isMultiple;\n            value = value !== undefined ? value : module.get.values() !== undefined ? module.get.values() : module.get.text();\n            shouldSearch = isMultiple ? value.length > 0 : value !== undefined && value !== null;\n            isMultiple = module.is.multiple() && $.isArray(value);\n            strict = value === '' || value === 0 ? true : strict || false;\n\n            if (shouldSearch) {\n              $item.each(function () {\n                var $choice = $(this),\n                    optionText = module.get.choiceText($choice),\n                    optionValue = module.get.choiceValue($choice, optionText); // safe early exit\n\n                if (optionValue === null || optionValue === undefined) {\n                  return;\n                }\n\n                if (isMultiple) {\n                  if ($.inArray(String(optionValue), value) !== -1 || $.inArray(optionText, value) !== -1) {\n                    $selectedItem = $selectedItem ? $selectedItem.add($choice) : $choice;\n                  }\n                } else if (strict) {\n                  module.verbose('Ambiguous dropdown value using strict type check', $choice, value);\n\n                  if (optionValue === value || optionText === value) {\n                    $selectedItem = $choice;\n                    return true;\n                  }\n                } else {\n                  if (String(optionValue) == String(value) || optionText == value) {\n                    module.verbose('Found select item by value', optionValue, value);\n                    $selectedItem = $choice;\n                    return true;\n                  }\n                }\n              });\n            }\n\n            return $selectedItem;\n          }\n        },\n        check: {\n          maxSelections: function (selectionCount) {\n            if (settings.maxSelections) {\n              selectionCount = selectionCount !== undefined ? selectionCount : module.get.selectionCount();\n\n              if (selectionCount >= settings.maxSelections) {\n                module.debug('Maximum selection count reached');\n\n                if (settings.useLabels) {\n                  $item.addClass(className.filtered);\n                  module.add.message(message.maxSelections);\n                }\n\n                return true;\n              } else {\n                module.verbose('No longer at maximum selection count');\n                module.remove.message();\n                module.remove.filteredItem();\n\n                if (module.is.searchSelection()) {\n                  module.filterItems();\n                }\n\n                return false;\n              }\n            }\n\n            return true;\n          }\n        },\n        restore: {\n          defaults: function () {\n            module.clear();\n            module.restore.defaultText();\n            module.restore.defaultValue();\n          },\n          defaultText: function () {\n            var defaultText = module.get.defaultText(),\n                placeholderText = module.get.placeholderText;\n\n            if (defaultText === placeholderText) {\n              module.debug('Restoring default placeholder text', defaultText);\n              module.set.placeholderText(defaultText);\n            } else {\n              module.debug('Restoring default text', defaultText);\n              module.set.text(defaultText);\n            }\n          },\n          placeholderText: function () {\n            module.set.placeholderText();\n          },\n          defaultValue: function () {\n            var defaultValue = module.get.defaultValue();\n\n            if (defaultValue !== undefined) {\n              module.debug('Restoring default value', defaultValue);\n\n              if (defaultValue !== '') {\n                module.set.value(defaultValue);\n                module.set.selected();\n              } else {\n                module.remove.activeItem();\n                module.remove.selectedItem();\n              }\n            }\n          },\n          labels: function () {\n            if (settings.allowAdditions) {\n              if (!settings.useLabels) {\n                module.error(error.labels);\n                settings.useLabels = true;\n              }\n\n              module.debug('Restoring selected values');\n              module.create.userLabels();\n            }\n\n            module.check.maxSelections();\n          },\n          selected: function () {\n            module.restore.values();\n\n            if (module.is.multiple()) {\n              module.debug('Restoring previously selected values and labels');\n              module.restore.labels();\n            } else {\n              module.debug('Restoring previously selected values');\n            }\n          },\n          values: function () {\n            // prevents callbacks from occurring on initial load\n            module.set.initialLoad();\n\n            if (settings.apiSettings && settings.saveRemoteData && module.get.remoteValues()) {\n              module.restore.remoteValues();\n            } else {\n              module.set.selected();\n            }\n\n            module.remove.initialLoad();\n          },\n          remoteValues: function () {\n            var values = module.get.remoteValues();\n            module.debug('Recreating selected from session data', values);\n\n            if (values) {\n              if (module.is.single()) {\n                $.each(values, function (value, name) {\n                  module.set.text(name);\n                });\n              } else {\n                $.each(values, function (value, name) {\n                  module.add.label(value, name);\n                });\n              }\n            }\n          }\n        },\n        read: {\n          remoteData: function (value) {\n            var name;\n\n            if (window.Storage === undefined) {\n              module.error(error.noStorage);\n              return;\n            }\n\n            name = sessionStorage.getItem(value);\n            return name !== undefined ? name : false;\n          }\n        },\n        save: {\n          defaults: function () {\n            module.save.defaultText();\n            module.save.placeholderText();\n            module.save.defaultValue();\n          },\n          defaultValue: function () {\n            var value = module.get.value();\n            module.verbose('Saving default value as', value);\n            $module.data(metadata.defaultValue, value);\n          },\n          defaultText: function () {\n            var text = module.get.text();\n            module.verbose('Saving default text as', text);\n            $module.data(metadata.defaultText, text);\n          },\n          placeholderText: function () {\n            var text;\n\n            if (settings.placeholder !== false && $text.hasClass(className.placeholder)) {\n              text = module.get.text();\n              module.verbose('Saving placeholder text as', text);\n              $module.data(metadata.placeholderText, text);\n            }\n          },\n          remoteData: function (name, value) {\n            if (window.Storage === undefined) {\n              module.error(error.noStorage);\n              return;\n            }\n\n            module.verbose('Saving remote data to session storage', value, name);\n            sessionStorage.setItem(value, name);\n          }\n        },\n        clear: function () {\n          if (module.is.multiple()) {\n            module.remove.labels();\n          } else {\n            module.remove.activeItem();\n            module.remove.selectedItem();\n          }\n\n          module.set.placeholderText();\n          module.clearValue();\n        },\n        clearValue: function () {\n          module.set.value('');\n        },\n        scrollPage: function (direction, $selectedItem) {\n          var $currentItem = $selectedItem || module.get.selectedItem(),\n              $menu = $currentItem.closest(selector.menu),\n              menuHeight = $menu.outerHeight(),\n              currentScroll = $menu.scrollTop(),\n              itemHeight = $item.eq(0).outerHeight(),\n              itemsPerPage = Math.floor(menuHeight / itemHeight),\n              maxScroll = $menu.prop('scrollHeight'),\n              newScroll = direction == 'up' ? currentScroll - itemHeight * itemsPerPage : currentScroll + itemHeight * itemsPerPage,\n              $selectableItem = $item.not(selector.unselectable),\n              isWithinRange,\n              $nextSelectedItem,\n              elementIndex;\n          elementIndex = direction == 'up' ? $selectableItem.index($currentItem) - itemsPerPage : $selectableItem.index($currentItem) + itemsPerPage;\n          isWithinRange = direction == 'up' ? elementIndex >= 0 : elementIndex < $selectableItem.length;\n          $nextSelectedItem = isWithinRange ? $selectableItem.eq(elementIndex) : direction == 'up' ? $selectableItem.first() : $selectableItem.last();\n\n          if ($nextSelectedItem.length > 0) {\n            module.debug('Scrolling page', direction, $nextSelectedItem);\n            $currentItem.removeClass(className.selected);\n            $nextSelectedItem.addClass(className.selected);\n\n            if (settings.selectOnKeydown && module.is.single()) {\n              module.set.selectedItem($nextSelectedItem);\n            }\n\n            $menu.scrollTop(newScroll);\n          }\n        },\n        set: {\n          filtered: function () {\n            var isMultiple = module.is.multiple(),\n                isSearch = module.is.searchSelection(),\n                isSearchMultiple = isMultiple && isSearch,\n                searchValue = isSearch ? module.get.query() : '',\n                hasSearchValue = typeof searchValue === 'string' && searchValue.length > 0,\n                searchWidth = module.get.searchWidth(),\n                valueIsSet = searchValue !== '';\n\n            if (isMultiple && hasSearchValue) {\n              module.verbose('Adjusting input width', searchWidth, settings.glyphWidth);\n              $search.css('width', searchWidth);\n            }\n\n            if (hasSearchValue || isSearchMultiple && valueIsSet) {\n              module.verbose('Hiding placeholder text');\n              $text.addClass(className.filtered);\n            } else if (!isMultiple || isSearchMultiple && !valueIsSet) {\n              module.verbose('Showing placeholder text');\n              $text.removeClass(className.filtered);\n            }\n          },\n          empty: function () {\n            $module.addClass(className.empty);\n          },\n          loading: function () {\n            $module.addClass(className.loading);\n          },\n          placeholderText: function (text) {\n            text = text || module.get.placeholderText();\n            module.debug('Setting placeholder text', text);\n            module.set.text(text);\n            $text.addClass(className.placeholder);\n          },\n          tabbable: function () {\n            if (module.has.search()) {\n              module.debug('Added tabindex to searchable dropdown');\n              $search.val('').attr('tabindex', 0);\n              $menu.attr('tabindex', -1);\n            } else {\n              module.debug('Added tabindex to dropdown');\n\n              if ($module.attr('tabindex') === undefined) {\n                $module.attr('tabindex', 0);\n                $menu.attr('tabindex', -1);\n              }\n            }\n          },\n          initialLoad: function () {\n            module.verbose('Setting initial load');\n            initialLoad = true;\n          },\n          activeItem: function ($item) {\n            if (settings.allowAdditions && $item.filter(selector.addition).length > 0) {\n              $item.addClass(className.filtered);\n            } else {\n              $item.addClass(className.active);\n            }\n          },\n          scrollPosition: function ($item, forceScroll) {\n            var edgeTolerance = 5,\n                $menu,\n                hasActive,\n                offset,\n                itemHeight,\n                itemOffset,\n                menuOffset,\n                menuScroll,\n                menuHeight,\n                abovePage,\n                belowPage;\n            $item = $item || module.get.selectedItem();\n            $menu = $item.closest(selector.menu);\n            hasActive = $item && $item.length > 0;\n            forceScroll = forceScroll !== undefined ? forceScroll : false;\n\n            if ($item && $menu.length > 0 && hasActive) {\n              itemOffset = $item.position().top;\n              $menu.addClass(className.loading);\n              menuScroll = $menu.scrollTop();\n              menuOffset = $menu.offset().top;\n              itemOffset = $item.offset().top;\n              offset = menuScroll - menuOffset + itemOffset;\n\n              if (!forceScroll) {\n                menuHeight = $menu.height();\n                belowPage = menuScroll + menuHeight < offset + edgeTolerance;\n                abovePage = offset - edgeTolerance < menuScroll;\n              }\n\n              module.debug('Scrolling to active item', offset);\n\n              if (forceScroll || abovePage || belowPage) {\n                $menu.scrollTop(offset);\n              }\n\n              $menu.removeClass(className.loading);\n            }\n          },\n          text: function (text) {\n            if (settings.action !== 'select') {\n              if (settings.action == 'combo') {\n                module.debug('Changing combo button text', text, $combo);\n\n                if (settings.preserveHTML) {\n                  $combo.html(text);\n                } else {\n                  $combo.text(text);\n                }\n              } else {\n                if (text !== module.get.placeholderText()) {\n                  $text.removeClass(className.placeholder);\n                }\n\n                module.debug('Changing text', text, $text);\n                $text.removeClass(className.filtered);\n\n                if (settings.preserveHTML) {\n                  $text.html(text);\n                } else {\n                  $text.text(text);\n                }\n              }\n            }\n          },\n          selectedItem: function ($item) {\n            module.debug('Setting user selection to item', $item);\n            module.remove.activeItem();\n            module.set.activeItem($item);\n            module.set.selected(module.get.choiceValue($item), $item);\n          },\n          selectedLetter: function (letter) {\n            var $selectedItem = $item.filter('.' + className.selected),\n                alreadySelectedLetter = $selectedItem.length > 0 && module.has.firstLetter($selectedItem, letter),\n                $nextValue = false,\n                $nextItem; // check next of same letter\n\n            if (alreadySelectedLetter) {\n              $nextItem = $selectedItem.nextAll($item).eq(0);\n\n              if (module.has.firstLetter($nextItem, letter)) {\n                $nextValue = $nextItem;\n              }\n            } // check all values\n\n\n            if (!$nextValue) {\n              $item.each(function () {\n                if (module.has.firstLetter($(this), letter)) {\n                  $nextValue = $(this);\n                  return false;\n                }\n              });\n            } // set next value\n\n\n            if ($nextValue) {\n              module.verbose('Scrolling to next value with letter', letter);\n              module.set.scrollPosition($nextValue);\n              $selectedItem.removeClass(className.selected);\n              $nextValue.addClass(className.selected);\n\n              if (settings.selectOnKeydown && module.is.single()) {\n                module.set.selectedItem($nextValue);\n              }\n            }\n          },\n          direction: function ($menu) {\n            if (settings.direction == 'auto') {\n              if (module.is.onScreen($menu)) {\n                module.remove.upward($menu);\n              } else {\n                module.set.upward($menu);\n              }\n            } else if (settings.direction == 'upward') {\n              module.set.upward($menu);\n            }\n          },\n          upward: function ($menu) {\n            var $element = $menu || $module;\n            $element.addClass(className.upward);\n          },\n          value: function (value, text, $selected) {\n            var escapedValue = module.escape.value(value),\n                hasInput = $input.length > 0,\n                isAddition = !module.has.value(value),\n                currentValue = module.get.values(),\n                stringValue = value !== undefined ? String(value) : value,\n                newValue;\n\n            if (hasInput) {\n              if (!settings.allowReselection && stringValue == currentValue) {\n                module.verbose('Skipping value update already same value', value, currentValue);\n\n                if (!module.is.initialLoad()) {\n                  return;\n                }\n              }\n\n              if (module.is.single() && module.has.selectInput() && module.can.extendSelect()) {\n                module.debug('Adding user option', value);\n                module.add.optionValue(value);\n              }\n\n              module.debug('Updating input value', escapedValue, currentValue);\n              internalChange = true;\n              $input.val(escapedValue);\n\n              if (settings.fireOnInit === false && module.is.initialLoad()) {\n                module.debug('Input native change event ignored on initial load');\n              } else {\n                module.trigger.change();\n              }\n\n              internalChange = false;\n            } else {\n              module.verbose('Storing value in metadata', escapedValue, $input);\n\n              if (escapedValue !== currentValue) {\n                $module.data(metadata.value, stringValue);\n              }\n            }\n\n            if (settings.fireOnInit === false && module.is.initialLoad()) {\n              module.verbose('No callback on initial load', settings.onChange);\n            } else {\n              settings.onChange.call(element, value, text, $selected);\n            }\n          },\n          active: function () {\n            $module.addClass(className.active);\n          },\n          multiple: function () {\n            $module.addClass(className.multiple);\n          },\n          visible: function () {\n            $module.addClass(className.visible);\n          },\n          exactly: function (value, $selectedItem) {\n            module.debug('Setting selected to exact values');\n            module.clear();\n            module.set.selected(value, $selectedItem);\n          },\n          selected: function (value, $selectedItem) {\n            var isMultiple = module.is.multiple(),\n                $userSelectedItem;\n            $selectedItem = settings.allowAdditions ? $selectedItem || module.get.itemWithAdditions(value) : $selectedItem || module.get.item(value);\n\n            if (!$selectedItem) {\n              return;\n            }\n\n            module.debug('Setting selected menu item to', $selectedItem);\n\n            if (module.is.multiple()) {\n              module.remove.searchWidth();\n            }\n\n            if (module.is.single()) {\n              module.remove.activeItem();\n              module.remove.selectedItem();\n            } else if (settings.useLabels) {\n              module.remove.selectedItem();\n            } // select each item\n\n\n            $selectedItem.each(function () {\n              var $selected = $(this),\n                  selectedText = module.get.choiceText($selected),\n                  selectedValue = module.get.choiceValue($selected, selectedText),\n                  isFiltered = $selected.hasClass(className.filtered),\n                  isActive = $selected.hasClass(className.active),\n                  isUserValue = $selected.hasClass(className.addition),\n                  shouldAnimate = isMultiple && $selectedItem.length == 1;\n\n              if (isMultiple) {\n                if (!isActive || isUserValue) {\n                  if (settings.apiSettings && settings.saveRemoteData) {\n                    module.save.remoteData(selectedText, selectedValue);\n                  }\n\n                  if (settings.useLabels) {\n                    module.add.value(selectedValue, selectedText, $selected);\n                    module.add.label(selectedValue, selectedText, shouldAnimate);\n                    module.set.activeItem($selected);\n                    module.filterActive();\n                    module.select.nextAvailable($selectedItem);\n                  } else {\n                    module.add.value(selectedValue, selectedText, $selected);\n                    module.set.text(module.add.variables(message.count));\n                    module.set.activeItem($selected);\n                  }\n                } else if (!isFiltered) {\n                  module.debug('Selected active value, removing label');\n                  module.remove.selected(selectedValue);\n                }\n              } else {\n                if (settings.apiSettings && settings.saveRemoteData) {\n                  module.save.remoteData(selectedText, selectedValue);\n                }\n\n                module.set.text(selectedText);\n                module.set.value(selectedValue, selectedText, $selected);\n                $selected.addClass(className.active).addClass(className.selected);\n              }\n            });\n          }\n        },\n        add: {\n          label: function (value, text, shouldAnimate) {\n            var $next = module.is.searchSelection() ? $search : $text,\n                escapedValue = module.escape.value(value),\n                $label;\n            $label = $('<a />').addClass(className.label).attr('data-value', escapedValue).html(templates.label(escapedValue, text));\n            $label = settings.onLabelCreate.call($label, escapedValue, text);\n\n            if (module.has.label(value)) {\n              module.debug('Label already exists, skipping', escapedValue);\n              return;\n            }\n\n            if (settings.label.variation) {\n              $label.addClass(settings.label.variation);\n            }\n\n            if (shouldAnimate === true) {\n              module.debug('Animating in label', $label);\n              $label.addClass(className.hidden).insertBefore($next).transition(settings.label.transition, settings.label.duration);\n            } else {\n              module.debug('Adding selection label', $label);\n              $label.insertBefore($next);\n            }\n          },\n          message: function (message) {\n            var $message = $menu.children(selector.message),\n                html = settings.templates.message(module.add.variables(message));\n\n            if ($message.length > 0) {\n              $message.html(html);\n            } else {\n              $message = $('<div/>').html(html).addClass(className.message).appendTo($menu);\n            }\n          },\n          optionValue: function (value) {\n            var escapedValue = module.escape.value(value),\n                $option = $input.find('option[value=\"' + escapedValue + '\"]'),\n                hasOption = $option.length > 0;\n\n            if (hasOption) {\n              return;\n            } // temporarily disconnect observer\n\n\n            module.disconnect.selectObserver();\n\n            if (module.is.single()) {\n              module.verbose('Removing previous user addition');\n              $input.find('option.' + className.addition).remove();\n            }\n\n            $('<option/>').prop('value', escapedValue).addClass(className.addition).html(value).appendTo($input);\n            module.verbose('Adding user addition as an <option>', value);\n            module.observe.select();\n          },\n          userSuggestion: function (value) {\n            var $addition = $menu.children(selector.addition),\n                $existingItem = module.get.item(value),\n                alreadyHasValue = $existingItem && $existingItem.not(selector.addition).length,\n                hasUserSuggestion = $addition.length > 0,\n                html;\n\n            if (settings.useLabels && module.has.maxSelections()) {\n              return;\n            }\n\n            if (value === '' || alreadyHasValue) {\n              $addition.remove();\n              return;\n            }\n\n            if (hasUserSuggestion) {\n              $addition.data(metadata.value, value).data(metadata.text, value).attr('data-' + metadata.value, value).attr('data-' + metadata.text, value).removeClass(className.filtered);\n\n              if (!settings.hideAdditions) {\n                html = settings.templates.addition(module.add.variables(message.addResult, value));\n                $addition.html(html);\n              }\n\n              module.verbose('Replacing user suggestion with new value', $addition);\n            } else {\n              $addition = module.create.userChoice(value);\n              $addition.prependTo($menu);\n              module.verbose('Adding item choice to menu corresponding with user choice addition', $addition);\n            }\n\n            if (!settings.hideAdditions || module.is.allFiltered()) {\n              $addition.addClass(className.selected).siblings().removeClass(className.selected);\n            }\n\n            module.refreshItems();\n          },\n          variables: function (message, term) {\n            var hasCount = message.search('{count}') !== -1,\n                hasMaxCount = message.search('{maxCount}') !== -1,\n                hasTerm = message.search('{term}') !== -1,\n                values,\n                count,\n                query;\n            module.verbose('Adding templated variables to message', message);\n\n            if (hasCount) {\n              count = module.get.selectionCount();\n              message = message.replace('{count}', count);\n            }\n\n            if (hasMaxCount) {\n              count = module.get.selectionCount();\n              message = message.replace('{maxCount}', settings.maxSelections);\n            }\n\n            if (hasTerm) {\n              query = term || module.get.query();\n              message = message.replace('{term}', query);\n            }\n\n            return message;\n          },\n          value: function (addedValue, addedText, $selectedItem) {\n            var currentValue = module.get.values(),\n                newValue;\n\n            if (addedValue === '') {\n              module.debug('Cannot select blank values from multiselect');\n              return;\n            } // extend current array\n\n\n            if ($.isArray(currentValue)) {\n              newValue = currentValue.concat([addedValue]);\n              newValue = module.get.uniqueArray(newValue);\n            } else {\n              newValue = [addedValue];\n            } // add values\n\n\n            if (module.has.selectInput()) {\n              if (module.can.extendSelect()) {\n                module.debug('Adding value to select', addedValue, newValue, $input);\n                module.add.optionValue(addedValue);\n              }\n            } else {\n              newValue = newValue.join(settings.delimiter);\n              module.debug('Setting hidden input to delimited value', newValue, $input);\n            }\n\n            if (settings.fireOnInit === false && module.is.initialLoad()) {\n              module.verbose('Skipping onadd callback on initial load', settings.onAdd);\n            } else {\n              settings.onAdd.call(element, addedValue, addedText, $selectedItem);\n            }\n\n            module.set.value(newValue, addedValue, addedText, $selectedItem);\n            module.check.maxSelections();\n          }\n        },\n        remove: {\n          active: function () {\n            $module.removeClass(className.active);\n          },\n          activeLabel: function () {\n            $module.find(selector.label).removeClass(className.active);\n          },\n          empty: function () {\n            $module.removeClass(className.empty);\n          },\n          loading: function () {\n            $module.removeClass(className.loading);\n          },\n          initialLoad: function () {\n            initialLoad = false;\n          },\n          upward: function ($menu) {\n            var $element = $menu || $module;\n            $element.removeClass(className.upward);\n          },\n          visible: function () {\n            $module.removeClass(className.visible);\n          },\n          activeItem: function () {\n            $item.removeClass(className.active);\n          },\n          filteredItem: function () {\n            if (settings.useLabels && module.has.maxSelections()) {\n              return;\n            }\n\n            if (settings.useLabels && module.is.multiple()) {\n              $item.not('.' + className.active).removeClass(className.filtered);\n            } else {\n              $item.removeClass(className.filtered);\n            }\n\n            module.remove.empty();\n          },\n          optionValue: function (value) {\n            var escapedValue = module.escape.value(value),\n                $option = $input.find('option[value=\"' + escapedValue + '\"]'),\n                hasOption = $option.length > 0;\n\n            if (!hasOption || !$option.hasClass(className.addition)) {\n              return;\n            } // temporarily disconnect observer\n\n\n            if (selectObserver) {\n              selectObserver.disconnect();\n              module.verbose('Temporarily disconnecting mutation observer');\n            }\n\n            $option.remove();\n            module.verbose('Removing user addition as an <option>', escapedValue);\n\n            if (selectObserver) {\n              selectObserver.observe($input[0], {\n                childList: true,\n                subtree: true\n              });\n            }\n          },\n          message: function () {\n            $menu.children(selector.message).remove();\n          },\n          searchWidth: function () {\n            $search.css('width', '');\n          },\n          searchTerm: function () {\n            module.verbose('Cleared search term');\n            $search.val('');\n            module.set.filtered();\n          },\n          userAddition: function () {\n            $item.filter(selector.addition).remove();\n          },\n          selected: function (value, $selectedItem) {\n            $selectedItem = settings.allowAdditions ? $selectedItem || module.get.itemWithAdditions(value) : $selectedItem || module.get.item(value);\n\n            if (!$selectedItem) {\n              return false;\n            }\n\n            $selectedItem.each(function () {\n              var $selected = $(this),\n                  selectedText = module.get.choiceText($selected),\n                  selectedValue = module.get.choiceValue($selected, selectedText);\n\n              if (module.is.multiple()) {\n                if (settings.useLabels) {\n                  module.remove.value(selectedValue, selectedText, $selected);\n                  module.remove.label(selectedValue);\n                } else {\n                  module.remove.value(selectedValue, selectedText, $selected);\n\n                  if (module.get.selectionCount() === 0) {\n                    module.set.placeholderText();\n                  } else {\n                    module.set.text(module.add.variables(message.count));\n                  }\n                }\n              } else {\n                module.remove.value(selectedValue, selectedText, $selected);\n              }\n\n              $selected.removeClass(className.filtered).removeClass(className.active);\n\n              if (settings.useLabels) {\n                $selected.removeClass(className.selected);\n              }\n            });\n          },\n          selectedItem: function () {\n            $item.removeClass(className.selected);\n          },\n          value: function (removedValue, removedText, $removedItem) {\n            var values = module.get.values(),\n                newValue;\n\n            if (module.has.selectInput()) {\n              module.verbose('Input is <select> removing selected option', removedValue);\n              newValue = module.remove.arrayValue(removedValue, values);\n              module.remove.optionValue(removedValue);\n            } else {\n              module.verbose('Removing from delimited values', removedValue);\n              newValue = module.remove.arrayValue(removedValue, values);\n              newValue = newValue.join(settings.delimiter);\n            }\n\n            if (settings.fireOnInit === false && module.is.initialLoad()) {\n              module.verbose('No callback on initial load', settings.onRemove);\n            } else {\n              settings.onRemove.call(element, removedValue, removedText, $removedItem);\n            }\n\n            module.set.value(newValue, removedText, $removedItem);\n            module.check.maxSelections();\n          },\n          arrayValue: function (removedValue, values) {\n            if (!$.isArray(values)) {\n              values = [values];\n            }\n\n            values = $.grep(values, function (value) {\n              return removedValue != value;\n            });\n            module.verbose('Removed value from delimited string', removedValue, values);\n            return values;\n          },\n          label: function (value, shouldAnimate) {\n            var $labels = $module.find(selector.label),\n                $removedLabel = $labels.filter('[data-value=\"' + value + '\"]');\n            module.verbose('Removing label', $removedLabel);\n            $removedLabel.remove();\n          },\n          activeLabels: function ($activeLabels) {\n            $activeLabels = $activeLabels || $module.find(selector.label).filter('.' + className.active);\n            module.verbose('Removing active label selections', $activeLabels);\n            module.remove.labels($activeLabels);\n          },\n          labels: function ($labels) {\n            $labels = $labels || $module.find(selector.label);\n            module.verbose('Removing labels', $labels);\n            $labels.each(function () {\n              var $label = $(this),\n                  value = $label.data(metadata.value),\n                  stringValue = value !== undefined ? String(value) : value,\n                  isUserValue = module.is.userValue(stringValue);\n\n              if (settings.onLabelRemove.call($label, value) === false) {\n                module.debug('Label remove callback cancelled removal');\n                return;\n              }\n\n              module.remove.message();\n\n              if (isUserValue) {\n                module.remove.value(stringValue);\n                module.remove.label(stringValue);\n              } else {\n                // selected will also remove label\n                module.remove.selected(stringValue);\n              }\n            });\n          },\n          tabbable: function () {\n            if (module.has.search()) {\n              module.debug('Searchable dropdown initialized');\n              $search.removeAttr('tabindex');\n              $menu.removeAttr('tabindex');\n            } else {\n              module.debug('Simple selection dropdown initialized');\n              $module.removeAttr('tabindex');\n              $menu.removeAttr('tabindex');\n            }\n          }\n        },\n        has: {\n          menuSearch: function () {\n            return module.has.search() && $search.closest($menu).length > 0;\n          },\n          search: function () {\n            return $search.length > 0;\n          },\n          sizer: function () {\n            return $sizer.length > 0;\n          },\n          selectInput: function () {\n            return $input.is('select');\n          },\n          minCharacters: function (searchTerm) {\n            if (settings.minCharacters) {\n              searchTerm = searchTerm !== undefined ? String(searchTerm) : String(module.get.query());\n              return searchTerm.length >= settings.minCharacters;\n            }\n\n            return true;\n          },\n          firstLetter: function ($item, letter) {\n            var text, firstLetter;\n\n            if (!$item || $item.length === 0 || typeof letter !== 'string') {\n              return false;\n            }\n\n            text = module.get.choiceText($item, false);\n            letter = letter.toLowerCase();\n            firstLetter = String(text).charAt(0).toLowerCase();\n            return letter == firstLetter;\n          },\n          input: function () {\n            return $input.length > 0;\n          },\n          items: function () {\n            return $item.length > 0;\n          },\n          menu: function () {\n            return $menu.length > 0;\n          },\n          message: function () {\n            return $menu.children(selector.message).length !== 0;\n          },\n          label: function (value) {\n            var escapedValue = module.escape.value(value),\n                $labels = $module.find(selector.label);\n            return $labels.filter('[data-value=\"' + escapedValue + '\"]').length > 0;\n          },\n          maxSelections: function () {\n            return settings.maxSelections && module.get.selectionCount() >= settings.maxSelections;\n          },\n          allResultsFiltered: function () {\n            var $normalResults = $item.not(selector.addition);\n            return $normalResults.filter(selector.unselectable).length === $normalResults.length;\n          },\n          userSuggestion: function () {\n            return $menu.children(selector.addition).length > 0;\n          },\n          query: function () {\n            return module.get.query() !== '';\n          },\n          value: function (value) {\n            var values = module.get.values(),\n                hasValue = $.isArray(values) ? values && $.inArray(value, values) !== -1 : values == value;\n            return hasValue ? true : false;\n          }\n        },\n        is: {\n          active: function () {\n            return $module.hasClass(className.active);\n          },\n          bubbledLabelClick: function (event) {\n            return $(event.target).is('select, input') && $module.closest('label').length > 0;\n          },\n          alreadySetup: function () {\n            return $module.is('select') && $module.parent(selector.dropdown).length > 0 && $module.prev().length === 0;\n          },\n          animating: function ($subMenu) {\n            return $subMenu ? $subMenu.transition && $subMenu.transition('is animating') : $menu.transition && $menu.transition('is animating');\n          },\n          disabled: function () {\n            return $module.hasClass(className.disabled);\n          },\n          focused: function () {\n            return document.activeElement === $module[0];\n          },\n          focusedOnSearch: function () {\n            return document.activeElement === $search[0];\n          },\n          allFiltered: function () {\n            return (module.is.multiple() || module.has.search()) && !(settings.hideAdditions == false && module.has.userSuggestion()) && !module.has.message() && module.has.allResultsFiltered();\n          },\n          hidden: function ($subMenu) {\n            return !module.is.visible($subMenu);\n          },\n          initialLoad: function () {\n            return initialLoad;\n          },\n          onScreen: function ($subMenu) {\n            var $currentMenu = $subMenu || $menu,\n                canOpenDownward = true,\n                onScreen = {},\n                calculations;\n            $currentMenu.addClass(className.loading);\n            calculations = {\n              context: {\n                scrollTop: $context.scrollTop(),\n                height: $context.outerHeight()\n              },\n              menu: {\n                offset: $currentMenu.offset(),\n                height: $currentMenu.outerHeight()\n              }\n            };\n            onScreen = {\n              above: calculations.context.scrollTop <= calculations.menu.offset.top - calculations.menu.height,\n              below: calculations.context.scrollTop + calculations.context.height >= calculations.menu.offset.top + calculations.menu.height\n            };\n\n            if (onScreen.below) {\n              module.verbose('Dropdown can fit in context downward', onScreen);\n              canOpenDownward = true;\n            } else if (!onScreen.below && !onScreen.above) {\n              module.verbose('Dropdown cannot fit in either direction, favoring downward', onScreen);\n              canOpenDownward = true;\n            } else {\n              module.verbose('Dropdown cannot fit below, opening upward', onScreen);\n              canOpenDownward = false;\n            }\n\n            $currentMenu.removeClass(className.loading);\n            return canOpenDownward;\n          },\n          inObject: function (needle, object) {\n            var found = false;\n            $.each(object, function (index, property) {\n              if (property == needle) {\n                found = true;\n                return true;\n              }\n            });\n            return found;\n          },\n          multiple: function () {\n            return $module.hasClass(className.multiple);\n          },\n          single: function () {\n            return !module.is.multiple();\n          },\n          selectMutation: function (mutations) {\n            var selectChanged = false;\n            $.each(mutations, function (index, mutation) {\n              if (mutation.target && $(mutation.target).is('select')) {\n                selectChanged = true;\n                return true;\n              }\n            });\n            return selectChanged;\n          },\n          search: function () {\n            return $module.hasClass(className.search);\n          },\n          searchSelection: function () {\n            return module.has.search() && $search.parent(selector.dropdown).length === 1;\n          },\n          selection: function () {\n            return $module.hasClass(className.selection);\n          },\n          userValue: function (value) {\n            return $.inArray(value, module.get.userValues()) !== -1;\n          },\n          upward: function ($menu) {\n            var $element = $menu || $module;\n            return $element.hasClass(className.upward);\n          },\n          visible: function ($subMenu) {\n            return $subMenu ? $subMenu.hasClass(className.visible) : $menu.hasClass(className.visible);\n          }\n        },\n        can: {\n          activate: function ($item) {\n            if (settings.useLabels) {\n              return true;\n            }\n\n            if (!module.has.maxSelections()) {\n              return true;\n            }\n\n            if (module.has.maxSelections() && $item.hasClass(className.active)) {\n              return true;\n            }\n\n            return false;\n          },\n          click: function () {\n            return hasTouch || settings.on == 'click';\n          },\n          extendSelect: function () {\n            return settings.allowAdditions || settings.apiSettings;\n          },\n          show: function () {\n            return !module.is.disabled() && (module.has.items() || module.has.message());\n          },\n          useAPI: function () {\n            return $.fn.api !== undefined;\n          }\n        },\n        animate: {\n          show: function (callback, $subMenu) {\n            var $currentMenu = $subMenu || $menu,\n                start = $subMenu ? function () {} : function () {\n              module.hideSubMenus();\n              module.hideOthers();\n              module.set.active();\n            },\n                transition;\n            callback = $.isFunction(callback) ? callback : function () {};\n            module.verbose('Doing menu show animation', $currentMenu);\n            module.set.direction($subMenu);\n            transition = module.get.transition($subMenu);\n\n            if (module.is.selection()) {\n              module.set.scrollPosition(module.get.selectedItem(), true);\n            }\n\n            if (module.is.hidden($currentMenu) || module.is.animating($currentMenu)) {\n              if (transition == 'none') {\n                start();\n                $currentMenu.transition('show');\n                callback.call(element);\n              } else if ($.fn.transition !== undefined && $module.transition('is supported')) {\n                $currentMenu.transition({\n                  animation: transition + ' in',\n                  debug: settings.debug,\n                  verbose: settings.verbose,\n                  duration: settings.duration,\n                  queue: true,\n                  onStart: start,\n                  onComplete: function () {\n                    callback.call(element);\n                  }\n                });\n              } else {\n                module.error(error.noTransition, transition);\n              }\n            }\n          },\n          hide: function (callback, $subMenu) {\n            var $currentMenu = $subMenu || $menu,\n                duration = $subMenu ? settings.duration * 0.9 : settings.duration,\n                start = $subMenu ? function () {} : function () {\n              if (module.can.click()) {\n                module.unbind.intent();\n              }\n\n              module.remove.active();\n            },\n                transition = module.get.transition($subMenu);\n            callback = $.isFunction(callback) ? callback : function () {};\n\n            if (module.is.visible($currentMenu) || module.is.animating($currentMenu)) {\n              module.verbose('Doing menu hide animation', $currentMenu);\n\n              if (transition == 'none') {\n                start();\n                $currentMenu.transition('hide');\n                callback.call(element);\n              } else if ($.fn.transition !== undefined && $module.transition('is supported')) {\n                $currentMenu.transition({\n                  animation: transition + ' out',\n                  duration: settings.duration,\n                  debug: settings.debug,\n                  verbose: settings.verbose,\n                  queue: true,\n                  onStart: start,\n                  onComplete: function () {\n                    if (settings.direction == 'auto') {\n                      module.remove.upward($subMenu);\n                    }\n\n                    callback.call(element);\n                  }\n                });\n              } else {\n                module.error(error.transition);\n              }\n            }\n          }\n        },\n        hideAndClear: function () {\n          module.remove.searchTerm();\n\n          if (module.has.maxSelections()) {\n            return;\n          }\n\n          if (module.has.search()) {\n            module.hide(function () {\n              module.remove.filteredItem();\n            });\n          } else {\n            module.hide();\n          }\n        },\n        delay: {\n          show: function () {\n            module.verbose('Delaying show event to ensure user intent');\n            clearTimeout(module.timer);\n            module.timer = setTimeout(module.show, settings.delay.show);\n          },\n          hide: function () {\n            module.verbose('Delaying hide event to ensure user intent');\n            clearTimeout(module.timer);\n            module.timer = setTimeout(module.hide, settings.delay.hide);\n          }\n        },\n        escape: {\n          value: function (value) {\n            var multipleValues = $.isArray(value),\n                stringValue = typeof value === 'string',\n                isUnparsable = !stringValue && !multipleValues,\n                hasQuotes = stringValue && value.search(regExp.quote) !== -1,\n                values = [];\n\n            if (!module.has.selectInput() || isUnparsable || !hasQuotes) {\n              return value;\n            }\n\n            module.debug('Encoding quote values for use in select', value);\n\n            if (multipleValues) {\n              $.each(value, function (index, value) {\n                values.push(value.replace(regExp.quote, '&quot;'));\n              });\n              return values;\n            }\n\n            return value.replace(regExp.quote, '&quot;');\n          },\n          regExp: function (text) {\n            text = String(text);\n            return text.replace(regExp.escape, '\\\\$&');\n          }\n        },\n        setting: function (name, value) {\n          module.debug('Changing setting', name, value);\n\n          if ($.isPlainObject(name)) {\n            $.extend(true, settings, name);\n          } else if (value !== undefined) {\n            if ($.isPlainObject(settings[name])) {\n              $.extend(true, settings[name], value);\n            } else {\n              settings[name] = value;\n            }\n          } else {\n            return settings[name];\n          }\n        },\n        internal: function (name, value) {\n          if ($.isPlainObject(name)) {\n            $.extend(true, module, name);\n          } else if (value !== undefined) {\n            module[name] = value;\n          } else {\n            return module[name];\n          }\n        },\n        debug: function () {\n          if (!settings.silent && settings.debug) {\n            if (settings.performance) {\n              module.performance.log(arguments);\n            } else {\n              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');\n              module.debug.apply(console, arguments);\n            }\n          }\n        },\n        verbose: function () {\n          if (!settings.silent && settings.verbose && settings.debug) {\n            if (settings.performance) {\n              module.performance.log(arguments);\n            } else {\n              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');\n              module.verbose.apply(console, arguments);\n            }\n          }\n        },\n        error: function () {\n          if (!settings.silent) {\n            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');\n            module.error.apply(console, arguments);\n          }\n        },\n        performance: {\n          log: function (message) {\n            var currentTime, executionTime, previousTime;\n\n            if (settings.performance) {\n              currentTime = new Date().getTime();\n              previousTime = time || currentTime;\n              executionTime = currentTime - previousTime;\n              time = currentTime;\n              performance.push({\n                'Name': message[0],\n                'Arguments': [].slice.call(message, 1) || '',\n                'Element': element,\n                'Execution Time': executionTime\n              });\n            }\n\n            clearTimeout(module.performance.timer);\n            module.performance.timer = setTimeout(module.performance.display, 500);\n          },\n          display: function () {\n            var title = settings.name + ':',\n                totalTime = 0;\n            time = false;\n            clearTimeout(module.performance.timer);\n            $.each(performance, function (index, data) {\n              totalTime += data['Execution Time'];\n            });\n            title += ' ' + totalTime + 'ms';\n\n            if (moduleSelector) {\n              title += ' \\'' + moduleSelector + '\\'';\n            }\n\n            if ((console.group !== undefined || console.table !== undefined) && performance.length > 0) {\n              console.groupCollapsed(title);\n\n              if (console.table) {\n                console.table(performance);\n              } else {\n                $.each(performance, function (index, data) {\n                  console.log(data['Name'] + ': ' + data['Execution Time'] + 'ms');\n                });\n              }\n\n              console.groupEnd();\n            }\n\n            performance = [];\n          }\n        },\n        invoke: function (query, passedArguments, context) {\n          var object = instance,\n              maxDepth,\n              found,\n              response;\n          passedArguments = passedArguments || queryArguments;\n          context = element || context;\n\n          if (typeof query == 'string' && object !== undefined) {\n            query = query.split(/[\\. ]/);\n            maxDepth = query.length - 1;\n            $.each(query, function (depth, value) {\n              var camelCaseValue = depth != maxDepth ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1) : query;\n\n              if ($.isPlainObject(object[camelCaseValue]) && depth != maxDepth) {\n                object = object[camelCaseValue];\n              } else if (object[camelCaseValue] !== undefined) {\n                found = object[camelCaseValue];\n                return false;\n              } else if ($.isPlainObject(object[value]) && depth != maxDepth) {\n                object = object[value];\n              } else if (object[value] !== undefined) {\n                found = object[value];\n                return false;\n              } else {\n                module.error(error.method, query);\n                return false;\n              }\n            });\n          }\n\n          if ($.isFunction(found)) {\n            response = found.apply(context, passedArguments);\n          } else if (found !== undefined) {\n            response = found;\n          }\n\n          if ($.isArray(returnedValue)) {\n            returnedValue.push(response);\n          } else if (returnedValue !== undefined) {\n            returnedValue = [returnedValue, response];\n          } else if (response !== undefined) {\n            returnedValue = response;\n          }\n\n          return found;\n        }\n      };\n\n      if (methodInvoked) {\n        if (instance === undefined) {\n          module.initialize();\n        }\n\n        module.invoke(query);\n      } else {\n        if (instance !== undefined) {\n          instance.invoke('destroy');\n        }\n\n        module.initialize();\n      }\n    });\n    return returnedValue !== undefined ? returnedValue : $allModules;\n  };\n\n  $.fn.dropdown.settings = {\n    silent: false,\n    debug: false,\n    verbose: false,\n    performance: true,\n    on: 'click',\n    // what event should show menu action on item selection\n    action: 'activate',\n    // action on item selection (nothing, activate, select, combo, hide, function(){})\n    apiSettings: false,\n    selectOnKeydown: true,\n    // Whether selection should occur automatically when keyboard shortcuts used\n    minCharacters: 0,\n    // Minimum characters required to trigger API call\n    saveRemoteData: true,\n    // Whether remote name/value pairs should be stored in sessionStorage to allow remote data to be restored on page refresh\n    throttle: 200,\n    // How long to wait after last user input to search remotely\n    context: window,\n    // Context to use when determining if on screen\n    direction: 'auto',\n    // Whether dropdown should always open in one direction\n    keepOnScreen: true,\n    // Whether dropdown should check whether it is on screen before showing\n    match: 'both',\n    // what to match against with search selection (both, text, or label)\n    fullTextSearch: false,\n    // search anywhere in value (set to 'exact' to require exact matches)\n    placeholder: 'auto',\n    // whether to convert blank <select> values to placeholder text\n    preserveHTML: true,\n    // preserve html when selecting value\n    sortSelect: false,\n    // sort selection on init\n    forceSelection: true,\n    // force a choice on blur with search selection\n    allowAdditions: false,\n    // whether multiple select should allow user added values\n    hideAdditions: true,\n    // whether or not to hide special message prompting a user they can enter a value\n    maxSelections: false,\n    // When set to a number limits the number of selections to this count\n    useLabels: true,\n    // whether multiple select should filter currently active selections from choices\n    delimiter: ',',\n    // when multiselect uses normal <input> the values will be delimited with this character\n    showOnFocus: true,\n    // show menu on focus\n    allowReselection: false,\n    // whether current value should trigger callbacks when reselected\n    allowTab: true,\n    // add tabindex to element\n    allowCategorySelection: false,\n    // allow elements with sub-menus to be selected\n    fireOnInit: false,\n    // Whether callbacks should fire when initializing dropdown values\n    transition: 'auto',\n    // auto transition will slide down or up based on direction\n    duration: 200,\n    // duration of transition\n    glyphWidth: 1.037,\n    // widest glyph width in em (W is 1.037 em) used to calculate multiselect input width\n    // label settings on multi-select\n    label: {\n      transition: 'scale',\n      duration: 200,\n      variation: false\n    },\n    // delay before event\n    delay: {\n      hide: 300,\n      show: 200,\n      search: 20,\n      touch: 50\n    },\n    /* Callbacks */onChange: function (value, text, $selected) {},\n    onAdd: function (value, text, $selected) {},\n    onRemove: function (value, text, $selected) {},\n    onLabelSelect: function ($selectedLabels) {},\n    onLabelCreate: function (value, text) {\n      return $(this);\n    },\n    onLabelRemove: function (value) {\n      return true;\n    },\n    onNoResults: function (searchTerm) {\n      return true;\n    },\n    onShow: function () {},\n    onHide: function () {},\n    /* Component */name: 'Dropdown',\n    namespace: 'dropdown',\n    message: {\n      addResult: 'Add <b>{term}</b>',\n      count: '{count} selected',\n      maxSelections: 'Max {maxCount} selections',\n      noResults: 'No results found.',\n      serverError: 'There was an error contacting the server'\n    },\n    error: {\n      action: 'You called a dropdown action that was not defined',\n      alreadySetup: 'Once a select has been initialized behaviors must be called on the created ui dropdown',\n      labels: 'Allowing user additions currently requires the use of labels.',\n      missingMultiple: '<select> requires multiple property to be set to correctly preserve multiple values',\n      method: 'The method you called is not defined.',\n      noAPI: 'The API module is required to load resources remotely',\n      noStorage: 'Saving remote data requires session storage',\n      noTransition: 'This module requires ui transitions <https://github.com/Semantic-Org/UI-Transition>'\n    },\n    regExp: {\n      escape: /[-[\\]{}()*+?.,\\\\^$|#\\s]/g,\n      quote: /\"/g\n    },\n    metadata: {\n      defaultText: 'defaultText',\n      defaultValue: 'defaultValue',\n      placeholderText: 'placeholder',\n      text: 'text',\n      value: 'value'\n    },\n    // property names for remote query\n    fields: {\n      remoteValues: 'results',\n      // grouping for api results\n      values: 'values',\n      // grouping for all dropdown values\n      disabled: 'disabled',\n      // whether value should be disabled\n      name: 'name',\n      // displayed dropdown text\n      value: 'value',\n      // actual dropdown value\n      text: 'text' // displayed text when selected\n\n    },\n    keys: {\n      backspace: 8,\n      delimiter: 188,\n      // comma\n      deleteKey: 46,\n      enter: 13,\n      escape: 27,\n      pageUp: 33,\n      pageDown: 34,\n      leftArrow: 37,\n      upArrow: 38,\n      rightArrow: 39,\n      downArrow: 40\n    },\n    selector: {\n      addition: '.addition',\n      dropdown: '.ui.dropdown',\n      hidden: '.hidden',\n      icon: '> .dropdown.icon',\n      input: '> input[type=\"hidden\"], > select',\n      item: '.item',\n      label: '> .label',\n      remove: '> .label > .delete.icon',\n      siblingLabel: '.label',\n      menu: '.menu',\n      message: '.message',\n      menuIcon: '.dropdown.icon',\n      search: 'input.search, .menu > .search > input, .menu input.search',\n      sizer: '> input.sizer',\n      text: '> .text:not(.icon)',\n      unselectable: '.disabled, .filtered'\n    },\n    className: {\n      active: 'active',\n      addition: 'addition',\n      animating: 'animating',\n      disabled: 'disabled',\n      empty: 'empty',\n      dropdown: 'ui dropdown',\n      filtered: 'filtered',\n      hidden: 'hidden transition',\n      item: 'item',\n      label: 'ui label',\n      loading: 'loading',\n      menu: 'menu',\n      message: 'message',\n      multiple: 'multiple',\n      placeholder: 'default',\n      sizer: 'sizer',\n      search: 'search',\n      selected: 'selected',\n      selection: 'selection',\n      upward: 'upward',\n      visible: 'visible'\n    }\n  }; /* Templates */\n  $.fn.dropdown.settings.templates = {\n    // generates dropdown from select values\n    dropdown: function (select) {\n      var placeholder = select.placeholder || false,\n          values = select.values || {},\n          html = '';\n      html += '<i class=\"dropdown icon\"></i>';\n\n      if (select.placeholder) {\n        html += '<div class=\"default text\">' + placeholder + '</div>';\n      } else {\n        html += '<div class=\"text\"></div>';\n      }\n\n      html += '<div class=\"menu\">';\n      $.each(select.values, function (index, option) {\n        html += option.disabled ? '<div class=\"disabled item\" data-value=\"' + option.value + '\">' + option.name + '</div>' : '<div class=\"item\" data-value=\"' + option.value + '\">' + option.name + '</div>';\n      });\n      html += '</div>';\n      return html;\n    },\n    // generates just menu from select\n    menu: function (response, fields) {\n      var values = response[fields.values] || {},\n          html = '';\n      $.each(values, function (index, option) {\n        var maybeText = option[fields.text] ? 'data-text=\"' + option[fields.text] + '\"' : '',\n            maybeDisabled = option[fields.disabled] ? 'disabled ' : '';\n        html += '<div class=\"' + maybeDisabled + 'item\" data-value=\"' + option[fields.value] + '\"' + maybeText + '>';\n        html += option[fields.name];\n        html += '</div>';\n      });\n      return html;\n    },\n    // generates label for multiselect\n    label: function (value, text) {\n      return text + '<i class=\"delete icon\"></i>';\n    },\n    // generates messages like \"No results\"\n    message: function (message) {\n      return message;\n    },\n    // generates user addition to selection menu\n    addition: function (choice) {\n      return choice;\n    }\n  };\n})(jQuery, window, document);","ast":null,"map":{"version":3,"sources":["/client/lib/semantic-ui/definitions/modules/dropdown.js"],"names":["$","window","document","undefined","Math","self","Function","fn","dropdown","parameters","$allModules","$document","moduleSelector","selector","hasTouch","documentElement","time","Date","getTime","performance","query","arguments","methodInvoked","queryArguments","slice","call","returnedValue","each","elementIndex","settings","isPlainObject","extend","className","message","fields","keys","metadata","namespace","regExp","error","templates","eventNamespace","moduleNamespace","$module","$context","context","$text","find","text","$search","search","$sizer","sizer","$input","input","$icon","icon","$combo","prev","length","$menu","children","menu","$item","item","activated","itemActivated","internalChange","element","instance","data","initialLoad","pageLostFocus","willRefocus","elementNamespace","id","selectObserver","menuObserver","module","initialize","debug","is","alreadySetup","setup","reference","layout","refreshData","save","defaults","restore","selected","create","bind","events","observeChanges","instantiate","verbose","destroy","remove","tabbable","off","removeData","disconnect","MutationObserver","event","select","mutation","observe","has","childList","subtree","random","toString","substr","userChoice","values","$userChoices","$userChoice","isUserValue","html","get","userValues","isArray","index","value","addition","add","variables","addResult","attr","addClass","hideAdditions","hidden","userLabels","label","appendTo","insertAfter","minCharacters","filter","hide","firstUnfiltered","selectedItem","not","unselectable","eq","nextAvailable","$selected","$nextAvailable","nextAll","$prevAvailable","prevAll","hasNext","api","apiSettings","urlData","on","returnedObject","prop","insertBefore","multiple","searchSelection","allowTab","set","selectValues","parent","closest","selection","hasClass","missingMultiple","disabled","removeAttr","detach","prependTo","refresh","invoke","$firstModules","$lastModules","refreshSelectors","refreshItems","clearData","defaultText","defaultValue","placeholderText","toggle","active","show","callback","isFunction","can","maxSelections","allResultsFiltered","allFiltered","onShow","animate","click","intent","menuSearch","focusSearch","visible","onHide","hideOthers","hideMenu","transition","hideSubMenus","$subMenus","touchEvents","keyboardEvents","inputEvents","mouseEvents","single","test","mouseenter","keydown","inputEvent","change","mousedown","mouseup","focus","blur","delay","mouseleave","touch","unbind","searchTerm","afterFiltered","filterActive","onNoResults","allowAdditions","empty","noResults","userSuggestion","focusedOnSearch","useLabels","useAPI","queryRemote","noAPI","filterItems","errorDuration","cache","throttle","onError","serverError","onFailure","onSuccess","response","remoteValues","results","escapedTerm","escape","beginsWithRegExp","RegExp","$choice","match","String","choiceText","push","fullTextSearch","exactSearch","fuzzySearch","choiceValue","filteredItem","filtered","term","termLength","queryLength","toLowerCase","characterIndex","nextCharacterIndex","queryCharacter","charCodeAt","indexOf","skipHandler","forceSelection","$currentlySelected","$activeItem","$selectedItem","hasSelected","showOnFocus","activeElement","activeLabel","$target","target","stopPropagation","clearTimeout","timer","setTimeout","$label","$labels","$activeLabels","$nextActive","$prevActive","$range","nextUntil","prevUntil","shiftKey","removeClass","ctrlKey","toggleClass","onLabelSelect","apply","activeLabels","toggleBehavior","bubbledLabelClick","determine","eventOnElement","preventDefault","type","eventInModule","mutations","$addedNode","addedNodes","$removedNode","removedNodes","$changedNodes","isUserAddition","isMessage","$subMenu","$otherMenus","siblings","hasSubMenu","isBubbledEvent","itemTimer","skipRefocus","allowCategorySelection","userAddition","scrollPosition","selectAction","pressedKey","which","isShortcutKey","inObject","$activeLabel","activeValue","labelIndex","labelCount","hasActiveLabel","hasMultipleActive","isFirstLabel","isLastLabel","isSearch","isFocusedOnSearch","isFocused","focused","caretAtStart","caretPosition","$nextLabel","leftArrow","last","siblingLabel","end","rightArrow","first","next","deleteKey","backspace","$visibleItems","addBack","$parentMenu","inVisibleMenu","animating","hasSelectedItem","selectedIsSelectable","delimiterPressed","delimiter","isAdditionWithoutMenu","enter","$nextItem","isSubMenuItem","newIndex","upArrow","selectOnKeydown","downArrow","activeItem","pageUp","scrollPage","pageDown","selectedLetter","fromCharCode","trigger","createEvent","inputElement","initEvent","dispatchEvent","action","inDocument","inModule","inVisibleDOM","body","contains","notOnLabel","notInMenu","nothing","activate","hideAndClear","combo","trim","val","searchWidth","ceil","width","selectionCount","count","upward","grep","uniqueArray","array","inArray","range","rangeLength","selectionStart","createRange","moveStart","isEmptyMultiselect","selectInput","split","name","read","remoteData","preserveHTML","clone","menuIcon","oninput","onpropertychange","$option","placeholder","sortSelect","sort","a","b","itemWithAdditions","$items","$userItems","hasUserItems","strict","shouldSearch","isMultiple","optionText","optionValue","check","clear","labels","saveRemoteData","Storage","noStorage","sessionStorage","getItem","setItem","clearValue","direction","$currentItem","menuHeight","outerHeight","currentScroll","scrollTop","itemHeight","itemsPerPage","floor","maxScroll","newScroll","$selectableItem","isWithinRange","$nextSelectedItem","isSearchMultiple","searchValue","hasSearchValue","valueIsSet","glyphWidth","css","loading","forceScroll","edgeTolerance","hasActive","offset","itemOffset","menuOffset","menuScroll","abovePage","belowPage","position","top","height","letter","alreadySelectedLetter","firstLetter","$nextValue","onScreen","$element","escapedValue","hasInput","isAddition","currentValue","stringValue","newValue","allowReselection","extendSelect","fireOnInit","onChange","exactly","$userSelectedItem","selectedText","selectedValue","isFiltered","isActive","shouldAnimate","$next","onLabelCreate","variation","duration","$message","hasOption","$addition","$existingItem","alreadyHasValue","hasUserSuggestion","hasCount","hasMaxCount","hasTerm","replace","addedValue","addedText","concat","join","onAdd","removedValue","removedText","$removedItem","arrayValue","onRemove","$removedLabel","userValue","onLabelRemove","charAt","items","$normalResults","hasValue","$currentMenu","canOpenDownward","calculations","above","below","needle","object","found","property","selectMutation","selectChanged","start","animation","queue","onStart","onComplete","noTransition","multipleValues","isUnparsable","hasQuotes","quote","setting","internal","silent","log","prototype","console","info","currentTime","executionTime","previousTime","display","title","totalTime","group","table","groupCollapsed","groupEnd","passedArguments","maxDepth","depth","camelCaseValue","toUpperCase","method","keepOnScreen","$selectedLabels","option","maybeText","maybeDisabled","choice","jQuery"],"mappings":"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","file":"/client/lib/semantic-ui/definitions/modules/dropdown.js.map","sourcesContent":["/*\n  DO NOT MODIFY - This file has been generated and will be regenerated\n  Semantic UI v2.2.1\n*/\n/*!\n * # Semantic UI - Dropdown\n * http://github.com/semantic-org/semantic-ui/\n *\n *\n * Released under the MIT license\n * http://opensource.org/licenses/MIT\n *\n */\n\n;(function ($, window, document, undefined) {\n\n\"use strict\";\n\nwindow = (typeof window != 'undefined' && window.Math == Math)\n  ? window\n  : (typeof self != 'undefined' && self.Math == Math)\n    ? self\n    : Function('return this')()\n;\n\n$.fn.dropdown = function(parameters) {\n  var\n    $allModules    = $(this),\n    $document      = $(document),\n\n    moduleSelector = $allModules.selector || '',\n\n    hasTouch       = ('ontouchstart' in document.documentElement),\n    time           = new Date().getTime(),\n    performance    = [],\n\n    query          = arguments[0],\n    methodInvoked  = (typeof query == 'string'),\n    queryArguments = [].slice.call(arguments, 1),\n    returnedValue\n  ;\n\n  $allModules\n    .each(function(elementIndex) {\n      var\n        settings          = ( $.isPlainObject(parameters) )\n          ? $.extend(true, {}, $.fn.dropdown.settings, parameters)\n          : $.extend({}, $.fn.dropdown.settings),\n\n        className       = settings.className,\n        message         = settings.message,\n        fields          = settings.fields,\n        keys            = settings.keys,\n        metadata        = settings.metadata,\n        namespace       = settings.namespace,\n        regExp          = settings.regExp,\n        selector        = settings.selector,\n        error           = settings.error,\n        templates       = settings.templates,\n\n        eventNamespace  = '.' + namespace,\n        moduleNamespace = 'module-' + namespace,\n\n        $module         = $(this),\n        $context        = $(settings.context),\n        $text           = $module.find(selector.text),\n        $search         = $module.find(selector.search),\n        $sizer          = $module.find(selector.sizer),\n        $input          = $module.find(selector.input),\n        $icon           = $module.find(selector.icon),\n\n        $combo = ($module.prev().find(selector.text).length > 0)\n          ? $module.prev().find(selector.text)\n          : $module.prev(),\n\n        $menu           = $module.children(selector.menu),\n        $item           = $menu.find(selector.item),\n\n        activated       = false,\n        itemActivated   = false,\n        internalChange  = false,\n        element         = this,\n        instance        = $module.data(moduleNamespace),\n\n        initialLoad,\n        pageLostFocus,\n        willRefocus,\n        elementNamespace,\n        id,\n        selectObserver,\n        menuObserver,\n        module\n      ;\n\n      module = {\n\n        initialize: function() {\n          module.debug('Initializing dropdown', settings);\n\n          if( module.is.alreadySetup() ) {\n            module.setup.reference();\n          }\n          else {\n            module.setup.layout();\n            module.refreshData();\n\n            module.save.defaults();\n            module.restore.selected();\n\n            module.create.id();\n            module.bind.events();\n\n            module.observeChanges();\n            module.instantiate();\n          }\n\n        },\n\n        instantiate: function() {\n          module.verbose('Storing instance of dropdown', module);\n          instance = module;\n          $module\n            .data(moduleNamespace, module)\n          ;\n        },\n\n        destroy: function() {\n          module.verbose('Destroying previous dropdown', $module);\n          module.remove.tabbable();\n          $module\n            .off(eventNamespace)\n            .removeData(moduleNamespace)\n          ;\n          $menu\n            .off(eventNamespace)\n          ;\n          $document\n            .off(elementNamespace)\n          ;\n          module.disconnect.menuObserver();\n          module.disconnect.selectObserver();\n        },\n\n        observeChanges: function() {\n          if('MutationObserver' in window) {\n            selectObserver = new MutationObserver(module.event.select.mutation);\n            menuObserver   = new MutationObserver(module.event.menu.mutation);\n            module.debug('Setting up mutation observer', selectObserver, menuObserver);\n            module.observe.select();\n            module.observe.menu();\n          }\n        },\n\n        disconnect: {\n          menuObserver: function() {\n            if(menuObserver) {\n              menuObserver.disconnect();\n            }\n          },\n          selectObserver: function() {\n            if(menuObserver) {\n              menuObserver.disconnect();\n            }\n          }\n        },\n        observe: {\n          select: function() {\n            if(module.has.input()) {\n              selectObserver.observe($input[0], {\n                childList : true,\n                subtree   : true\n              });\n            }\n          },\n          menu: function() {\n            if(module.has.menu()) {\n              menuObserver.observe($menu[0], {\n                childList : true,\n                subtree   : true\n              });\n            }\n          }\n        },\n\n        create: {\n          id: function() {\n            id = (Math.random().toString(16) + '000000000').substr(2, 8);\n            elementNamespace = '.' + id;\n            module.verbose('Creating unique id for element', id);\n          },\n          userChoice: function(values) {\n            var\n              $userChoices,\n              $userChoice,\n              isUserValue,\n              html\n            ;\n            values = values || module.get.userValues();\n            if(!values) {\n              return false;\n            }\n            values = $.isArray(values)\n              ? values\n              : [values]\n            ;\n            $.each(values, function(index, value) {\n              if(module.get.item(value) === false) {\n                html         = settings.templates.addition( module.add.variables(message.addResult, value) );\n                $userChoice  = $('<div />')\n                  .html(html)\n                  .attr('data-' + metadata.value, value)\n                  .attr('data-' + metadata.text, value)\n                  .addClass(className.addition)\n                  .addClass(className.item)\n                ;\n                if(settings.hideAdditions) {\n                  $userChoice.addClass(className.hidden);\n                }\n                $userChoices = ($userChoices === undefined)\n                  ? $userChoice\n                  : $userChoices.add($userChoice)\n                ;\n                module.verbose('Creating user choices for value', value, $userChoice);\n              }\n            });\n            return $userChoices;\n          },\n          userLabels: function(value) {\n            var\n              userValues = module.get.userValues()\n            ;\n            if(userValues) {\n              module.debug('Adding user labels', userValues);\n              $.each(userValues, function(index, value) {\n                module.verbose('Adding custom user value');\n                module.add.label(value, value);\n              });\n            }\n          },\n          menu: function() {\n            $menu = $('<div />')\n              .addClass(className.menu)\n              .appendTo($module)\n            ;\n          },\n          sizer: function() {\n            $sizer = $('<span />')\n              .addClass(className.sizer)\n              .insertAfter($search)\n            ;\n          }\n        },\n\n        search: function(query) {\n          query = (query !== undefined)\n            ? query\n            : module.get.query()\n          ;\n          module.verbose('Searching for query', query);\n          if(module.has.minCharacters(query)) {\n            module.filter(query);\n          }\n          else {\n            module.hide();\n          }\n        },\n\n        select: {\n          firstUnfiltered: function() {\n            module.verbose('Selecting first non-filtered element');\n            module.remove.selectedItem();\n            $item\n              .not(selector.unselectable)\n              .not(selector.addition + selector.hidden)\n                .eq(0)\n                .addClass(className.selected)\n            ;\n          },\n          nextAvailable: function($selected) {\n            $selected = $selected.eq(0);\n            var\n              $nextAvailable = $selected.nextAll(selector.item).not(selector.unselectable).eq(0),\n              $prevAvailable = $selected.prevAll(selector.item).not(selector.unselectable).eq(0),\n              hasNext        = ($nextAvailable.length > 0)\n            ;\n            if(hasNext) {\n              module.verbose('Moving selection to', $nextAvailable);\n              $nextAvailable.addClass(className.selected);\n            }\n            else {\n              module.verbose('Moving selection to', $prevAvailable);\n              $prevAvailable.addClass(className.selected);\n            }\n          }\n        },\n\n        setup: {\n          api: function() {\n            var\n              apiSettings = {\n                debug   : settings.debug,\n                urlData : {\n                  value : module.get.value(),\n                  query : module.get.query()\n                },\n                on    : false\n              }\n            ;\n            module.verbose('First request, initializing API');\n            $module\n              .api(apiSettings)\n            ;\n          },\n          layout: function() {\n            if( $module.is('select') ) {\n              module.setup.select();\n              module.setup.returnedObject();\n            }\n            if( !module.has.menu() ) {\n              module.create.menu();\n            }\n            if( module.is.search() && !module.has.search() ) {\n              module.verbose('Adding search input');\n              $search = $('<input />')\n                .addClass(className.search)\n                .prop('autocomplete', 'off')\n                .insertBefore($text)\n              ;\n            }\n            if( module.is.multiple() && module.is.searchSelection() && !module.has.sizer()) {\n              module.create.sizer();\n            }\n            if(settings.allowTab) {\n              module.set.tabbable();\n            }\n          },\n          select: function() {\n            var\n              selectValues  = module.get.selectValues()\n            ;\n            module.debug('Dropdown initialized on a select', selectValues);\n            if( $module.is('select') ) {\n              $input = $module;\n            }\n            // see if select is placed correctly already\n            if($input.parent(selector.dropdown).length > 0) {\n              module.debug('UI dropdown already exists. Creating dropdown menu only');\n              $module = $input.closest(selector.dropdown);\n              if( !module.has.menu() ) {\n                module.create.menu();\n              }\n              $menu = $module.children(selector.menu);\n              module.setup.menu(selectValues);\n            }\n            else {\n              module.debug('Creating entire dropdown from select');\n              $module = $('<div />')\n                .attr('class', $input.attr('class') )\n                .addClass(className.selection)\n                .addClass(className.dropdown)\n                .html( templates.dropdown(selectValues) )\n                .insertBefore($input)\n              ;\n              if($input.hasClass(className.multiple) && $input.prop('multiple') === false) {\n                module.error(error.missingMultiple);\n                $input.prop('multiple', true);\n              }\n              if($input.is('[multiple]')) {\n                module.set.multiple();\n              }\n              if ($input.prop('disabled')) {\n                module.debug('Disabling dropdown');\n                $module.addClass(className.disabled);\n              }\n              $input\n                .removeAttr('class')\n                .detach()\n                .prependTo($module)\n              ;\n            }\n            module.refresh();\n          },\n          menu: function(values) {\n            $menu.html( templates.menu(values, fields));\n            $item = $menu.find(selector.item);\n          },\n          reference: function() {\n            module.debug('Dropdown behavior was called on select, replacing with closest dropdown');\n            // replace module reference\n            $module = $module.parent(selector.dropdown);\n            module.refresh();\n            module.setup.returnedObject();\n            // invoke method in context of current instance\n            if(methodInvoked) {\n              instance = module;\n              module.invoke(query);\n            }\n          },\n          returnedObject: function() {\n            var\n              $firstModules = $allModules.slice(0, elementIndex),\n              $lastModules = $allModules.slice(elementIndex + 1)\n            ;\n            // adjust all modules to use correct reference\n            $allModules = $firstModules.add($module).add($lastModules);\n          }\n        },\n\n        refresh: function() {\n          module.refreshSelectors();\n          module.refreshData();\n        },\n\n        refreshItems: function() {\n          $item = $menu.find(selector.item);\n        },\n\n        refreshSelectors: function() {\n          module.verbose('Refreshing selector cache');\n          $text   = $module.find(selector.text);\n          $search = $module.find(selector.search);\n          $input  = $module.find(selector.input);\n          $icon   = $module.find(selector.icon);\n          $combo  = ($module.prev().find(selector.text).length > 0)\n            ? $module.prev().find(selector.text)\n            : $module.prev()\n          ;\n          $menu    = $module.children(selector.menu);\n          $item    = $menu.find(selector.item);\n        },\n\n        refreshData: function() {\n          module.verbose('Refreshing cached metadata');\n          $item\n            .removeData(metadata.text)\n            .removeData(metadata.value)\n          ;\n        },\n\n        clearData: function() {\n          module.verbose('Clearing metadata');\n          $item\n            .removeData(metadata.text)\n            .removeData(metadata.value)\n          ;\n          $module\n            .removeData(metadata.defaultText)\n            .removeData(metadata.defaultValue)\n            .removeData(metadata.placeholderText)\n          ;\n        },\n\n        toggle: function() {\n          module.verbose('Toggling menu visibility');\n          if( !module.is.active() ) {\n            module.show();\n          }\n          else {\n            module.hide();\n          }\n        },\n\n        show: function(callback) {\n          callback = $.isFunction(callback)\n            ? callback\n            : function(){}\n          ;\n          if( module.can.show() && !module.is.active() ) {\n            module.debug('Showing dropdown');\n            if(module.has.message() && !(module.has.maxSelections() || module.has.allResultsFiltered()) ) {\n              module.remove.message();\n            }\n            if(module.is.allFiltered()) {\n              return true;\n            }\n            if(settings.onShow.call(element) !== false) {\n              module.animate.show(function() {\n                if( module.can.click() ) {\n                  module.bind.intent();\n                }\n                if(module.has.menuSearch()) {\n                  module.focusSearch();\n                }\n                module.set.visible();\n                callback.call(element);\n              });\n            }\n          }\n        },\n\n        hide: function(callback) {\n          callback = $.isFunction(callback)\n            ? callback\n            : function(){}\n          ;\n          if( module.is.active() ) {\n            module.debug('Hiding dropdown');\n            if(settings.onHide.call(element) !== false) {\n              module.animate.hide(function() {\n                module.remove.visible();\n                callback.call(element);\n              });\n            }\n          }\n        },\n\n        hideOthers: function() {\n          module.verbose('Finding other dropdowns to hide');\n          $allModules\n            .not($module)\n              .has(selector.menu + '.' + className.visible)\n                .dropdown('hide')\n          ;\n        },\n\n        hideMenu: function() {\n          module.verbose('Hiding menu  instantaneously');\n          module.remove.active();\n          module.remove.visible();\n          $menu.transition('hide');\n        },\n\n        hideSubMenus: function() {\n          var\n            $subMenus = $menu.children(selector.item).find(selector.menu)\n          ;\n          module.verbose('Hiding sub menus', $subMenus);\n          $subMenus.transition('hide');\n        },\n\n        bind: {\n          events: function() {\n            if(hasTouch) {\n              module.bind.touchEvents();\n            }\n            module.bind.keyboardEvents();\n            module.bind.inputEvents();\n            module.bind.mouseEvents();\n          },\n          touchEvents: function() {\n            module.debug('Touch device detected binding additional touch events');\n            if( module.is.searchSelection() ) {\n              // do nothing special yet\n            }\n            else if( module.is.single() ) {\n              $module\n                .on('touchstart' + eventNamespace, module.event.test.toggle)\n              ;\n            }\n            $menu\n              .on('touchstart' + eventNamespace, selector.item, module.event.item.mouseenter)\n            ;\n          },\n          keyboardEvents: function() {\n            module.verbose('Binding keyboard events');\n            $module\n              .on('keydown' + eventNamespace, module.event.keydown)\n            ;\n            if( module.has.search() ) {\n              $module\n                .on(module.get.inputEvent() + eventNamespace, selector.search, module.event.input)\n              ;\n            }\n            if( module.is.multiple() ) {\n              $document\n                .on('keydown' + elementNamespace, module.event.document.keydown)\n              ;\n            }\n          },\n          inputEvents: function() {\n            module.verbose('Binding input change events');\n            $module\n              .on('change' + eventNamespace, selector.input, module.event.change)\n            ;\n          },\n          mouseEvents: function() {\n            module.verbose('Binding mouse events');\n            if(module.is.multiple()) {\n              $module\n                .on('click'   + eventNamespace, selector.label,  module.event.label.click)\n                .on('click'   + eventNamespace, selector.remove, module.event.remove.click)\n              ;\n            }\n            if( module.is.searchSelection() ) {\n              $module\n                .on('mousedown' + eventNamespace, module.event.mousedown)\n                .on('mouseup'   + eventNamespace, module.event.mouseup)\n                .on('mousedown' + eventNamespace, selector.menu,   module.event.menu.mousedown)\n                .on('mouseup'   + eventNamespace, selector.menu,   module.event.menu.mouseup)\n                .on('click'     + eventNamespace, selector.icon,   module.event.icon.click)\n                .on('focus'     + eventNamespace, selector.search, module.event.search.focus)\n                .on('click'     + eventNamespace, selector.search, module.event.search.focus)\n                .on('blur'      + eventNamespace, selector.search, module.event.search.blur)\n                .on('click'     + eventNamespace, selector.text,   module.event.text.focus)\n              ;\n              if(module.is.multiple()) {\n                $module\n                  .on('click' + eventNamespace, module.event.click)\n                ;\n              }\n            }\n            else {\n              if(settings.on == 'click') {\n                $module\n                  .on('click' + eventNamespace, selector.icon, module.event.icon.click)\n                  .on('click' + eventNamespace, module.event.test.toggle)\n                ;\n              }\n              else if(settings.on == 'hover') {\n                $module\n                  .on('mouseenter' + eventNamespace, module.delay.show)\n                  .on('mouseleave' + eventNamespace, module.delay.hide)\n                ;\n              }\n              else {\n                $module\n                  .on(settings.on + eventNamespace, module.toggle)\n                ;\n              }\n              $module\n                .on('mousedown' + eventNamespace, module.event.mousedown)\n                .on('mouseup'   + eventNamespace, module.event.mouseup)\n                .on('focus'     + eventNamespace, module.event.focus)\n                .on('blur'      + eventNamespace, module.event.blur)\n              ;\n            }\n            $menu\n              .on('mouseenter' + eventNamespace, selector.item, module.event.item.mouseenter)\n              .on('mouseleave' + eventNamespace, selector.item, module.event.item.mouseleave)\n              .on('click'      + eventNamespace, selector.item, module.event.item.click)\n            ;\n          },\n          intent: function() {\n            module.verbose('Binding hide intent event to document');\n            if(hasTouch) {\n              $document\n                .on('touchstart' + elementNamespace, module.event.test.touch)\n                .on('touchmove'  + elementNamespace, module.event.test.touch)\n              ;\n            }\n            $document\n              .on('click' + elementNamespace, module.event.test.hide)\n            ;\n          }\n        },\n\n        unbind: {\n          intent: function() {\n            module.verbose('Removing hide intent event from document');\n            if(hasTouch) {\n              $document\n                .off('touchstart' + elementNamespace)\n                .off('touchmove' + elementNamespace)\n              ;\n            }\n            $document\n              .off('click' + elementNamespace)\n            ;\n          }\n        },\n\n        filter: function(query) {\n          var\n            searchTerm = (query !== undefined)\n              ? query\n              : module.get.query(),\n            afterFiltered = function() {\n              if(module.is.multiple()) {\n                module.filterActive();\n              }\n              module.select.firstUnfiltered();\n              if( module.has.allResultsFiltered() ) {\n                if( settings.onNoResults.call(element, searchTerm) ) {\n                  if(settings.allowAdditions) {\n                    if(settings.hideAdditions) {\n                      module.verbose('User addition with no menu, setting empty style');\n                      module.set.empty();\n                      module.hideMenu();\n                    }\n                  }\n                  else {\n                    module.verbose('All items filtered, showing message', searchTerm);\n                    module.add.message(message.noResults);\n                  }\n                }\n                else {\n                  module.verbose('All items filtered, hiding dropdown', searchTerm);\n                  module.hideMenu();\n                }\n              }\n              else {\n                module.remove.empty();\n                module.remove.message();\n              }\n              if(settings.allowAdditions) {\n                module.add.userSuggestion(query);\n              }\n              if(module.is.searchSelection() && module.can.show() && module.is.focusedOnSearch() ) {\n                module.show();\n              }\n            }\n          ;\n          if(settings.useLabels && module.has.maxSelections()) {\n            return;\n          }\n          if(settings.apiSettings) {\n            if( module.can.useAPI() ) {\n              module.queryRemote(searchTerm, function() {\n                afterFiltered();\n              });\n            }\n            else {\n              module.error(error.noAPI);\n            }\n          }\n          else {\n            module.filterItems(searchTerm);\n            afterFiltered();\n          }\n        },\n\n        queryRemote: function(query, callback) {\n          var\n            apiSettings = {\n              errorDuration : false,\n              cache         : 'local',\n              throttle      : settings.throttle,\n              urlData       : {\n                query: query\n              },\n              onError: function() {\n                module.add.message(message.serverError);\n                callback();\n              },\n              onFailure: function() {\n                module.add.message(message.serverError);\n                callback();\n              },\n              onSuccess : function(response) {\n                module.remove.message();\n                module.setup.menu({\n                  values: response[fields.remoteValues]\n                });\n                callback();\n              }\n            }\n          ;\n          if( !$module.api('get request') ) {\n            module.setup.api();\n          }\n          apiSettings = $.extend(true, {}, apiSettings, settings.apiSettings);\n          $module\n            .api('setting', apiSettings)\n            .api('query')\n          ;\n        },\n\n        filterItems: function(query) {\n          var\n            searchTerm = (query !== undefined)\n              ? query\n              : module.get.query(),\n            results          =  null,\n            escapedTerm      = module.escape.regExp(searchTerm),\n            beginsWithRegExp = new RegExp('^' + escapedTerm, 'igm')\n          ;\n          // avoid loop if we're matching nothing\n          if( module.has.query() ) {\n            results = [];\n\n            module.verbose('Searching for matching values', searchTerm);\n            $item\n              .each(function(){\n                var\n                  $choice = $(this),\n                  text,\n                  value\n                ;\n                if(settings.match == 'both' || settings.match == 'text') {\n                  text = String(module.get.choiceText($choice, false));\n                  if(text.search(beginsWithRegExp) !== -1) {\n                    results.push(this);\n                    return true;\n                  }\n                  else if (settings.fullTextSearch === 'exact' && module.exactSearch(searchTerm, text)) {\n                    results.push(this);\n                    return true;\n                  }\n                  else if (settings.fullTextSearch === true && module.fuzzySearch(searchTerm, text)) {\n                    results.push(this);\n                    return true;\n                  }\n                }\n                if(settings.match == 'both' || settings.match == 'value') {\n                  value = String(module.get.choiceValue($choice, text));\n\n                  if(value.search(beginsWithRegExp) !== -1) {\n                    results.push(this);\n                    return true;\n                  }\n                  else if(settings.fullTextSearch && module.fuzzySearch(searchTerm, value)) {\n                    results.push(this);\n                    return true;\n                  }\n                }\n              })\n            ;\n          }\n          module.debug('Showing only matched items', searchTerm);\n          module.remove.filteredItem();\n          if(results) {\n            $item\n              .not(results)\n              .addClass(className.filtered)\n            ;\n          }\n        },\n\n        fuzzySearch: function(query, term) {\n          var\n            termLength  = term.length,\n            queryLength = query.length\n          ;\n          query = query.toLowerCase();\n          term  = term.toLowerCase();\n          if(queryLength > termLength) {\n            return false;\n          }\n          if(queryLength === termLength) {\n            return (query === term);\n          }\n          search: for (var characterIndex = 0, nextCharacterIndex = 0; characterIndex < queryLength; characterIndex++) {\n            var\n              queryCharacter = query.charCodeAt(characterIndex)\n            ;\n            while(nextCharacterIndex < termLength) {\n              if(term.charCodeAt(nextCharacterIndex++) === queryCharacter) {\n                continue search;\n              }\n            }\n            return false;\n          }\n          return true;\n        },\n        exactSearch: function (query, term) {\n          query = query.toLowerCase();\n          term  = term.toLowerCase();\n          if(term.indexOf(query) > -1) {\n             return true;\n          }\n          return false;\n        },\n        filterActive: function() {\n          if(settings.useLabels) {\n            $item.filter('.' + className.active)\n              .addClass(className.filtered)\n            ;\n          }\n        },\n\n        focusSearch: function(skipHandler) {\n          if( module.has.search() && !module.is.focusedOnSearch() ) {\n            if(skipHandler) {\n              $module.off('focus' + eventNamespace, selector.search);\n              $search.focus();\n              $module.on('focus'  + eventNamespace, selector.search, module.event.search.focus);\n            }\n            else {\n              $search.focus();\n            }\n          }\n        },\n\n        forceSelection: function() {\n          var\n            $currentlySelected = $item.not(className.filtered).filter('.' + className.selected).eq(0),\n            $activeItem        = $item.not(className.filtered).filter('.' + className.active).eq(0),\n            $selectedItem      = ($currentlySelected.length > 0)\n              ? $currentlySelected\n              : $activeItem,\n            hasSelected = ($selectedItem.length > 0)\n          ;\n          if(hasSelected) {\n            module.debug('Forcing partial selection to selected item', $selectedItem);\n            module.event.item.click.call($selectedItem, {}, true);\n            return;\n          }\n          else {\n            if(settings.allowAdditions) {\n              module.set.selected(module.get.query());\n              module.remove.searchTerm();\n            }\n            else {\n              module.remove.searchTerm();\n            }\n          }\n        },\n\n        event: {\n          change: function() {\n            if(!internalChange) {\n              module.debug('Input changed, updating selection');\n              module.set.selected();\n            }\n          },\n          focus: function() {\n            if(settings.showOnFocus && !activated && module.is.hidden() && !pageLostFocus) {\n              module.show();\n            }\n          },\n          blur: function(event) {\n            pageLostFocus = (document.activeElement === this);\n            if(!activated && !pageLostFocus) {\n              module.remove.activeLabel();\n              module.hide();\n            }\n          },\n          mousedown: function() {\n            if(module.is.searchSelection()) {\n              // prevent menu hiding on immediate re-focus\n              willRefocus = true;\n            }\n            else {\n              // prevents focus callback from occurring on mousedown\n              activated = true;\n            }\n          },\n          mouseup: function() {\n            if(module.is.searchSelection()) {\n              // prevent menu hiding on immediate re-focus\n              willRefocus = false;\n            }\n            else {\n              activated = false;\n            }\n          },\n          click: function(event) {\n            var\n              $target = $(event.target)\n            ;\n            // focus search\n            if($target.is($module)) {\n              if(!module.is.focusedOnSearch()) {\n                module.focusSearch();\n              }\n              else {\n                module.show();\n              }\n            }\n          },\n          search: {\n            focus: function() {\n              activated = true;\n              if(module.is.multiple()) {\n                module.remove.activeLabel();\n              }\n              if(settings.showOnFocus) {\n                module.search();\n              }\n            },\n            blur: function(event) {\n              pageLostFocus = (document.activeElement === this);\n              if(!willRefocus) {\n                if(!itemActivated && !pageLostFocus) {\n                  if(settings.forceSelection && module.has.query()) {\n                    module.forceSelection();\n                  }\n                  module.hide();\n                }\n              }\n              willRefocus = false;\n            }\n          },\n          icon: {\n            click: function(event) {\n              module.toggle();\n              event.stopPropagation();\n            }\n          },\n          text: {\n            focus: function(event) {\n              activated = true;\n              module.focusSearch();\n            }\n          },\n          input: function(event) {\n            if(module.is.multiple() || module.is.searchSelection()) {\n              module.set.filtered();\n            }\n            clearTimeout(module.timer);\n            module.timer = setTimeout(module.search, settings.delay.search);\n          },\n          label: {\n            click: function(event) {\n              var\n                $label        = $(this),\n                $labels       = $module.find(selector.label),\n                $activeLabels = $labels.filter('.' + className.active),\n                $nextActive   = $label.nextAll('.' + className.active),\n                $prevActive   = $label.prevAll('.' + className.active),\n                $range = ($nextActive.length > 0)\n                  ? $label.nextUntil($nextActive).add($activeLabels).add($label)\n                  : $label.prevUntil($prevActive).add($activeLabels).add($label)\n              ;\n              if(event.shiftKey) {\n                $activeLabels.removeClass(className.active);\n                $range.addClass(className.active);\n              }\n              else if(event.ctrlKey) {\n                $label.toggleClass(className.active);\n              }\n              else {\n                $activeLabels.removeClass(className.active);\n                $label.addClass(className.active);\n              }\n              settings.onLabelSelect.apply(this, $labels.filter('.' + className.active));\n            }\n          },\n          remove: {\n            click: function() {\n              var\n                $label = $(this).parent()\n              ;\n              if( $label.hasClass(className.active) ) {\n                // remove all selected labels\n                module.remove.activeLabels();\n              }\n              else {\n                // remove this label only\n                module.remove.activeLabels( $label );\n              }\n            }\n          },\n          test: {\n            toggle: function(event) {\n              var\n                toggleBehavior = (module.is.multiple())\n                  ? module.show\n                  : module.toggle\n              ;\n              if(module.is.bubbledLabelClick(event)) {\n                return;\n              }\n              if( module.determine.eventOnElement(event, toggleBehavior) ) {\n                event.preventDefault();\n              }\n            },\n            touch: function(event) {\n              module.determine.eventOnElement(event, function() {\n                if(event.type == 'touchstart') {\n                  module.timer = setTimeout(function() {\n                    module.hide();\n                  }, settings.delay.touch);\n                }\n                else if(event.type == 'touchmove') {\n                  clearTimeout(module.timer);\n                }\n              });\n              event.stopPropagation();\n            },\n            hide: function(event) {\n              module.determine.eventInModule(event, module.hide);\n            }\n          },\n          select: {\n            mutation: function(mutations) {\n              module.debug('<select> modified, recreating menu');\n              module.setup.select();\n            }\n          },\n          menu: {\n            mutation: function(mutations) {\n              var\n                mutation   = mutations[0],\n                $addedNode = mutation.addedNodes\n                  ? $(mutation.addedNodes[0])\n                  : $(false),\n                $removedNode = mutation.removedNodes\n                  ? $(mutation.removedNodes[0])\n                  : $(false),\n                $changedNodes  = $addedNode.add($removedNode),\n                isUserAddition = $changedNodes.is(selector.addition) || $changedNodes.closest(selector.addition).length > 0,\n                isMessage      = $changedNodes.is(selector.message)  || $changedNodes.closest(selector.message).length > 0\n              ;\n              if(isUserAddition || isMessage) {\n                module.debug('Updating item selector cache');\n                module.refreshItems();\n              }\n              else {\n                module.debug('Menu modified, updating selector cache');\n                module.refresh();\n              }\n            },\n            mousedown: function() {\n              itemActivated = true;\n            },\n            mouseup: function() {\n              itemActivated = false;\n            }\n          },\n          item: {\n            mouseenter: function(event) {\n              var\n                $target        = $(event.target),\n                $item          = $(this),\n                $subMenu       = $item.children(selector.menu),\n                $otherMenus    = $item.siblings(selector.item).children(selector.menu),\n                hasSubMenu     = ($subMenu.length > 0),\n                isBubbledEvent = ($subMenu.find($target).length > 0)\n              ;\n              if( !isBubbledEvent && hasSubMenu ) {\n                clearTimeout(module.itemTimer);\n                module.itemTimer = setTimeout(function() {\n                  module.verbose('Showing sub-menu', $subMenu);\n                  $.each($otherMenus, function() {\n                    module.animate.hide(false, $(this));\n                  });\n                  module.animate.show(false, $subMenu);\n                }, settings.delay.show);\n                event.preventDefault();\n              }\n            },\n            mouseleave: function(event) {\n              var\n                $subMenu = $(this).children(selector.menu)\n              ;\n              if($subMenu.length > 0) {\n                clearTimeout(module.itemTimer);\n                module.itemTimer = setTimeout(function() {\n                  module.verbose('Hiding sub-menu', $subMenu);\n                  module.animate.hide(false, $subMenu);\n                }, settings.delay.hide);\n              }\n            },\n            click: function (event, skipRefocus) {\n              var\n                $choice        = $(this),\n                $target        = (event)\n                  ? $(event.target)\n                  : $(''),\n                $subMenu       = $choice.find(selector.menu),\n                text           = module.get.choiceText($choice),\n                value          = module.get.choiceValue($choice, text),\n                hasSubMenu     = ($subMenu.length > 0),\n                isBubbledEvent = ($subMenu.find($target).length > 0)\n              ;\n              if(!isBubbledEvent && (!hasSubMenu || settings.allowCategorySelection)) {\n                if(module.is.searchSelection()) {\n                  if(settings.allowAdditions) {\n                    module.remove.userAddition();\n                  }\n                  module.remove.searchTerm();\n                  if(!module.is.focusedOnSearch() && !(skipRefocus == true)) {\n                    module.focusSearch(true);\n                  }\n                }\n                if(!settings.useLabels) {\n                  module.remove.filteredItem();\n                  module.set.scrollPosition($choice);\n                }\n                module.determine.selectAction.call(this, text, value);\n              }\n            }\n          },\n\n          document: {\n            // label selection should occur even when element has no focus\n            keydown: function(event) {\n              var\n                pressedKey    = event.which,\n                isShortcutKey = module.is.inObject(pressedKey, keys)\n              ;\n              if(isShortcutKey) {\n                var\n                  $label            = $module.find(selector.label),\n                  $activeLabel      = $label.filter('.' + className.active),\n                  activeValue       = $activeLabel.data(metadata.value),\n                  labelIndex        = $label.index($activeLabel),\n                  labelCount        = $label.length,\n                  hasActiveLabel    = ($activeLabel.length > 0),\n                  hasMultipleActive = ($activeLabel.length > 1),\n                  isFirstLabel      = (labelIndex === 0),\n                  isLastLabel       = (labelIndex + 1 == labelCount),\n                  isSearch          = module.is.searchSelection(),\n                  isFocusedOnSearch = module.is.focusedOnSearch(),\n                  isFocused         = module.is.focused(),\n                  caretAtStart      = (isFocusedOnSearch && module.get.caretPosition() === 0),\n                  $nextLabel\n                ;\n                if(isSearch && !hasActiveLabel && !isFocusedOnSearch) {\n                  return;\n                }\n\n                if(pressedKey == keys.leftArrow) {\n                  // activate previous label\n                  if((isFocused || caretAtStart) && !hasActiveLabel) {\n                    module.verbose('Selecting previous label');\n                    $label.last().addClass(className.active);\n                  }\n                  else if(hasActiveLabel) {\n                    if(!event.shiftKey) {\n                      module.verbose('Selecting previous label');\n                      $label.removeClass(className.active);\n                    }\n                    else {\n                      module.verbose('Adding previous label to selection');\n                    }\n                    if(isFirstLabel && !hasMultipleActive) {\n                      $activeLabel.addClass(className.active);\n                    }\n                    else {\n                      $activeLabel.prev(selector.siblingLabel)\n                        .addClass(className.active)\n                        .end()\n                      ;\n                    }\n                    event.preventDefault();\n                  }\n                }\n                else if(pressedKey == keys.rightArrow) {\n                  // activate first label\n                  if(isFocused && !hasActiveLabel) {\n                    $label.first().addClass(className.active);\n                  }\n                  // activate next label\n                  if(hasActiveLabel) {\n                    if(!event.shiftKey) {\n                      module.verbose('Selecting next label');\n                      $label.removeClass(className.active);\n                    }\n                    else {\n                      module.verbose('Adding next label to selection');\n                    }\n                    if(isLastLabel) {\n                      if(isSearch) {\n                        if(!isFocusedOnSearch) {\n                          module.focusSearch();\n                        }\n                        else {\n                          $label.removeClass(className.active);\n                        }\n                      }\n                      else if(hasMultipleActive) {\n                        $activeLabel.next(selector.siblingLabel).addClass(className.active);\n                      }\n                      else {\n                        $activeLabel.addClass(className.active);\n                      }\n                    }\n                    else {\n                      $activeLabel.next(selector.siblingLabel).addClass(className.active);\n                    }\n                    event.preventDefault();\n                  }\n                }\n                else if(pressedKey == keys.deleteKey || pressedKey == keys.backspace) {\n                  if(hasActiveLabel) {\n                    module.verbose('Removing active labels');\n                    if(isLastLabel) {\n                      if(isSearch && !isFocusedOnSearch) {\n                        module.focusSearch();\n                      }\n                    }\n                    $activeLabel.last().next(selector.siblingLabel).addClass(className.active);\n                    module.remove.activeLabels($activeLabel);\n                    event.preventDefault();\n                  }\n                  else if(caretAtStart && !hasActiveLabel && pressedKey == keys.backspace) {\n                    module.verbose('Removing last label on input backspace');\n                    $activeLabel = $label.last().addClass(className.active);\n                    module.remove.activeLabels($activeLabel);\n                  }\n                }\n                else {\n                  $activeLabel.removeClass(className.active);\n                }\n              }\n            }\n          },\n\n          keydown: function(event) {\n            var\n              pressedKey    = event.which,\n              isShortcutKey = module.is.inObject(pressedKey, keys)\n            ;\n            if(isShortcutKey) {\n              var\n                $currentlySelected = $item.not(selector.unselectable).filter('.' + className.selected).eq(0),\n                $activeItem        = $menu.children('.' + className.active).eq(0),\n                $selectedItem      = ($currentlySelected.length > 0)\n                  ? $currentlySelected\n                  : $activeItem,\n                $visibleItems = ($selectedItem.length > 0)\n                  ? $selectedItem.siblings(':not(.' + className.filtered +')').addBack()\n                  : $menu.children(':not(.' + className.filtered +')'),\n                $subMenu              = $selectedItem.children(selector.menu),\n                $parentMenu           = $selectedItem.closest(selector.menu),\n                inVisibleMenu         = ($parentMenu.hasClass(className.visible) || $parentMenu.hasClass(className.animating) || $parentMenu.parent(selector.menu).length > 0),\n                hasSubMenu            = ($subMenu.length> 0),\n                hasSelectedItem       = ($selectedItem.length > 0),\n                selectedIsSelectable  = ($selectedItem.not(selector.unselectable).length > 0),\n                delimiterPressed      = (pressedKey == keys.delimiter && settings.allowAdditions && module.is.multiple()),\n                isAdditionWithoutMenu = (settings.allowAdditions && settings.hideAdditions && (pressedKey == keys.enter || delimiterPressed) && selectedIsSelectable),\n                $nextItem,\n                isSubMenuItem,\n                newIndex\n              ;\n              // allow selection with menu closed\n              if(isAdditionWithoutMenu) {\n                module.verbose('Selecting item from keyboard shortcut', $selectedItem);\n                module.event.item.click.call($selectedItem, event);\n                if(module.is.searchSelection()) {\n                  module.remove.searchTerm();\n                }\n              }\n\n              // visible menu keyboard shortcuts\n              if( module.is.visible() ) {\n\n                // enter (select or open sub-menu)\n                if(pressedKey == keys.enter || delimiterPressed) {\n                  if(pressedKey == keys.enter && hasSelectedItem && hasSubMenu && !settings.allowCategorySelection) {\n                    module.verbose('Pressed enter on unselectable category, opening sub menu');\n                    pressedKey = keys.rightArrow;\n                  }\n                  else if(selectedIsSelectable) {\n                    module.verbose('Selecting item from keyboard shortcut', $selectedItem);\n                    module.event.item.click.call($selectedItem, event);\n                    if(module.is.searchSelection()) {\n                      module.remove.searchTerm();\n                    }\n                  }\n                  event.preventDefault();\n                }\n\n                // sub-menu actions\n                if(hasSelectedItem) {\n\n                  if(pressedKey == keys.leftArrow) {\n\n                    isSubMenuItem = ($parentMenu[0] !== $menu[0]);\n\n                    if(isSubMenuItem) {\n                      module.verbose('Left key pressed, closing sub-menu');\n                      module.animate.hide(false, $parentMenu);\n                      $selectedItem\n                        .removeClass(className.selected)\n                      ;\n                      $parentMenu\n                        .closest(selector.item)\n                          .addClass(className.selected)\n                      ;\n                      event.preventDefault();\n                    }\n                  }\n\n                  // right arrow (show sub-menu)\n                  if(pressedKey == keys.rightArrow) {\n                    if(hasSubMenu) {\n                      module.verbose('Right key pressed, opening sub-menu');\n                      module.animate.show(false, $subMenu);\n                      $selectedItem\n                        .removeClass(className.selected)\n                      ;\n                      $subMenu\n                        .find(selector.item).eq(0)\n                          .addClass(className.selected)\n                      ;\n                      event.preventDefault();\n                    }\n                  }\n                }\n\n                // up arrow (traverse menu up)\n                if(pressedKey == keys.upArrow) {\n                  $nextItem = (hasSelectedItem && inVisibleMenu)\n                    ? $selectedItem.prevAll(selector.item + ':not(' + selector.unselectable + ')').eq(0)\n                    : $item.eq(0)\n                  ;\n                  if($visibleItems.index( $nextItem ) < 0) {\n                    module.verbose('Up key pressed but reached top of current menu');\n                    event.preventDefault();\n                    return;\n                  }\n                  else {\n                    module.verbose('Up key pressed, changing active item');\n                    $selectedItem\n                      .removeClass(className.selected)\n                    ;\n                    $nextItem\n                      .addClass(className.selected)\n                    ;\n                    module.set.scrollPosition($nextItem);\n                    if(settings.selectOnKeydown && module.is.single()) {\n                      module.set.selectedItem($nextItem);\n                    }\n                  }\n                  event.preventDefault();\n                }\n\n                // down arrow (traverse menu down)\n                if(pressedKey == keys.downArrow) {\n                  $nextItem = (hasSelectedItem && inVisibleMenu)\n                    ? $nextItem = $selectedItem.nextAll(selector.item + ':not(' + selector.unselectable + ')').eq(0)\n                    : $item.eq(0)\n                  ;\n                  if($nextItem.length === 0) {\n                    module.verbose('Down key pressed but reached bottom of current menu');\n                    event.preventDefault();\n                    return;\n                  }\n                  else {\n                    module.verbose('Down key pressed, changing active item');\n                    $item\n                      .removeClass(className.selected)\n                    ;\n                    $nextItem\n                      .addClass(className.selected)\n                    ;\n                    module.set.scrollPosition($nextItem);\n                    if(settings.selectOnKeydown && module.is.single()) {\n                      module.set.activeItem($nextItem);\n                      module.set.selected(module.get.choiceValue($nextItem), $nextItem);\n                    }\n                  }\n                  event.preventDefault();\n                }\n\n                // page down (show next page)\n                if(pressedKey == keys.pageUp) {\n                  module.scrollPage('up');\n                  event.preventDefault();\n                }\n                if(pressedKey == keys.pageDown) {\n                  module.scrollPage('down');\n                  event.preventDefault();\n                }\n\n                // escape (close menu)\n                if(pressedKey == keys.escape) {\n                  module.verbose('Escape key pressed, closing dropdown');\n                  module.hide();\n                }\n\n              }\n              else {\n                // delimiter key\n                if(delimiterPressed) {\n                  event.preventDefault();\n                }\n                // down arrow (open menu)\n                if(pressedKey == keys.downArrow && !module.is.visible()) {\n                  module.verbose('Down key pressed, showing dropdown');\n                  module.select.firstUnfiltered();\n                  module.show();\n                  event.preventDefault();\n                }\n              }\n            }\n            else {\n              if( !module.has.search() ) {\n                module.set.selectedLetter( String.fromCharCode(pressedKey) );\n              }\n            }\n          }\n        },\n\n        trigger: {\n          change: function() {\n            var\n              events       = document.createEvent('HTMLEvents'),\n              inputElement = $input[0]\n            ;\n            if(inputElement) {\n              module.verbose('Triggering native change event');\n              events.initEvent('change', true, false);\n              inputElement.dispatchEvent(events);\n            }\n          }\n        },\n\n        determine: {\n          selectAction: function(text, value) {\n            module.verbose('Determining action', settings.action);\n            if( $.isFunction( module.action[settings.action] ) ) {\n              module.verbose('Triggering preset action', settings.action, text, value);\n              module.action[ settings.action ].call(element, text, value, this);\n            }\n            else if( $.isFunction(settings.action) ) {\n              module.verbose('Triggering user action', settings.action, text, value);\n              settings.action.call(element, text, value, this);\n            }\n            else {\n              module.error(error.action, settings.action);\n            }\n          },\n          eventInModule: function(event, callback) {\n            var\n              $target    = $(event.target),\n              inDocument = ($target.closest(document.documentElement).length > 0),\n              inModule   = ($target.closest($module).length > 0)\n            ;\n            callback = $.isFunction(callback)\n              ? callback\n              : function(){}\n            ;\n            if(inDocument && !inModule) {\n              module.verbose('Triggering event', callback);\n              callback();\n              return true;\n            }\n            else {\n              module.verbose('Event occurred in dropdown, canceling callback');\n              return false;\n            }\n          },\n          eventOnElement: function(event, callback) {\n            var\n              $target      = $(event.target),\n              $label       = $target.closest(selector.siblingLabel),\n              inVisibleDOM = document.body.contains(event.target),\n              notOnLabel   = ($module.find($label).length === 0),\n              notInMenu    = ($target.closest($menu).length === 0)\n            ;\n            callback = $.isFunction(callback)\n              ? callback\n              : function(){}\n            ;\n            if(inVisibleDOM && notOnLabel && notInMenu) {\n              module.verbose('Triggering event', callback);\n              callback();\n              return true;\n            }\n            else {\n              module.verbose('Event occurred in dropdown menu, canceling callback');\n              return false;\n            }\n          }\n        },\n\n        action: {\n\n          nothing: function() {},\n\n          activate: function(text, value, element) {\n            value = (value !== undefined)\n              ? value\n              : text\n            ;\n            if( module.can.activate( $(element) ) ) {\n              module.set.selected(value, $(element));\n              if(module.is.multiple() && !module.is.allFiltered()) {\n                return;\n              }\n              else {\n                module.hideAndClear();\n              }\n            }\n          },\n\n          select: function(text, value, element) {\n            // mimics action.activate but does not select text\n            module.action.activate.call(element);\n          },\n\n          combo: function(text, value, element) {\n            value = (value !== undefined)\n              ? value\n              : text\n            ;\n            module.set.selected(value, $(element));\n            module.hideAndClear();\n          },\n\n          hide: function(text, value, element) {\n            module.set.value(value, text);\n            module.hideAndClear();\n          }\n\n        },\n\n        get: {\n          id: function() {\n            return id;\n          },\n          defaultText: function() {\n            return $module.data(metadata.defaultText);\n          },\n          defaultValue: function() {\n            return $module.data(metadata.defaultValue);\n          },\n          placeholderText: function() {\n            return $module.data(metadata.placeholderText) || '';\n          },\n          text: function() {\n            return $text.text();\n          },\n          query: function() {\n            return $.trim($search.val());\n          },\n          searchWidth: function(value) {\n            value = (value !== undefined)\n              ? value\n              : $search.val()\n            ;\n            $sizer.text(value);\n            // prevent rounding issues\n            return Math.ceil( $sizer.width() + 1);\n          },\n          selectionCount: function() {\n            var\n              values = module.get.values(),\n              count\n            ;\n            count = ( module.is.multiple() )\n              ? $.isArray(values)\n                ? values.length\n                : 0\n              : (module.get.value() !== '')\n                ? 1\n                : 0\n            ;\n            return count;\n          },\n          transition: function($subMenu) {\n            return (settings.transition == 'auto')\n              ? module.is.upward($subMenu)\n                ? 'slide up'\n                : 'slide down'\n              : settings.transition\n            ;\n          },\n          userValues: function() {\n            var\n              values = module.get.values()\n            ;\n            if(!values) {\n              return false;\n            }\n            values = $.isArray(values)\n              ? values\n              : [values]\n            ;\n            return $.grep(values, function(value) {\n              return (module.get.item(value) === false);\n            });\n          },\n          uniqueArray: function(array) {\n            return $.grep(array, function (value, index) {\n                return $.inArray(value, array) === index;\n            });\n          },\n          caretPosition: function() {\n            var\n              input = $search.get(0),\n              range,\n              rangeLength\n            ;\n            if('selectionStart' in input) {\n              return input.selectionStart;\n            }\n            else if (document.selection) {\n              input.focus();\n              range       = document.selection.createRange();\n              rangeLength = range.text.length;\n              range.moveStart('character', -input.value.length);\n              return range.text.length - rangeLength;\n            }\n          },\n          value: function() {\n            var\n              value = ($input.length > 0)\n                ? $input.val()\n                : $module.data(metadata.value),\n              isEmptyMultiselect = ($.isArray(value) && value.length === 1 && value[0] === '')\n            ;\n            // prevents placeholder element from being selected when multiple\n            return (value === undefined || isEmptyMultiselect)\n              ? ''\n              : value\n            ;\n          },\n          values: function() {\n            var\n              value = module.get.value()\n            ;\n            if(value === '') {\n              return '';\n            }\n            return ( !module.has.selectInput() && module.is.multiple() )\n              ? (typeof value == 'string') // delimited string\n                ? value.split(settings.delimiter)\n                : ''\n              : value\n            ;\n          },\n          remoteValues: function() {\n            var\n              values = module.get.values(),\n              remoteValues = false\n            ;\n            if(values) {\n              if(typeof values == 'string') {\n                values = [values];\n              }\n              $.each(values, function(index, value) {\n                var\n                  name = module.read.remoteData(value)\n                ;\n                module.verbose('Restoring value from session data', name, value);\n                if(name) {\n                  if(!remoteValues) {\n                    remoteValues = {};\n                  }\n                  remoteValues[value] = name;\n                }\n              });\n            }\n            return remoteValues;\n          },\n          choiceText: function($choice, preserveHTML) {\n            preserveHTML = (preserveHTML !== undefined)\n              ? preserveHTML\n              : settings.preserveHTML\n            ;\n            if($choice) {\n              if($choice.find(selector.menu).length > 0) {\n                module.verbose('Retrieving text of element with sub-menu');\n                $choice = $choice.clone();\n                $choice.find(selector.menu).remove();\n                $choice.find(selector.menuIcon).remove();\n              }\n              return ($choice.data(metadata.text) !== undefined)\n                ? $choice.data(metadata.text)\n                : (preserveHTML)\n                  ? $.trim($choice.html())\n                  : $.trim($choice.text())\n              ;\n            }\n          },\n          choiceValue: function($choice, choiceText) {\n            choiceText = choiceText || module.get.choiceText($choice);\n            if(!$choice) {\n              return false;\n            }\n            return ($choice.data(metadata.value) !== undefined)\n              ? String( $choice.data(metadata.value) )\n              : (typeof choiceText === 'string')\n                ? $.trim(choiceText.toLowerCase())\n                : String(choiceText)\n            ;\n          },\n          inputEvent: function() {\n            var\n              input = $search[0]\n            ;\n            if(input) {\n              return (input.oninput !== undefined)\n                ? 'input'\n                : (input.onpropertychange !== undefined)\n                  ? 'propertychange'\n                  : 'keyup'\n              ;\n            }\n            return false;\n          },\n          selectValues: function() {\n            var\n              select = {}\n            ;\n            select.values = [];\n            $module\n              .find('option')\n                .each(function() {\n                  var\n                    $option  = $(this),\n                    name     = $option.html(),\n                    disabled = $option.attr('disabled'),\n                    value    = ( $option.attr('value') !== undefined )\n                      ? $option.attr('value')\n                      : name\n                  ;\n                  if(settings.placeholder === 'auto' && value === '') {\n                    select.placeholder = name;\n                  }\n                  else {\n                    select.values.push({\n                      name     : name,\n                      value    : value,\n                      disabled : disabled\n                    });\n                  }\n                })\n            ;\n            if(settings.placeholder && settings.placeholder !== 'auto') {\n              module.debug('Setting placeholder value to', settings.placeholder);\n              select.placeholder = settings.placeholder;\n            }\n            if(settings.sortSelect) {\n              select.values.sort(function(a, b) {\n                return (a.name > b.name)\n                  ? 1\n                  : -1\n                ;\n              });\n              module.debug('Retrieved and sorted values from select', select);\n            }\n            else {\n              module.debug('Retrieved values from select', select);\n            }\n            return select;\n          },\n          activeItem: function() {\n            return $item.filter('.'  + className.active);\n          },\n          selectedItem: function() {\n            var\n              $selectedItem = $item.not(selector.unselectable).filter('.'  + className.selected)\n            ;\n            return ($selectedItem.length > 0)\n              ? $selectedItem\n              : $item.eq(0)\n            ;\n          },\n          itemWithAdditions: function(value) {\n            var\n              $items       = module.get.item(value),\n              $userItems   = module.create.userChoice(value),\n              hasUserItems = ($userItems && $userItems.length > 0)\n            ;\n            if(hasUserItems) {\n              $items = ($items.length > 0)\n                ? $items.add($userItems)\n                : $userItems\n              ;\n            }\n            return $items;\n          },\n          item: function(value, strict) {\n            var\n              $selectedItem = false,\n              shouldSearch,\n              isMultiple\n            ;\n            value = (value !== undefined)\n              ? value\n              : ( module.get.values() !== undefined)\n                ? module.get.values()\n                : module.get.text()\n            ;\n            shouldSearch = (isMultiple)\n              ? (value.length > 0)\n              : (value !== undefined && value !== null)\n            ;\n            isMultiple = (module.is.multiple() && $.isArray(value));\n            strict     = (value === '' || value === 0)\n              ? true\n              : strict || false\n            ;\n            if(shouldSearch) {\n              $item\n                .each(function() {\n                  var\n                    $choice       = $(this),\n                    optionText    = module.get.choiceText($choice),\n                    optionValue   = module.get.choiceValue($choice, optionText)\n                  ;\n                  // safe early exit\n                  if(optionValue === null || optionValue === undefined) {\n                    return;\n                  }\n                  if(isMultiple) {\n                    if($.inArray( String(optionValue), value) !== -1 || $.inArray(optionText, value) !== -1) {\n                      $selectedItem = ($selectedItem)\n                        ? $selectedItem.add($choice)\n                        : $choice\n                      ;\n                    }\n                  }\n                  else if(strict) {\n                    module.verbose('Ambiguous dropdown value using strict type check', $choice, value);\n                    if( optionValue === value || optionText === value) {\n                      $selectedItem = $choice;\n                      return true;\n                    }\n                  }\n                  else {\n                    if( String(optionValue) == String(value) || optionText == value) {\n                      module.verbose('Found select item by value', optionValue, value);\n                      $selectedItem = $choice;\n                      return true;\n                    }\n                  }\n                })\n              ;\n            }\n            return $selectedItem;\n          }\n        },\n\n        check: {\n          maxSelections: function(selectionCount) {\n            if(settings.maxSelections) {\n              selectionCount = (selectionCount !== undefined)\n                ? selectionCount\n                : module.get.selectionCount()\n              ;\n              if(selectionCount >= settings.maxSelections) {\n                module.debug('Maximum selection count reached');\n                if(settings.useLabels) {\n                  $item.addClass(className.filtered);\n                  module.add.message(message.maxSelections);\n                }\n                return true;\n              }\n              else {\n                module.verbose('No longer at maximum selection count');\n                module.remove.message();\n                module.remove.filteredItem();\n                if(module.is.searchSelection()) {\n                  module.filterItems();\n                }\n                return false;\n              }\n            }\n            return true;\n          }\n        },\n\n        restore: {\n          defaults: function() {\n            module.clear();\n            module.restore.defaultText();\n            module.restore.defaultValue();\n          },\n          defaultText: function() {\n            var\n              defaultText     = module.get.defaultText(),\n              placeholderText = module.get.placeholderText\n            ;\n            if(defaultText === placeholderText) {\n              module.debug('Restoring default placeholder text', defaultText);\n              module.set.placeholderText(defaultText);\n            }\n            else {\n              module.debug('Restoring default text', defaultText);\n              module.set.text(defaultText);\n            }\n          },\n          placeholderText: function() {\n            module.set.placeholderText();\n          },\n          defaultValue: function() {\n            var\n              defaultValue = module.get.defaultValue()\n            ;\n            if(defaultValue !== undefined) {\n              module.debug('Restoring default value', defaultValue);\n              if(defaultValue !== '') {\n                module.set.value(defaultValue);\n                module.set.selected();\n              }\n              else {\n                module.remove.activeItem();\n                module.remove.selectedItem();\n              }\n            }\n          },\n          labels: function() {\n            if(settings.allowAdditions) {\n              if(!settings.useLabels) {\n                module.error(error.labels);\n                settings.useLabels = true;\n              }\n              module.debug('Restoring selected values');\n              module.create.userLabels();\n            }\n            module.check.maxSelections();\n          },\n          selected: function() {\n            module.restore.values();\n            if(module.is.multiple()) {\n              module.debug('Restoring previously selected values and labels');\n              module.restore.labels();\n            }\n            else {\n              module.debug('Restoring previously selected values');\n            }\n          },\n          values: function() {\n            // prevents callbacks from occurring on initial load\n            module.set.initialLoad();\n            if(settings.apiSettings && settings.saveRemoteData && module.get.remoteValues()) {\n              module.restore.remoteValues();\n            }\n            else {\n              module.set.selected();\n            }\n            module.remove.initialLoad();\n          },\n          remoteValues: function() {\n            var\n              values = module.get.remoteValues()\n            ;\n            module.debug('Recreating selected from session data', values);\n            if(values) {\n              if( module.is.single() ) {\n                $.each(values, function(value, name) {\n                  module.set.text(name);\n                });\n              }\n              else {\n                $.each(values, function(value, name) {\n                  module.add.label(value, name);\n                });\n              }\n            }\n          }\n        },\n\n        read: {\n          remoteData: function(value) {\n            var\n              name\n            ;\n            if(window.Storage === undefined) {\n              module.error(error.noStorage);\n              return;\n            }\n            name = sessionStorage.getItem(value);\n            return (name !== undefined)\n              ? name\n              : false\n            ;\n          }\n        },\n\n        save: {\n          defaults: function() {\n            module.save.defaultText();\n            module.save.placeholderText();\n            module.save.defaultValue();\n          },\n          defaultValue: function() {\n            var\n              value = module.get.value()\n            ;\n            module.verbose('Saving default value as', value);\n            $module.data(metadata.defaultValue, value);\n          },\n          defaultText: function() {\n            var\n              text = module.get.text()\n            ;\n            module.verbose('Saving default text as', text);\n            $module.data(metadata.defaultText, text);\n          },\n          placeholderText: function() {\n            var\n              text\n            ;\n            if(settings.placeholder !== false && $text.hasClass(className.placeholder)) {\n              text = module.get.text();\n              module.verbose('Saving placeholder text as', text);\n              $module.data(metadata.placeholderText, text);\n            }\n          },\n          remoteData: function(name, value) {\n            if(window.Storage === undefined) {\n              module.error(error.noStorage);\n              return;\n            }\n            module.verbose('Saving remote data to session storage', value, name);\n            sessionStorage.setItem(value, name);\n          }\n        },\n\n        clear: function() {\n          if(module.is.multiple()) {\n            module.remove.labels();\n          }\n          else {\n            module.remove.activeItem();\n            module.remove.selectedItem();\n          }\n          module.set.placeholderText();\n          module.clearValue();\n        },\n\n        clearValue: function() {\n          module.set.value('');\n        },\n\n        scrollPage: function(direction, $selectedItem) {\n          var\n            $currentItem  = $selectedItem || module.get.selectedItem(),\n            $menu         = $currentItem.closest(selector.menu),\n            menuHeight    = $menu.outerHeight(),\n            currentScroll = $menu.scrollTop(),\n            itemHeight    = $item.eq(0).outerHeight(),\n            itemsPerPage  = Math.floor(menuHeight / itemHeight),\n            maxScroll     = $menu.prop('scrollHeight'),\n            newScroll     = (direction == 'up')\n              ? currentScroll - (itemHeight * itemsPerPage)\n              : currentScroll + (itemHeight * itemsPerPage),\n            $selectableItem = $item.not(selector.unselectable),\n            isWithinRange,\n            $nextSelectedItem,\n            elementIndex\n          ;\n          elementIndex      = (direction == 'up')\n            ? $selectableItem.index($currentItem) - itemsPerPage\n            : $selectableItem.index($currentItem) + itemsPerPage\n          ;\n          isWithinRange = (direction == 'up')\n            ? (elementIndex >= 0)\n            : (elementIndex < $selectableItem.length)\n          ;\n          $nextSelectedItem = (isWithinRange)\n            ? $selectableItem.eq(elementIndex)\n            : (direction == 'up')\n              ? $selectableItem.first()\n              : $selectableItem.last()\n          ;\n          if($nextSelectedItem.length > 0) {\n            module.debug('Scrolling page', direction, $nextSelectedItem);\n            $currentItem\n              .removeClass(className.selected)\n            ;\n            $nextSelectedItem\n              .addClass(className.selected)\n            ;\n            if(settings.selectOnKeydown && module.is.single()) {\n              module.set.selectedItem($nextSelectedItem);\n            }\n            $menu\n              .scrollTop(newScroll)\n            ;\n          }\n        },\n\n        set: {\n          filtered: function() {\n            var\n              isMultiple       = module.is.multiple(),\n              isSearch         = module.is.searchSelection(),\n              isSearchMultiple = (isMultiple && isSearch),\n              searchValue      = (isSearch)\n                ? module.get.query()\n                : '',\n              hasSearchValue   = (typeof searchValue === 'string' && searchValue.length > 0),\n              searchWidth      = module.get.searchWidth(),\n              valueIsSet       = searchValue !== ''\n            ;\n            if(isMultiple && hasSearchValue) {\n              module.verbose('Adjusting input width', searchWidth, settings.glyphWidth);\n              $search.css('width', searchWidth);\n            }\n            if(hasSearchValue || (isSearchMultiple && valueIsSet)) {\n              module.verbose('Hiding placeholder text');\n              $text.addClass(className.filtered);\n            }\n            else if(!isMultiple || (isSearchMultiple && !valueIsSet)) {\n              module.verbose('Showing placeholder text');\n              $text.removeClass(className.filtered);\n            }\n          },\n          empty: function() {\n            $module.addClass(className.empty);\n          },\n          loading: function() {\n            $module.addClass(className.loading);\n          },\n          placeholderText: function(text) {\n            text = text || module.get.placeholderText();\n            module.debug('Setting placeholder text', text);\n            module.set.text(text);\n            $text.addClass(className.placeholder);\n          },\n          tabbable: function() {\n            if( module.has.search() ) {\n              module.debug('Added tabindex to searchable dropdown');\n              $search\n                .val('')\n                .attr('tabindex', 0)\n              ;\n              $menu\n                .attr('tabindex', -1)\n              ;\n            }\n            else {\n              module.debug('Added tabindex to dropdown');\n              if( $module.attr('tabindex') === undefined) {\n                $module\n                  .attr('tabindex', 0)\n                ;\n                $menu\n                  .attr('tabindex', -1)\n                ;\n              }\n            }\n          },\n          initialLoad: function() {\n            module.verbose('Setting initial load');\n            initialLoad = true;\n          },\n          activeItem: function($item) {\n            if( settings.allowAdditions && $item.filter(selector.addition).length > 0 ) {\n              $item.addClass(className.filtered);\n            }\n            else {\n              $item.addClass(className.active);\n            }\n          },\n          scrollPosition: function($item, forceScroll) {\n            var\n              edgeTolerance = 5,\n              $menu,\n              hasActive,\n              offset,\n              itemHeight,\n              itemOffset,\n              menuOffset,\n              menuScroll,\n              menuHeight,\n              abovePage,\n              belowPage\n            ;\n\n            $item       = $item || module.get.selectedItem();\n            $menu       = $item.closest(selector.menu);\n            hasActive   = ($item && $item.length > 0);\n            forceScroll = (forceScroll !== undefined)\n              ? forceScroll\n              : false\n            ;\n            if($item && $menu.length > 0 && hasActive) {\n              itemOffset = $item.position().top;\n\n              $menu.addClass(className.loading);\n              menuScroll = $menu.scrollTop();\n              menuOffset = $menu.offset().top;\n              itemOffset = $item.offset().top;\n              offset     = menuScroll - menuOffset + itemOffset;\n              if(!forceScroll) {\n                menuHeight = $menu.height();\n                belowPage  = menuScroll + menuHeight < (offset + edgeTolerance);\n                abovePage  = ((offset - edgeTolerance) < menuScroll);\n              }\n              module.debug('Scrolling to active item', offset);\n              if(forceScroll || abovePage || belowPage) {\n                $menu.scrollTop(offset);\n              }\n              $menu.removeClass(className.loading);\n            }\n          },\n          text: function(text) {\n            if(settings.action !== 'select') {\n              if(settings.action == 'combo') {\n                module.debug('Changing combo button text', text, $combo);\n                if(settings.preserveHTML) {\n                  $combo.html(text);\n                }\n                else {\n                  $combo.text(text);\n                }\n              }\n              else {\n                if(text !== module.get.placeholderText()) {\n                  $text.removeClass(className.placeholder);\n                }\n                module.debug('Changing text', text, $text);\n                $text\n                  .removeClass(className.filtered)\n                ;\n                if(settings.preserveHTML) {\n                  $text.html(text);\n                }\n                else {\n                  $text.text(text);\n                }\n              }\n            }\n          },\n          selectedItem: function($item) {\n            module.debug('Setting user selection to item', $item);\n            module.remove.activeItem();\n            module.set.activeItem($item);\n            module.set.selected(module.get.choiceValue($item), $item);\n          },\n          selectedLetter: function(letter) {\n            var\n              $selectedItem         = $item.filter('.' + className.selected),\n              alreadySelectedLetter = $selectedItem.length > 0 && module.has.firstLetter($selectedItem, letter),\n              $nextValue            = false,\n              $nextItem\n            ;\n            // check next of same letter\n            if(alreadySelectedLetter) {\n              $nextItem = $selectedItem.nextAll($item).eq(0);\n              if( module.has.firstLetter($nextItem, letter) ) {\n                $nextValue  = $nextItem;\n              }\n            }\n            // check all values\n            if(!$nextValue) {\n              $item\n                .each(function(){\n                  if(module.has.firstLetter($(this), letter)) {\n                    $nextValue = $(this);\n                    return false;\n                  }\n                })\n              ;\n            }\n            // set next value\n            if($nextValue) {\n              module.verbose('Scrolling to next value with letter', letter);\n              module.set.scrollPosition($nextValue);\n              $selectedItem.removeClass(className.selected);\n              $nextValue.addClass(className.selected);\n              if(settings.selectOnKeydown && module.is.single()) {\n                module.set.selectedItem($nextValue);\n              }\n            }\n          },\n          direction: function($menu) {\n            if(settings.direction == 'auto') {\n              if(module.is.onScreen($menu)) {\n                module.remove.upward($menu);\n              }\n              else {\n                module.set.upward($menu);\n              }\n            }\n            else if(settings.direction == 'upward') {\n              module.set.upward($menu);\n            }\n          },\n          upward: function($menu) {\n            var $element = $menu || $module;\n            $element.addClass(className.upward);\n          },\n          value: function(value, text, $selected) {\n            var\n              escapedValue = module.escape.value(value),\n              hasInput     = ($input.length > 0),\n              isAddition   = !module.has.value(value),\n              currentValue = module.get.values(),\n              stringValue  = (value !== undefined)\n                ? String(value)\n                : value,\n              newValue\n            ;\n            if(hasInput) {\n              if(!settings.allowReselection && stringValue == currentValue) {\n                module.verbose('Skipping value update already same value', value, currentValue);\n                if(!module.is.initialLoad()) {\n                  return;\n                }\n              }\n\n              if( module.is.single() && module.has.selectInput() && module.can.extendSelect() ) {\n                module.debug('Adding user option', value);\n                module.add.optionValue(value);\n              }\n              module.debug('Updating input value', escapedValue, currentValue);\n              internalChange = true;\n              $input\n                .val(escapedValue)\n              ;\n              if(settings.fireOnInit === false && module.is.initialLoad()) {\n                module.debug('Input native change event ignored on initial load');\n              }\n              else {\n                module.trigger.change();\n              }\n              internalChange = false;\n            }\n            else {\n              module.verbose('Storing value in metadata', escapedValue, $input);\n              if(escapedValue !== currentValue) {\n                $module.data(metadata.value, stringValue);\n              }\n            }\n            if(settings.fireOnInit === false && module.is.initialLoad()) {\n              module.verbose('No callback on initial load', settings.onChange);\n            }\n            else {\n              settings.onChange.call(element, value, text, $selected);\n            }\n          },\n          active: function() {\n            $module\n              .addClass(className.active)\n            ;\n          },\n          multiple: function() {\n            $module.addClass(className.multiple);\n          },\n          visible: function() {\n            $module.addClass(className.visible);\n          },\n          exactly: function(value, $selectedItem) {\n            module.debug('Setting selected to exact values');\n            module.clear();\n            module.set.selected(value, $selectedItem);\n          },\n          selected: function(value, $selectedItem) {\n            var\n              isMultiple = module.is.multiple(),\n              $userSelectedItem\n            ;\n            $selectedItem = (settings.allowAdditions)\n              ? $selectedItem || module.get.itemWithAdditions(value)\n              : $selectedItem || module.get.item(value)\n            ;\n            if(!$selectedItem) {\n              return;\n            }\n            module.debug('Setting selected menu item to', $selectedItem);\n            if(module.is.multiple()) {\n              module.remove.searchWidth();\n            }\n            if(module.is.single()) {\n              module.remove.activeItem();\n              module.remove.selectedItem();\n            }\n            else if(settings.useLabels) {\n              module.remove.selectedItem();\n            }\n            // select each item\n            $selectedItem\n              .each(function() {\n                var\n                  $selected      = $(this),\n                  selectedText   = module.get.choiceText($selected),\n                  selectedValue  = module.get.choiceValue($selected, selectedText),\n\n                  isFiltered     = $selected.hasClass(className.filtered),\n                  isActive       = $selected.hasClass(className.active),\n                  isUserValue    = $selected.hasClass(className.addition),\n                  shouldAnimate  = (isMultiple && $selectedItem.length == 1)\n                ;\n                if(isMultiple) {\n                  if(!isActive || isUserValue) {\n                    if(settings.apiSettings && settings.saveRemoteData) {\n                      module.save.remoteData(selectedText, selectedValue);\n                    }\n                    if(settings.useLabels) {\n                      module.add.value(selectedValue, selectedText, $selected);\n                      module.add.label(selectedValue, selectedText, shouldAnimate);\n                      module.set.activeItem($selected);\n                      module.filterActive();\n                      module.select.nextAvailable($selectedItem);\n                    }\n                    else {\n                      module.add.value(selectedValue, selectedText, $selected);\n                      module.set.text(module.add.variables(message.count));\n                      module.set.activeItem($selected);\n                    }\n                  }\n                  else if(!isFiltered) {\n                    module.debug('Selected active value, removing label');\n                    module.remove.selected(selectedValue);\n                  }\n                }\n                else {\n                  if(settings.apiSettings && settings.saveRemoteData) {\n                    module.save.remoteData(selectedText, selectedValue);\n                  }\n                  module.set.text(selectedText);\n                  module.set.value(selectedValue, selectedText, $selected);\n                  $selected\n                    .addClass(className.active)\n                    .addClass(className.selected)\n                  ;\n                }\n              })\n            ;\n          }\n        },\n\n        add: {\n          label: function(value, text, shouldAnimate) {\n            var\n              $next  = module.is.searchSelection()\n                ? $search\n                : $text,\n              escapedValue = module.escape.value(value),\n              $label\n            ;\n            $label =  $('<a />')\n              .addClass(className.label)\n              .attr('data-value', escapedValue)\n              .html(templates.label(escapedValue, text))\n            ;\n            $label = settings.onLabelCreate.call($label, escapedValue, text);\n\n            if(module.has.label(value)) {\n              module.debug('Label already exists, skipping', escapedValue);\n              return;\n            }\n            if(settings.label.variation) {\n              $label.addClass(settings.label.variation);\n            }\n            if(shouldAnimate === true) {\n              module.debug('Animating in label', $label);\n              $label\n                .addClass(className.hidden)\n                .insertBefore($next)\n                .transition(settings.label.transition, settings.label.duration)\n              ;\n            }\n            else {\n              module.debug('Adding selection label', $label);\n              $label\n                .insertBefore($next)\n              ;\n            }\n          },\n          message: function(message) {\n            var\n              $message = $menu.children(selector.message),\n              html     = settings.templates.message(module.add.variables(message))\n            ;\n            if($message.length > 0) {\n              $message\n                .html(html)\n              ;\n            }\n            else {\n              $message = $('<div/>')\n                .html(html)\n                .addClass(className.message)\n                .appendTo($menu)\n              ;\n            }\n          },\n          optionValue: function(value) {\n            var\n              escapedValue = module.escape.value(value),\n              $option      = $input.find('option[value=\"' + escapedValue + '\"]'),\n              hasOption    = ($option.length > 0)\n            ;\n            if(hasOption) {\n              return;\n            }\n            // temporarily disconnect observer\n            module.disconnect.selectObserver();\n            if( module.is.single() ) {\n              module.verbose('Removing previous user addition');\n              $input.find('option.' + className.addition).remove();\n            }\n            $('<option/>')\n              .prop('value', escapedValue)\n              .addClass(className.addition)\n              .html(value)\n              .appendTo($input)\n            ;\n            module.verbose('Adding user addition as an <option>', value);\n            module.observe.select();\n          },\n          userSuggestion: function(value) {\n            var\n              $addition         = $menu.children(selector.addition),\n              $existingItem     = module.get.item(value),\n              alreadyHasValue   = $existingItem && $existingItem.not(selector.addition).length,\n              hasUserSuggestion = $addition.length > 0,\n              html\n            ;\n            if(settings.useLabels && module.has.maxSelections()) {\n              return;\n            }\n            if(value === '' || alreadyHasValue) {\n              $addition.remove();\n              return;\n            }\n            if(hasUserSuggestion) {\n              $addition\n                .data(metadata.value, value)\n                .data(metadata.text, value)\n                .attr('data-' + metadata.value, value)\n                .attr('data-' + metadata.text, value)\n                .removeClass(className.filtered)\n              ;\n              if(!settings.hideAdditions) {\n                html = settings.templates.addition( module.add.variables(message.addResult, value) );\n                $addition\n                  .html(html)\n                ;\n              }\n              module.verbose('Replacing user suggestion with new value', $addition);\n            }\n            else {\n              $addition = module.create.userChoice(value);\n              $addition\n                .prependTo($menu)\n              ;\n              module.verbose('Adding item choice to menu corresponding with user choice addition', $addition);\n            }\n            if(!settings.hideAdditions || module.is.allFiltered()) {\n              $addition\n                .addClass(className.selected)\n                .siblings()\n                .removeClass(className.selected)\n              ;\n            }\n            module.refreshItems();\n          },\n          variables: function(message, term) {\n            var\n              hasCount    = (message.search('{count}') !== -1),\n              hasMaxCount = (message.search('{maxCount}') !== -1),\n              hasTerm     = (message.search('{term}') !== -1),\n              values,\n              count,\n              query\n            ;\n            module.verbose('Adding templated variables to message', message);\n            if(hasCount) {\n              count  = module.get.selectionCount();\n              message = message.replace('{count}', count);\n            }\n            if(hasMaxCount) {\n              count  = module.get.selectionCount();\n              message = message.replace('{maxCount}', settings.maxSelections);\n            }\n            if(hasTerm) {\n              query   = term || module.get.query();\n              message = message.replace('{term}', query);\n            }\n            return message;\n          },\n          value: function(addedValue, addedText, $selectedItem) {\n            var\n              currentValue = module.get.values(),\n              newValue\n            ;\n            if(addedValue === '') {\n              module.debug('Cannot select blank values from multiselect');\n              return;\n            }\n            // extend current array\n            if($.isArray(currentValue)) {\n              newValue = currentValue.concat([addedValue]);\n              newValue = module.get.uniqueArray(newValue);\n            }\n            else {\n              newValue = [addedValue];\n            }\n            // add values\n            if( module.has.selectInput() ) {\n              if(module.can.extendSelect()) {\n                module.debug('Adding value to select', addedValue, newValue, $input);\n                module.add.optionValue(addedValue);\n              }\n            }\n            else {\n              newValue = newValue.join(settings.delimiter);\n              module.debug('Setting hidden input to delimited value', newValue, $input);\n            }\n\n            if(settings.fireOnInit === false && module.is.initialLoad()) {\n              module.verbose('Skipping onadd callback on initial load', settings.onAdd);\n            }\n            else {\n              settings.onAdd.call(element, addedValue, addedText, $selectedItem);\n            }\n            module.set.value(newValue, addedValue, addedText, $selectedItem);\n            module.check.maxSelections();\n          }\n        },\n\n        remove: {\n          active: function() {\n            $module.removeClass(className.active);\n          },\n          activeLabel: function() {\n            $module.find(selector.label).removeClass(className.active);\n          },\n          empty: function() {\n            $module.removeClass(className.empty);\n          },\n          loading: function() {\n            $module.removeClass(className.loading);\n          },\n          initialLoad: function() {\n            initialLoad = false;\n          },\n          upward: function($menu) {\n            var $element = $menu || $module;\n            $element.removeClass(className.upward);\n          },\n          visible: function() {\n            $module.removeClass(className.visible);\n          },\n          activeItem: function() {\n            $item.removeClass(className.active);\n          },\n          filteredItem: function() {\n            if(settings.useLabels && module.has.maxSelections() ) {\n              return;\n            }\n            if(settings.useLabels && module.is.multiple()) {\n              $item.not('.' + className.active).removeClass(className.filtered);\n            }\n            else {\n              $item.removeClass(className.filtered);\n            }\n            module.remove.empty();\n          },\n          optionValue: function(value) {\n            var\n              escapedValue = module.escape.value(value),\n              $option      = $input.find('option[value=\"' + escapedValue + '\"]'),\n              hasOption    = ($option.length > 0)\n            ;\n            if(!hasOption || !$option.hasClass(className.addition)) {\n              return;\n            }\n            // temporarily disconnect observer\n            if(selectObserver) {\n              selectObserver.disconnect();\n              module.verbose('Temporarily disconnecting mutation observer');\n            }\n            $option.remove();\n            module.verbose('Removing user addition as an <option>', escapedValue);\n            if(selectObserver) {\n              selectObserver.observe($input[0], {\n                childList : true,\n                subtree   : true\n              });\n            }\n          },\n          message: function() {\n            $menu.children(selector.message).remove();\n          },\n          searchWidth: function() {\n            $search.css('width', '');\n          },\n          searchTerm: function() {\n            module.verbose('Cleared search term');\n            $search.val('');\n            module.set.filtered();\n          },\n          userAddition: function() {\n            $item.filter(selector.addition).remove();\n          },\n          selected: function(value, $selectedItem) {\n            $selectedItem = (settings.allowAdditions)\n              ? $selectedItem || module.get.itemWithAdditions(value)\n              : $selectedItem || module.get.item(value)\n            ;\n\n            if(!$selectedItem) {\n              return false;\n            }\n\n            $selectedItem\n              .each(function() {\n                var\n                  $selected     = $(this),\n                  selectedText  = module.get.choiceText($selected),\n                  selectedValue = module.get.choiceValue($selected, selectedText)\n                ;\n                if(module.is.multiple()) {\n                  if(settings.useLabels) {\n                    module.remove.value(selectedValue, selectedText, $selected);\n                    module.remove.label(selectedValue);\n                  }\n                  else {\n                    module.remove.value(selectedValue, selectedText, $selected);\n                    if(module.get.selectionCount() === 0) {\n                      module.set.placeholderText();\n                    }\n                    else {\n                      module.set.text(module.add.variables(message.count));\n                    }\n                  }\n                }\n                else {\n                  module.remove.value(selectedValue, selectedText, $selected);\n                }\n                $selected\n                  .removeClass(className.filtered)\n                  .removeClass(className.active)\n                ;\n                if(settings.useLabels) {\n                  $selected.removeClass(className.selected);\n                }\n              })\n            ;\n          },\n          selectedItem: function() {\n            $item.removeClass(className.selected);\n          },\n          value: function(removedValue, removedText, $removedItem) {\n            var\n              values = module.get.values(),\n              newValue\n            ;\n            if( module.has.selectInput() ) {\n              module.verbose('Input is <select> removing selected option', removedValue);\n              newValue = module.remove.arrayValue(removedValue, values);\n              module.remove.optionValue(removedValue);\n            }\n            else {\n              module.verbose('Removing from delimited values', removedValue);\n              newValue = module.remove.arrayValue(removedValue, values);\n              newValue = newValue.join(settings.delimiter);\n            }\n            if(settings.fireOnInit === false && module.is.initialLoad()) {\n              module.verbose('No callback on initial load', settings.onRemove);\n            }\n            else {\n              settings.onRemove.call(element, removedValue, removedText, $removedItem);\n            }\n            module.set.value(newValue, removedText, $removedItem);\n            module.check.maxSelections();\n          },\n          arrayValue: function(removedValue, values) {\n            if( !$.isArray(values) ) {\n              values = [values];\n            }\n            values = $.grep(values, function(value){\n              return (removedValue != value);\n            });\n            module.verbose('Removed value from delimited string', removedValue, values);\n            return values;\n          },\n          label: function(value, shouldAnimate) {\n            var\n              $labels       = $module.find(selector.label),\n              $removedLabel = $labels.filter('[data-value=\"' + value +'\"]')\n            ;\n            module.verbose('Removing label', $removedLabel);\n            $removedLabel.remove();\n          },\n          activeLabels: function($activeLabels) {\n            $activeLabels = $activeLabels || $module.find(selector.label).filter('.' + className.active);\n            module.verbose('Removing active label selections', $activeLabels);\n            module.remove.labels($activeLabels);\n          },\n          labels: function($labels) {\n            $labels = $labels || $module.find(selector.label);\n            module.verbose('Removing labels', $labels);\n            $labels\n              .each(function(){\n                var\n                  $label      = $(this),\n                  value       = $label.data(metadata.value),\n                  stringValue = (value !== undefined)\n                    ? String(value)\n                    : value,\n                  isUserValue = module.is.userValue(stringValue)\n                ;\n                if(settings.onLabelRemove.call($label, value) === false) {\n                  module.debug('Label remove callback cancelled removal');\n                  return;\n                }\n                module.remove.message();\n                if(isUserValue) {\n                  module.remove.value(stringValue);\n                  module.remove.label(stringValue);\n                }\n                else {\n                  // selected will also remove label\n                  module.remove.selected(stringValue);\n                }\n              })\n            ;\n          },\n          tabbable: function() {\n            if( module.has.search() ) {\n              module.debug('Searchable dropdown initialized');\n              $search\n                .removeAttr('tabindex')\n              ;\n              $menu\n                .removeAttr('tabindex')\n              ;\n            }\n            else {\n              module.debug('Simple selection dropdown initialized');\n              $module\n                .removeAttr('tabindex')\n              ;\n              $menu\n                .removeAttr('tabindex')\n              ;\n            }\n          }\n        },\n\n        has: {\n          menuSearch: function() {\n            return (module.has.search() && $search.closest($menu).length > 0);\n          },\n          search: function() {\n            return ($search.length > 0);\n          },\n          sizer: function() {\n            return ($sizer.length > 0);\n          },\n          selectInput: function() {\n            return ( $input.is('select') );\n          },\n          minCharacters: function(searchTerm) {\n            if(settings.minCharacters) {\n              searchTerm = (searchTerm !== undefined)\n                ? String(searchTerm)\n                : String(module.get.query())\n              ;\n              return (searchTerm.length >= settings.minCharacters);\n            }\n            return true;\n          },\n          firstLetter: function($item, letter) {\n            var\n              text,\n              firstLetter\n            ;\n            if(!$item || $item.length === 0 || typeof letter !== 'string') {\n              return false;\n            }\n            text        = module.get.choiceText($item, false);\n            letter      = letter.toLowerCase();\n            firstLetter = String(text).charAt(0).toLowerCase();\n            return (letter == firstLetter);\n          },\n          input: function() {\n            return ($input.length > 0);\n          },\n          items: function() {\n            return ($item.length > 0);\n          },\n          menu: function() {\n            return ($menu.length > 0);\n          },\n          message: function() {\n            return ($menu.children(selector.message).length !== 0);\n          },\n          label: function(value) {\n            var\n              escapedValue = module.escape.value(value),\n              $labels      = $module.find(selector.label)\n            ;\n            return ($labels.filter('[data-value=\"' + escapedValue +'\"]').length > 0);\n          },\n          maxSelections: function() {\n            return (settings.maxSelections && module.get.selectionCount() >= settings.maxSelections);\n          },\n          allResultsFiltered: function() {\n            var\n              $normalResults = $item.not(selector.addition)\n            ;\n            return ($normalResults.filter(selector.unselectable).length === $normalResults.length);\n          },\n          userSuggestion: function() {\n            return ($menu.children(selector.addition).length > 0);\n          },\n          query: function() {\n            return (module.get.query() !== '');\n          },\n          value: function(value) {\n            var\n              values   = module.get.values(),\n              hasValue = $.isArray(values)\n               ? values && ($.inArray(value, values) !== -1)\n               : (values == value)\n            ;\n            return (hasValue)\n              ? true\n              : false\n            ;\n          }\n        },\n\n        is: {\n          active: function() {\n            return $module.hasClass(className.active);\n          },\n          bubbledLabelClick: function(event) {\n            return $(event.target).is('select, input') && $module.closest('label').length > 0;\n          },\n          alreadySetup: function() {\n            return ($module.is('select') && $module.parent(selector.dropdown).length > 0  && $module.prev().length === 0);\n          },\n          animating: function($subMenu) {\n            return ($subMenu)\n              ? $subMenu.transition && $subMenu.transition('is animating')\n              : $menu.transition    && $menu.transition('is animating')\n            ;\n          },\n          disabled: function() {\n            return $module.hasClass(className.disabled);\n          },\n          focused: function() {\n            return (document.activeElement === $module[0]);\n          },\n          focusedOnSearch: function() {\n            return (document.activeElement === $search[0]);\n          },\n          allFiltered: function() {\n            return( (module.is.multiple() || module.has.search()) && !(settings.hideAdditions == false && module.has.userSuggestion()) && !module.has.message() && module.has.allResultsFiltered() );\n          },\n          hidden: function($subMenu) {\n            return !module.is.visible($subMenu);\n          },\n          initialLoad: function() {\n            return initialLoad;\n          },\n          onScreen: function($subMenu) {\n            var\n              $currentMenu   = $subMenu || $menu,\n              canOpenDownward = true,\n              onScreen = {},\n              calculations\n            ;\n            $currentMenu.addClass(className.loading);\n            calculations = {\n              context: {\n                scrollTop : $context.scrollTop(),\n                height    : $context.outerHeight()\n              },\n              menu : {\n                offset: $currentMenu.offset(),\n                height: $currentMenu.outerHeight()\n              }\n            };\n            onScreen = {\n              above : (calculations.context.scrollTop) <= calculations.menu.offset.top - calculations.menu.height,\n              below : (calculations.context.scrollTop + calculations.context.height) >= calculations.menu.offset.top + calculations.menu.height\n            };\n            if(onScreen.below) {\n              module.verbose('Dropdown can fit in context downward', onScreen);\n              canOpenDownward = true;\n            }\n            else if(!onScreen.below && !onScreen.above) {\n              module.verbose('Dropdown cannot fit in either direction, favoring downward', onScreen);\n              canOpenDownward = true;\n            }\n            else {\n              module.verbose('Dropdown cannot fit below, opening upward', onScreen);\n              canOpenDownward = false;\n            }\n            $currentMenu.removeClass(className.loading);\n            return canOpenDownward;\n          },\n          inObject: function(needle, object) {\n            var\n              found = false\n            ;\n            $.each(object, function(index, property) {\n              if(property == needle) {\n                found = true;\n                return true;\n              }\n            });\n            return found;\n          },\n          multiple: function() {\n            return $module.hasClass(className.multiple);\n          },\n          single: function() {\n            return !module.is.multiple();\n          },\n          selectMutation: function(mutations) {\n            var\n              selectChanged = false\n            ;\n            $.each(mutations, function(index, mutation) {\n              if(mutation.target && $(mutation.target).is('select')) {\n                selectChanged = true;\n                return true;\n              }\n            });\n            return selectChanged;\n          },\n          search: function() {\n            return $module.hasClass(className.search);\n          },\n          searchSelection: function() {\n            return ( module.has.search() && $search.parent(selector.dropdown).length === 1 );\n          },\n          selection: function() {\n            return $module.hasClass(className.selection);\n          },\n          userValue: function(value) {\n            return ($.inArray(value, module.get.userValues()) !== -1);\n          },\n          upward: function($menu) {\n            var $element = $menu || $module;\n            return $element.hasClass(className.upward);\n          },\n          visible: function($subMenu) {\n            return ($subMenu)\n              ? $subMenu.hasClass(className.visible)\n              : $menu.hasClass(className.visible)\n            ;\n          }\n        },\n\n        can: {\n          activate: function($item) {\n            if(settings.useLabels) {\n              return true;\n            }\n            if(!module.has.maxSelections()) {\n              return true;\n            }\n            if(module.has.maxSelections() && $item.hasClass(className.active)) {\n              return true;\n            }\n            return false;\n          },\n          click: function() {\n            return (hasTouch || settings.on == 'click');\n          },\n          extendSelect: function() {\n            return settings.allowAdditions || settings.apiSettings;\n          },\n          show: function() {\n            return !module.is.disabled() && (module.has.items() || module.has.message());\n          },\n          useAPI: function() {\n            return $.fn.api !== undefined;\n          }\n        },\n\n        animate: {\n          show: function(callback, $subMenu) {\n            var\n              $currentMenu = $subMenu || $menu,\n              start = ($subMenu)\n                ? function() {}\n                : function() {\n                  module.hideSubMenus();\n                  module.hideOthers();\n                  module.set.active();\n                },\n              transition\n            ;\n            callback = $.isFunction(callback)\n              ? callback\n              : function(){}\n            ;\n            module.verbose('Doing menu show animation', $currentMenu);\n            module.set.direction($subMenu);\n            transition = module.get.transition($subMenu);\n            if( module.is.selection() ) {\n              module.set.scrollPosition(module.get.selectedItem(), true);\n            }\n            if( module.is.hidden($currentMenu) || module.is.animating($currentMenu) ) {\n              if(transition == 'none') {\n                start();\n                $currentMenu.transition('show');\n                callback.call(element);\n              }\n              else if($.fn.transition !== undefined && $module.transition('is supported')) {\n                $currentMenu\n                  .transition({\n                    animation  : transition + ' in',\n                    debug      : settings.debug,\n                    verbose    : settings.verbose,\n                    duration   : settings.duration,\n                    queue      : true,\n                    onStart    : start,\n                    onComplete : function() {\n                      callback.call(element);\n                    }\n                  })\n                ;\n              }\n              else {\n                module.error(error.noTransition, transition);\n              }\n            }\n          },\n          hide: function(callback, $subMenu) {\n            var\n              $currentMenu = $subMenu || $menu,\n              duration = ($subMenu)\n                ? (settings.duration * 0.9)\n                : settings.duration,\n              start = ($subMenu)\n                ? function() {}\n                : function() {\n                  if( module.can.click() ) {\n                    module.unbind.intent();\n                  }\n                  module.remove.active();\n                },\n              transition = module.get.transition($subMenu)\n            ;\n            callback = $.isFunction(callback)\n              ? callback\n              : function(){}\n            ;\n            if( module.is.visible($currentMenu) || module.is.animating($currentMenu) ) {\n              module.verbose('Doing menu hide animation', $currentMenu);\n\n              if(transition == 'none') {\n                start();\n                $currentMenu.transition('hide');\n                callback.call(element);\n              }\n              else if($.fn.transition !== undefined && $module.transition('is supported')) {\n                $currentMenu\n                  .transition({\n                    animation  : transition + ' out',\n                    duration   : settings.duration,\n                    debug      : settings.debug,\n                    verbose    : settings.verbose,\n                    queue      : true,\n                    onStart    : start,\n                    onComplete : function() {\n                      if(settings.direction == 'auto') {\n                        module.remove.upward($subMenu);\n                      }\n                      callback.call(element);\n                    }\n                  })\n                ;\n              }\n              else {\n                module.error(error.transition);\n              }\n            }\n          }\n        },\n\n        hideAndClear: function() {\n          module.remove.searchTerm();\n          if( module.has.maxSelections() ) {\n            return;\n          }\n          if(module.has.search()) {\n            module.hide(function() {\n              module.remove.filteredItem();\n            });\n          }\n          else {\n            module.hide();\n          }\n        },\n\n        delay: {\n          show: function() {\n            module.verbose('Delaying show event to ensure user intent');\n            clearTimeout(module.timer);\n            module.timer = setTimeout(module.show, settings.delay.show);\n          },\n          hide: function() {\n            module.verbose('Delaying hide event to ensure user intent');\n            clearTimeout(module.timer);\n            module.timer = setTimeout(module.hide, settings.delay.hide);\n          }\n        },\n\n        escape: {\n          value: function(value) {\n            var\n              multipleValues = $.isArray(value),\n              stringValue    = (typeof value === 'string'),\n              isUnparsable   = (!stringValue && !multipleValues),\n              hasQuotes      = (stringValue && value.search(regExp.quote) !== -1),\n              values         = []\n            ;\n            if(!module.has.selectInput() || isUnparsable || !hasQuotes) {\n              return value;\n            }\n            module.debug('Encoding quote values for use in select', value);\n            if(multipleValues) {\n              $.each(value, function(index, value){\n                values.push(value.replace(regExp.quote, '&quot;'));\n              });\n              return values;\n            }\n            return value.replace(regExp.quote, '&quot;');\n          },\n          regExp: function(text) {\n            text =  String(text);\n            return text.replace(regExp.escape, '\\\\$&');\n          }\n        },\n\n        setting: function(name, value) {\n          module.debug('Changing setting', name, value);\n          if( $.isPlainObject(name) ) {\n            $.extend(true, settings, name);\n          }\n          else if(value !== undefined) {\n            if($.isPlainObject(settings[name])) {\n              $.extend(true, settings[name], value);\n            }\n            else {\n              settings[name] = value;\n            }\n          }\n          else {\n            return settings[name];\n          }\n        },\n        internal: function(name, value) {\n          if( $.isPlainObject(name) ) {\n            $.extend(true, module, name);\n          }\n          else if(value !== undefined) {\n            module[name] = value;\n          }\n          else {\n            return module[name];\n          }\n        },\n        debug: function() {\n          if(!settings.silent && settings.debug) {\n            if(settings.performance) {\n              module.performance.log(arguments);\n            }\n            else {\n              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');\n              module.debug.apply(console, arguments);\n            }\n          }\n        },\n        verbose: function() {\n          if(!settings.silent && settings.verbose && settings.debug) {\n            if(settings.performance) {\n              module.performance.log(arguments);\n            }\n            else {\n              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');\n              module.verbose.apply(console, arguments);\n            }\n          }\n        },\n        error: function() {\n          if(!settings.silent) {\n            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');\n            module.error.apply(console, arguments);\n          }\n        },\n        performance: {\n          log: function(message) {\n            var\n              currentTime,\n              executionTime,\n              previousTime\n            ;\n            if(settings.performance) {\n              currentTime   = new Date().getTime();\n              previousTime  = time || currentTime;\n              executionTime = currentTime - previousTime;\n              time          = currentTime;\n              performance.push({\n                'Name'           : message[0],\n                'Arguments'      : [].slice.call(message, 1) || '',\n                'Element'        : element,\n                'Execution Time' : executionTime\n              });\n            }\n            clearTimeout(module.performance.timer);\n            module.performance.timer = setTimeout(module.performance.display, 500);\n          },\n          display: function() {\n            var\n              title = settings.name + ':',\n              totalTime = 0\n            ;\n            time = false;\n            clearTimeout(module.performance.timer);\n            $.each(performance, function(index, data) {\n              totalTime += data['Execution Time'];\n            });\n            title += ' ' + totalTime + 'ms';\n            if(moduleSelector) {\n              title += ' \\'' + moduleSelector + '\\'';\n            }\n            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {\n              console.groupCollapsed(title);\n              if(console.table) {\n                console.table(performance);\n              }\n              else {\n                $.each(performance, function(index, data) {\n                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');\n                });\n              }\n              console.groupEnd();\n            }\n            performance = [];\n          }\n        },\n        invoke: function(query, passedArguments, context) {\n          var\n            object = instance,\n            maxDepth,\n            found,\n            response\n          ;\n          passedArguments = passedArguments || queryArguments;\n          context         = element         || context;\n          if(typeof query == 'string' && object !== undefined) {\n            query    = query.split(/[\\. ]/);\n            maxDepth = query.length - 1;\n            $.each(query, function(depth, value) {\n              var camelCaseValue = (depth != maxDepth)\n                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)\n                : query\n              ;\n              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {\n                object = object[camelCaseValue];\n              }\n              else if( object[camelCaseValue] !== undefined ) {\n                found = object[camelCaseValue];\n                return false;\n              }\n              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {\n                object = object[value];\n              }\n              else if( object[value] !== undefined ) {\n                found = object[value];\n                return false;\n              }\n              else {\n                module.error(error.method, query);\n                return false;\n              }\n            });\n          }\n          if ( $.isFunction( found ) ) {\n            response = found.apply(context, passedArguments);\n          }\n          else if(found !== undefined) {\n            response = found;\n          }\n          if($.isArray(returnedValue)) {\n            returnedValue.push(response);\n          }\n          else if(returnedValue !== undefined) {\n            returnedValue = [returnedValue, response];\n          }\n          else if(response !== undefined) {\n            returnedValue = response;\n          }\n          return found;\n        }\n      };\n\n      if(methodInvoked) {\n        if(instance === undefined) {\n          module.initialize();\n        }\n        module.invoke(query);\n      }\n      else {\n        if(instance !== undefined) {\n          instance.invoke('destroy');\n        }\n        module.initialize();\n      }\n    })\n  ;\n  return (returnedValue !== undefined)\n    ? returnedValue\n    : $allModules\n  ;\n};\n\n$.fn.dropdown.settings = {\n\n  silent                 : false,\n  debug                  : false,\n  verbose                : false,\n  performance            : true,\n\n  on                     : 'click',    // what event should show menu action on item selection\n  action                 : 'activate', // action on item selection (nothing, activate, select, combo, hide, function(){})\n\n\n  apiSettings            : false,\n  selectOnKeydown        : true,       // Whether selection should occur automatically when keyboard shortcuts used\n  minCharacters          : 0,          // Minimum characters required to trigger API call\n  saveRemoteData         : true,       // Whether remote name/value pairs should be stored in sessionStorage to allow remote data to be restored on page refresh\n  throttle               : 200,        // How long to wait after last user input to search remotely\n\n  context                : window,     // Context to use when determining if on screen\n  direction              : 'auto',     // Whether dropdown should always open in one direction\n  keepOnScreen           : true,       // Whether dropdown should check whether it is on screen before showing\n\n  match                  : 'both',     // what to match against with search selection (both, text, or label)\n  fullTextSearch         : false,      // search anywhere in value (set to 'exact' to require exact matches)\n\n  placeholder            : 'auto',     // whether to convert blank <select> values to placeholder text\n  preserveHTML           : true,       // preserve html when selecting value\n  sortSelect             : false,      // sort selection on init\n\n  forceSelection         : true,       // force a choice on blur with search selection\n\n  allowAdditions         : false,      // whether multiple select should allow user added values\n  hideAdditions          : true,      // whether or not to hide special message prompting a user they can enter a value\n\n  maxSelections          : false,      // When set to a number limits the number of selections to this count\n  useLabels              : true,       // whether multiple select should filter currently active selections from choices\n  delimiter              : ',',        // when multiselect uses normal <input> the values will be delimited with this character\n\n  showOnFocus            : true,       // show menu on focus\n  allowReselection       : false,      // whether current value should trigger callbacks when reselected\n  allowTab               : true,       // add tabindex to element\n  allowCategorySelection : false,      // allow elements with sub-menus to be selected\n\n  fireOnInit             : false,      // Whether callbacks should fire when initializing dropdown values\n\n  transition             : 'auto',     // auto transition will slide down or up based on direction\n  duration               : 200,        // duration of transition\n\n  glyphWidth             : 1.037,      // widest glyph width in em (W is 1.037 em) used to calculate multiselect input width\n\n  // label settings on multi-select\n  label: {\n    transition : 'scale',\n    duration   : 200,\n    variation  : false\n  },\n\n  // delay before event\n  delay : {\n    hide   : 300,\n    show   : 200,\n    search : 20,\n    touch  : 50\n  },\n\n  /* Callbacks */\n  onChange      : function(value, text, $selected){},\n  onAdd         : function(value, text, $selected){},\n  onRemove      : function(value, text, $selected){},\n\n  onLabelSelect : function($selectedLabels){},\n  onLabelCreate : function(value, text) { return $(this); },\n  onLabelRemove : function(value) { return true; },\n  onNoResults   : function(searchTerm) { return true; },\n  onShow        : function(){},\n  onHide        : function(){},\n\n  /* Component */\n  name           : 'Dropdown',\n  namespace      : 'dropdown',\n\n  message: {\n    addResult     : 'Add <b>{term}</b>',\n    count         : '{count} selected',\n    maxSelections : 'Max {maxCount} selections',\n    noResults     : 'No results found.',\n    serverError   : 'There was an error contacting the server'\n  },\n\n  error : {\n    action          : 'You called a dropdown action that was not defined',\n    alreadySetup    : 'Once a select has been initialized behaviors must be called on the created ui dropdown',\n    labels          : 'Allowing user additions currently requires the use of labels.',\n    missingMultiple : '<select> requires multiple property to be set to correctly preserve multiple values',\n    method          : 'The method you called is not defined.',\n    noAPI           : 'The API module is required to load resources remotely',\n    noStorage       : 'Saving remote data requires session storage',\n    noTransition    : 'This module requires ui transitions <https://github.com/Semantic-Org/UI-Transition>'\n  },\n\n  regExp : {\n    escape   : /[-[\\]{}()*+?.,\\\\^$|#\\s]/g,\n    quote    : /\"/g\n  },\n\n  metadata : {\n    defaultText     : 'defaultText',\n    defaultValue    : 'defaultValue',\n    placeholderText : 'placeholder',\n    text            : 'text',\n    value           : 'value'\n  },\n\n  // property names for remote query\n  fields: {\n    remoteValues : 'results',  // grouping for api results\n    values       : 'values',   // grouping for all dropdown values\n    disabled     : 'disabled', // whether value should be disabled\n    name         : 'name',     // displayed dropdown text\n    value        : 'value',    // actual dropdown value\n    text         : 'text'      // displayed text when selected\n  },\n\n  keys : {\n    backspace  : 8,\n    delimiter  : 188, // comma\n    deleteKey  : 46,\n    enter      : 13,\n    escape     : 27,\n    pageUp     : 33,\n    pageDown   : 34,\n    leftArrow  : 37,\n    upArrow    : 38,\n    rightArrow : 39,\n    downArrow  : 40\n  },\n\n  selector : {\n    addition     : '.addition',\n    dropdown     : '.ui.dropdown',\n    hidden       : '.hidden',\n    icon         : '> .dropdown.icon',\n    input        : '> input[type=\"hidden\"], > select',\n    item         : '.item',\n    label        : '> .label',\n    remove       : '> .label > .delete.icon',\n    siblingLabel : '.label',\n    menu         : '.menu',\n    message      : '.message',\n    menuIcon     : '.dropdown.icon',\n    search       : 'input.search, .menu > .search > input, .menu input.search',\n    sizer        : '> input.sizer',\n    text         : '> .text:not(.icon)',\n    unselectable : '.disabled, .filtered'\n  },\n\n  className : {\n    active      : 'active',\n    addition    : 'addition',\n    animating   : 'animating',\n    disabled    : 'disabled',\n    empty       : 'empty',\n    dropdown    : 'ui dropdown',\n    filtered    : 'filtered',\n    hidden      : 'hidden transition',\n    item        : 'item',\n    label       : 'ui label',\n    loading     : 'loading',\n    menu        : 'menu',\n    message     : 'message',\n    multiple    : 'multiple',\n    placeholder : 'default',\n    sizer       : 'sizer',\n    search      : 'search',\n    selected    : 'selected',\n    selection   : 'selection',\n    upward      : 'upward',\n    visible     : 'visible'\n  }\n\n};\n\n/* Templates */\n$.fn.dropdown.settings.templates = {\n\n  // generates dropdown from select values\n  dropdown: function(select) {\n    var\n      placeholder = select.placeholder || false,\n      values      = select.values || {},\n      html        = ''\n    ;\n    html +=  '<i class=\"dropdown icon\"></i>';\n    if(select.placeholder) {\n      html += '<div class=\"default text\">' + placeholder + '</div>';\n    }\n    else {\n      html += '<div class=\"text\"></div>';\n    }\n    html += '<div class=\"menu\">';\n    $.each(select.values, function(index, option) {\n      html += (option.disabled)\n        ? '<div class=\"disabled item\" data-value=\"' + option.value + '\">' + option.name + '</div>'\n        : '<div class=\"item\" data-value=\"' + option.value + '\">' + option.name + '</div>'\n      ;\n    });\n    html += '</div>';\n    return html;\n  },\n\n  // generates just menu from select\n  menu: function(response, fields) {\n    var\n      values = response[fields.values] || {},\n      html   = ''\n    ;\n    $.each(values, function(index, option) {\n      var\n        maybeText = (option[fields.text])\n          ? 'data-text=\"' + option[fields.text] + '\"'\n          : '',\n        maybeDisabled = (option[fields.disabled])\n          ? 'disabled '\n          : ''\n      ;\n      html += '<div class=\"'+ maybeDisabled +'item\" data-value=\"' + option[fields.value] + '\"' + maybeText + '>'\n      html +=   option[fields.name];\n      html += '</div>';\n    });\n    return html;\n  },\n\n  // generates label for multiselect\n  label: function(value, text) {\n    return text + '<i class=\"delete icon\"></i>';\n  },\n\n\n  // generates messages like \"No results\"\n  message: function(message) {\n    return message;\n  },\n\n  // generates user addition to selection menu\n  addition: function(choice) {\n    return choice;\n  }\n\n};\n\n})( jQuery, window, document );\n"]},"hash":"9347907d1addcecccc2c69601d82423560afe779"}
